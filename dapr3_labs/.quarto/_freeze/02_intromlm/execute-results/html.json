{
  "hash": "8834bc58f688ce5b2c15f59de708d19a",
  "result": {
    "markdown": "---\ntitle: \"Multilevel Models\"\nparams: \n    SHOW_SOLS: TRUE\n    TOGGLE: TRUE\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n:::lo\n**A Note on terminology**\n\nThe methods we're going to learn about in the first five weeks of this course are known by lots of different names: \"multilevel models\"; \"hierarchical linear models\"; \"mixed-effect models\"; \"mixed models\"; \"nested data models\"; \"random coefficient models\"; \"random-effects models\"; \"random parameter models\"... and so on).   \n\nWhat the idea boils down to is that **model parameters vary at more than one level.** This week, we're going to explore what that means.  \n\nThroughout this course, we will tend to use the terms \"mixed effect model\", \"linear mixed model (LMM)\" and \"multilevel model (MLM)\" interchangeably. \n:::\n\n\n\n# Introducing Multilevel Models\n\nMultilevel Models (MLMs) (or \"Linear Mixed Models\" (LMMs)) take the approach of allowing the groups/clusters to vary around our $\\beta$ estimates. \n\nIn the lectures, we saw this as:\n\n$$\n\\begin{align}\n& \\text{for observation }j\\text{ in group }i \\\\\n\\quad \\\\\n& \\text{Level 1:} \\\\\n& \\color{red}{y_{ij}}\\color{black} = \\color{blue}{\\beta_{0i} \\cdot 1 + \\beta_{1i} \\cdot x_{ij}}\\color{black} + \\varepsilon_{ij} \\\\\n& \\text{Level 2:} \\\\\n& \\color{blue}{\\beta_{0i}}\\color{black} = \\gamma_{00} + \\color{orange}{\\zeta_{0i}} \\\\\n& \\color{blue}{\\beta_{1i}}\\color{black} = \\gamma_{10} + \\color{orange}{\\zeta_{1i}} \\\\\n\\quad \\\\\n& \\text{Where:} \\\\\n& \\gamma_{00}\\text{ is the population intercept, and }\\color{orange}{\\zeta_{0i}}\\color{black}\\text{ is the deviation of group }i\\text{ from }\\gamma_{00} \\\\\n& \\gamma_{10}\\text{ is the population slope, and }\\color{orange}{\\zeta_{1i}}\\color{black}\\text{ is the deviation of group }i\\text{ from }\\gamma_{10} \\\\\n\\end{align}\n$$\n\nWe are now assuming $\\color{orange}{\\zeta_0}$, $\\color{orange}{\\zeta_1}$, and $\\varepsilon$ to be normally distributed with a mean of 0, and we denote their variances as $\\sigma_{\\color{orange}{\\zeta_0}}^2$, $\\sigma_{\\color{orange}{\\zeta_1}}^2$, $\\sigma_\\varepsilon^2$ respectively. \n\nThe $\\color{orange}{\\zeta}$ components also get termed the \"random effects\" part of the model, Hence names like \"random effects model\", etc. \n\n\n::: {.callout-note collapse=\"true\"}\n#### Alternative notation\n\nMany people use the symbol $u$ in place of $\\zeta$.  \nIn various resources, you are likely to see $\\alpha$ used to denote the intercept instead of $\\beta_0$.  \n\nSometimes, you will see the levels collapsed into one equation, as it might make for more intuitive reading. This often fits with the name \"mixed effects\" for these models:\n\n$$\n\\color{red}{y_{ij}}\\color{black} = (\\color{blue}{\\beta_0}\\color{black} + \\color{orange}{\\zeta_{0i}}\\color{black}) \\cdot 1 + ( \\color{blue}{\\beta_{1}}\\color{black} + \\color{orange}{\\zeta_{1i}} \\color{black}) \\cdot x_{ij}  +  \\varepsilon_{ij} \\\\\n$$\n\nAnd then we also have the condensed matrix form of the model, in which the Z matrix represents the grouping structure, and the $u$ (or $\\zeta$) are the estimated random deviations. \n$$\n\\mathbf{y} = \\boldsymbol{X\\beta} + \\boldsymbol{Zu} + \\boldsymbol{\\varepsilon}\n$$\n:::\n\n# Fitting Multilevel Models\n\nTo fit multilevel models, qe're going to use the `lme4` package, and specifically the functions `lmer()` and `glmer()`.  \n\"(g)lmer\" here stands for \"(generalised) linear mixed effects regression\". \n\nYou will have seen some use of these functions in the lectures. The broad syntax is:  \n<br>\n<div style=\"margin-left:50px;\">**lmer(*formula*, data = *dataframe*, REML = *logical*, control = lmerControl(*options*))**</div>    \n<br>\n\n## Model Formula\n\nWe write the first bit of our **formula** just the same as our old friend the normal linear model `y ~ 1 + x + x2 + ...`, where `y` is the name of our outcome variable, `1` is the intercept (which we don't have to explicitly state as it will be included anyway) and `x`, `x2` etc are the names of our explanatory variables.  \n\nWith **lme4**, we now have the addition of __random effect terms__, specified in parenthesis with the `|` operator (the vertical line | is often found to the left of the z key on QWERTY keyboards). We use the `|` operator to separate the parameters (intercept, slope etc.) on the LHS, from the grouping variable(s) on the RHS, by which we would like to model these parameters as varying.  \n\n:::statbox\n__Random Intercepts__  \nLet us suppose that we wish to model our intercept not as a fixed constant, but as varying randomly according to some grouping around a fixed center. \nWe can such a model by allowing the intercept to vary by our grouping variable (`g` below): \n\n<center>`lmer(y ~ 1 + x + (1|g), data = df)`</center>\n$$\n\\begin{align}\n& \\text{Level 1:} \\\\\n& \\color{red}{Y_{ij}} = \\color{blue}{\\beta_{0i} \\cdot 1 + \\beta_{1} \\cdot X_{ij}} + \\varepsilon_{ij} \\\\\n& \\text{Level 2:} \\\\\n& \\color{blue}{\\beta_{0i}} = \\gamma_{00} + \\color{orange}{\\zeta_{0i}} \\\\\n\\end{align}\n$$\n:::\n\n:::statbox\n__Random Intercepts and Slopes__  \nBy extension we can also allow the effect `y~x` to vary between groups, by including the `x` on the left hand side of `|` in the random effects part of the call to `lmer()`.\n\n<center>`lmer(y ~ 1 + x + (1 + x |g), data = df)`</center>\n$$\n\\begin{align}\n& \\text{Level 1:} \\\\\n& \\color{red}{y_{ij}} = \\color{blue}{\\beta_{0i} \\cdot 1 + \\beta_{1i} \\cdot x_{ij}} + \\varepsilon_{ij} \\\\\n& \\text{Level 2:} \\\\\n& \\color{blue}{\\beta_{0i}} = \\gamma_{00} + \\color{orange}{\\zeta_{0i}} \\\\\n& \\color{blue}{\\beta_{1i}} = \\gamma_{10} + \\color{orange}{\\zeta_{1i}} \\\\\n\\end{align}\n$$\n:::\n\n\n## Model Estimation\n\n### Maximum Likelihood (ML)  \n\nRemember back to DAPR2 when we introduced logistic regression, and we briefly discussed **Maximum likelihood** in an explanation of how models are fitted.  \n\nThe key idea of *maximum likelihood estimation* (MLE) is that we (well, the computer) iteratively finds the set of estimates for our model which it considers to best reproduce our observed data. Recall our simple linear regression model of how time spent outdoors (hrs per week) is associated with mental wellbeing: \n$$\n\\color{red}{Wellbeing_i} = \\color{blue}{\\beta_0 \\cdot{} 1 + \\beta_1 \\cdot{} OutdoorTime_{i}} + \\varepsilon_i\n$$\nThere are values of $\\beta_0$ and $\\beta_1$ and $\\sigma_\\varepsilon$ which maximise the probability of observing the data that we have. For linear regression, these we obtained these same values a different way, via minimising the sums of squares. And we saw that this is not possible for more complex models (e.g., logistic), which is where we turn to MLE.  \n\n:::statbox\nTo read about the subtle difference between \"likelihood\" and \"probability\", you can find a short explanation [here](./lvp.html){target=\"_blank\"}\n:::\n\nIf we are estimating just one single parameter (e.g. a mean), then we can imagine the process of *maximum likelihood estimation* in a one-dimensional world - simply finding the top of the curve: \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![MLE](images/intro/mle.png){#fig-mle fig-align='center' width=350px}\n:::\n:::\n\nHowever, our typical models estimate a whole bunch of parameters. The simple regression model above is already having to estimate $\\beta_0$, $\\beta_1$ and $\\sigma_\\varepsilon$, and our multi-level models have far more! With lots of parameters being estimated and all interacting to influence the likelihood, our nice curved line becomes a complex surface (see Left panel of @fig-multisurf). So what we (our computers) need to do is find the maximum, but avoid local maxima and singularities (see @fig-maxima). \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![MLE for a more complex model](images/multisurftb.png){#fig-multisurf fig-align='center' width=49%}\n:::\n:::\n\n\n### Restricted Maximum Likelihood (REML)\n\nWhen it comes to estimating multilevel models, maximum likelihood will consider the fixed effects as fixed, known values in its estimation of the variance components (the random effect variances). This leads to biased estimates of the variance components, specifically biasing them toward being too small, especially if $n_\\textrm{clusters} - n_\\textrm{level 2 predictors} - 1 < 50$. This leads to the standard errors of the fixed effects being too small, thereby inflating our type 1 error rate (i.e. greater chance of incorrectly rejecting our null hypothesis).  \n\nRestricted Maximum Likelihood (REML) is a method that separates the estimation of fixed and random parts of the model, leading to unbiased estimates of the variance components.   \n\n:::rtip\nWe can choose whether to fit with ML or REML with the `REML` argument of `lmer()`:  \n\n`lmer(formula, data = data.frame, **REML = TRUE/FALSE**)`\n\n`lmer()` models are by default fitted with REML. This is better for small samples.    \n:::\n\n\n<!-- :::sticky -->\n<!-- __Model Comparisons in MLM__ -->\n\n<!-- When we compare models that differ in their fixed effects via comparing model deviance (e.g. the likelihood ratio), REML should __not__ be used as only the variance components are included in the likelihood. Functions like `anova()` will automatically refit your models with `ML` for you, but it is worth checking.    -->\n\n<!-- We __cannot__ compare (either with ML or REML) models that differ in both the fixed and random parts.  -->\n\n<!-- ::: -->\n\n\n### Model Convergence\n\nFor large datasets and/or complex models (lots of random-effects terms), it is quite common to get a *convergence warning*.  There are lots of different ways to [deal with these](https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html) (to try to rule out hypotheses about what is causing them).  \n\nFor now, if `lmer()` gives you convergence errors, you could try changing the optimizer. Bobyqa is a good one: add `control = lmerControl(optimizer = \"bobyqa\")` when you run your model.  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlmer(y ~ 1 + x1 + ... + (1 + .... | g), data = df, \n     control = lmerControl(optimizer = \"bobyqa\"))\n```\n:::\n\n\n\n::: {.callout-note collapse=\"true\"}\n#### What *is* a convergence warning??\n\nThere are different techniques for maximum likelihood estimation, which we apply by using different 'optimisers'. Technical problems to do with **model convergence** and **'singular fit'** come into play when the optimiser we are using either can't find a suitable maximum, or gets stuck in a singularity (think of it like a black hole of likelihood, which signifies that there is not enough variation in our data to construct such a complex model).  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![local/global maxima and singularities](images/intro/mle2.png){#fig-maxima fig-align='center' width=49%}\n:::\n:::\n\n\n:::\n\n# Exercises: Intro MLM\n\n## Wellbeing Across Scotland (Cross-Sectional)\n\n:::frame\nRecall our dataset from last week, in which we used linear regression to determine how outdoor time (hours per week) is associated with wellbeing in different local authority areas (LAAs) of Scotland. We have data from various LAAs, from Glasgow City, to the Highlands.  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nscotmw <- read_csv(\"https://uoepsy.github.io/data/LAAwellbeing.csv\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div id=\"cszbzfmzgo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#cszbzfmzgo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#cszbzfmzgo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#cszbzfmzgo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#cszbzfmzgo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#cszbzfmzgo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#cszbzfmzgo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#cszbzfmzgo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#cszbzfmzgo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#cszbzfmzgo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#cszbzfmzgo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cszbzfmzgo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#cszbzfmzgo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#cszbzfmzgo .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#cszbzfmzgo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cszbzfmzgo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#cszbzfmzgo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#cszbzfmzgo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cszbzfmzgo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#cszbzfmzgo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cszbzfmzgo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#cszbzfmzgo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cszbzfmzgo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cszbzfmzgo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cszbzfmzgo .gt_left {\n  text-align: left;\n}\n\n#cszbzfmzgo .gt_center {\n  text-align: center;\n}\n\n#cszbzfmzgo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#cszbzfmzgo .gt_font_normal {\n  font-weight: normal;\n}\n\n#cszbzfmzgo .gt_font_bold {\n  font-weight: bold;\n}\n\n#cszbzfmzgo .gt_font_italic {\n  font-style: italic;\n}\n\n#cszbzfmzgo .gt_super {\n  font-size: 65%;\n}\n\n#cszbzfmzgo .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#cszbzfmzgo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#cszbzfmzgo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#cszbzfmzgo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#cszbzfmzgo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#cszbzfmzgo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#cszbzfmzgo .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"description\">description</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">ppt</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Participant ID</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">name</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Participant Name</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">laa</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Local Authority Area</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">outdoor_time</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Self report estimated number of hours per week spent outdoors</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">wellbeing</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">density</td>\n<td headers=\"description\" class=\"gt_row gt_left\">LAA Population Density (people per square km)</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n:::\n\n\n\n<div class='question-begin'>Question 1</div><div class='question-body'>\n\n\nUsing `lmer()` from the **lme4** package, fit a model predict `wellbeing` from `outdoor_time`, with by-LAA random intercepts.  \nPass the model to `summary()` to see the output. \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-1' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-1', 'sol-start-1')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-1\" style=\"display: none;\">\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lme4)\nri_model <- lmer(wellbeing ~ outdoor_time + (1 | laa), data = scotmw)\nsummary(ri_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: wellbeing ~ outdoor_time + (1 | laa)\n   Data: scotmw\n\nREML criterion at convergence: 866.6\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.2218 -0.7192  0.1217  0.6395  1.8287 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n laa      (Intercept) 106.23   10.307  \n Residual              25.46    5.046  \nNumber of obs: 132, groups:  laa, 20\n\nFixed effects:\n             Estimate Std. Error t value\n(Intercept)  38.18979    2.64778   14.42\noutdoor_time  0.21349    0.07236    2.95\n\nCorrelation of Fixed Effects:\n            (Intr)\noutdoor_tim -0.463\n```\n:::\n:::\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 2</div><div class='question-body'>\n\n\nSometimes the easiest way to start understanding your model is to visualise it. \n \nLoad the package **broom.mixed**. Along with some handy functions `tidy()` and `glance()` which give us the information we see in `summary()`, there is a handy function called `augment()` which returns us the data in the model plus the fitted values, residuals, hat values, Cook's D etc.. \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nri_model <- lmer(wellbeing ~ outdoor_time + (1 | laa), data = scotmw)\nlibrary(broom.mixed)\naugment(ri_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 132 × 14\n   wellbeing outdoor_t…¹ laa   .fitted .resid  .hat .cooksd .fixed   .mu .offset\n       <dbl>       <dbl> <fct>   <dbl>  <dbl> <dbl>   <dbl>  <dbl> <dbl>   <dbl>\n 1        37          20 West…    32.4  4.64  0.139 7.91e-2   42.5  32.4       0\n 2        34          23 Falk…    31.7  2.28  0.192 3.00e-2   43.1  31.7       0\n 3        39          29 Falk…    33.0  6.00  0.195 2.13e-1   44.4  33.0       0\n 4        42          21 Scot…    40.1  1.95  0.163 1.74e-2   42.7  40.1       0\n 5        37          10 Dumf…    37.4 -0.407 0.167 7.84e-4   40.3  37.4       0\n 6        42          19 Argy…    43.9 -1.91  0.122 1.12e-2   42.2  43.9       0\n 7        38          13 Pert…    46.1 -8.06  0.139 2.39e-1   41.0  46.1       0\n 8        44          21 East…    44.4 -0.414 0.168 8.17e-4   42.7  44.4       0\n 9        47          16 Inve…    42.7  4.30  0.193 1.07e-1   41.6  42.7       0\n10        35          12 Midl…    33.1  1.94  0.161 1.69e-2   40.8  33.1       0\n# … with 122 more rows, 4 more variables: .sqrtXwt <dbl>, .sqrtrwt <dbl>,\n#   .weights <dbl>, .wtres <dbl>, and abbreviated variable name ¹​outdoor_time\n```\n:::\n:::\n\n\nAdd to the code below to plot the model fitted values, and color them according to LAA. \n(you will need to edit `ri_model` to be whatever name you assigned to your model).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\naugment(ri_model) %>%\n  ggplot(aes(x = outdoor_time, y = ...... \n```\n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-2' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-2', 'sol-start-2')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-2\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\naugment(ri_model) %>%\n  ggplot(aes(x = outdoor_time, y = .fitted, col = laa)) + \n  geom_line()\n```\n\n::: {.cell-output-display}\n![](02_intromlm_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 3</div><div class='question-body'>\n\n\nWe have just fitted the model:\n$$\n\\begin{align}\n& \\text{For person } j \\text{ in LAA } i \\\\\n& \\color{red}{\\textrm{Wellbeing}_{ij}}\\color{black} = \\color{blue}{\\beta_{0i} \\cdot 1 + \\beta_{1} \\cdot \\textrm{Outdoor Time}_{ij}}\\color{black} + \\varepsilon_{ij} \\\\\n& \\color{blue}{\\beta_{0i}}\\color{black} = \\gamma_{00} + \\color{orange}{\\zeta_{0i}} \\\\\n\\end{align}\n$$\n\nFor our estimates of $\\gamma_{00}$ (the fixed value around which LAA intercepts vary) and $\\beta_1$ (the fixed estimate of the relationship between wellbeing and outdoor time), we can use `fixef()`.  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfixef(ri_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n (Intercept) outdoor_time \n   38.189795     0.213492 \n```\n:::\n:::\n\nCan you add to the plot in the previous question, a thick black line with the intercept and slope given by `fixef()`?  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\n**Hint:** `geom_abline()`\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-3' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-3', 'sol-start-3')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-3\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\naugment(ri_model) %>%\n  ggplot(aes(x = outdoor_time, y = .fitted, col = laa)) + \n  geom_line() + \n  geom_abline(intercept = fixef(ri_model)[1], slope = fixef(ri_model)[2], lwd = 2)\n```\n\n::: {.cell-output-display}\n![](02_intromlm_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 4</div><div class='question-body'>\n\n\nBy now, you should have a plot which looks more or less like the left-hand figure below (we have added on the raw data - the points).  \n<div style=\"display:inline-block; width: 55%;vertical-align: top;\">\n\n::: {.cell layout-align=\"center\" fig.asp='1'}\n::: {.cell-output-display}\n![Model fitted values](02_intromlm_files/figure-html/fig-modfit-1.png){#fig-modfit fig-align='center' width=80%}\n:::\n:::\n\n</div>\n<div style=\"display:inline-block; width: 40%;vertical-align: top;\">\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Summary model output<br>lmer(wellbeing~1 + outdoor_time + (1|laa),<br>data = scotmw)](images/intro/summarylmer2.png){#fig-lmersummap fig-align='center' width=400px}\n:::\n:::\n\n</div>\n<br>\n<br>\nWe're going to map the parts of the plot in @fig-modfit to the `summary()` output of the model in @fig-lmersummap. Match the coloured sections Red, Orange, Yellow and Blue in @fig-lmersummap to the descriptions below of @fig-modfit A through D. \n\nA) where the black line cuts the y axis\nB) the standard deviation of the distances from all the individual LAA lines to the black line\nC) the slope of the black line\nD) the standard deviation of the distances from all the individual observations to the line for the LAA to which it belongs.\n\nCan you also match those same coloured sections in @fig-lmersummap to the mathematical terms in the model equation:  \n\n$$\n\\begin{align}\n& \\text{Level 1:} \\\\\n& \\color{red}{Wellbeing_{ij}}\\color{black} = \\color{blue}{\\beta_{0i} \\cdot 1 + \\beta_{1} \\cdot OutdoorTime_{ij}}\\color{black} + \\varepsilon_{ij} \\\\\n& \\text{Level 2:} \\\\\n& \\color{blue}{\\beta_{0i}}\\color{black} = \\gamma_{00} + \\color{orange}{\\zeta_{0i}} \\\\\n\\quad \\\\\n& \\text{where} \\\\\n& \\color{orange}{\\zeta_0}\\color{black} \\sim N(0, \\sigma_{\\color{orange}{\\zeta_{0}}}\\color{black})  \\text{ independently} \\\\\n& \\varepsilon \\sim N(0, \\sigma_{\\varepsilon}) \\text{ independently} \\\\\n\\end{align}\n$$\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-4' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-4', 'sol-start-4')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-4\" style=\"display: none;\">\n\n\n\n+ Yellow = B = $\\sigma_{\\color{orange}{\\zeta_{0}}}$\n+ Red = D = $\\sigma_{\\varepsilon}$    \n+ Blue = A = $\\gamma_{00}$  \n+ Orange = C = $\\beta_{1}$     \n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 5</div><div class='question-body'>\n\n\nFit a model which allows *also* (along with the intercept) the effect of `outdoor_time` to vary by-LAA.   \n\nThen, using `augment()` again, plot the model fitted values. What do you think you will see?  \nDoes it look like this model better represents the individual LAAs? Take a look at, for instance, Glasgow City.  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-5' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-5', 'sol-start-5')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-5\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrs_model <- lmer(wellbeing ~ 1 + outdoor_time + (1 + outdoor_time | laa), data = scotmw)\n\naugment(rs_model) %>%\n  ggplot(aes(x = outdoor_time, y = .fitted, col = laa)) + \n  geom_line() + \n  geom_point(aes(y=wellbeing), alpha=.4)\n```\n\n::: {.cell-output-display}\n![](02_intromlm_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n## Audio Interference in Executive Functioning (Rpt Measures)  \n\nWhile the wellbeing example considers the groupings or 'clusters' of different LAAs, a more relate-able grouping in psychological research is that of several observations belonging to the same individual. One obvious benefit of this is that we can collect many more observations with fewer participants but control for the resulting dependency of observations. \n\n:::frame\n\nRecall the data from the previous week, from an experiment in which executive functioning was measured (via the SDMT) for people when listening to different types of audio, either via normal speakers or via noise-cancelling headphones.  \n\nThis week, we have data from a replication of that study, in which the researchers managed to recruit 30 participants. Unfortunately, some participants did not complete all the trials, so we have an unbalanced design. The data is available at [https://uoepsy.github.io/data/ef_replication.csv](https://uoepsy.github.io/data/ef_replication.csv).  \n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div id=\"fptnpbqagc\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#fptnpbqagc .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fptnpbqagc .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fptnpbqagc .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fptnpbqagc .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fptnpbqagc .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fptnpbqagc .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fptnpbqagc .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fptnpbqagc .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fptnpbqagc .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fptnpbqagc .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fptnpbqagc .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fptnpbqagc .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fptnpbqagc .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fptnpbqagc .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fptnpbqagc .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fptnpbqagc .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fptnpbqagc .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fptnpbqagc .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fptnpbqagc .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fptnpbqagc .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fptnpbqagc .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fptnpbqagc .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fptnpbqagc .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fptnpbqagc .gt_left {\n  text-align: left;\n}\n\n#fptnpbqagc .gt_center {\n  text-align: center;\n}\n\n#fptnpbqagc .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fptnpbqagc .gt_font_normal {\n  font-weight: normal;\n}\n\n#fptnpbqagc .gt_font_bold {\n  font-weight: bold;\n}\n\n#fptnpbqagc .gt_font_italic {\n  font-style: italic;\n}\n\n#fptnpbqagc .gt_super {\n  font-size: 65%;\n}\n\n#fptnpbqagc .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#fptnpbqagc .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fptnpbqagc .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fptnpbqagc .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fptnpbqagc .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fptnpbqagc .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fptnpbqagc .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"variable\">variable</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"description\">description</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">PID</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Participant ID</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">trial_n</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Trial Number (1-15)</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">audio</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Audio heard during the test ('no_audio', 'white_noise','music')</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">headphones</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Whether the participant listened via speakers in the room or via noise cancelling headphones</td></tr>\n    <tr><td headers=\"variable\" class=\"gt_row gt_left\">SDMT</td>\n<td headers=\"description\" class=\"gt_row gt_left\">Symbol Digit Modalities Test (SDMT) score</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\n\n\n<div class='question-begin'>Question 6</div><div class='question-body'>\n\n\nHow many participants are there in the data?   \nHow many have complete data (15 trials)?  \nWhat is the average number of trials that participants completed? What is the minimum?   \nDoes every participant have _some_ data for each type of audio?  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\nThe `count()` function will likely be useful here. \n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-6' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-6', 'sol-start-6')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-6\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nefdata <- read_csv(\"https://uoepsy.github.io/data/ef_replication.csv\")\n```\n:::\n\n\nHere are the counts of trials for each participant. We can see that no participant completed all 15 trials. Everyone completed at least 10, and the median was 12. \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nefdata %>% \n  count(PID) %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     PID                  n     \n Length:30          Min.   :10  \n Class :character   1st Qu.:11  \n Mode  :character   Median :12  \n                    Mean   :12  \n                    3rd Qu.:13  \n                    Max.   :14  \n```\n:::\n:::\n\n\nWe can add in `audio` to our counting to see that everyone has data from $\\geq 2$ trials for a given audio type.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nefdata %>% \n  count(PID,audio) %>%\n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     PID                    audio          n    \n Length:90          no_audio   :30   Min.   :2  \n Class :character   white_noise:30   1st Qu.:4  \n Mode  :character   music      :30   Median :4  \n                                     Mean   :4  \n                                     3rd Qu.:5  \n                                     Max.   :5  \n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 7</div><div class='question-body'>\n\n\nSet the reference levels of the `audio` and `headphones` variables to \"no audio\" and \"speakers\" respectively.    \nFit a multilevel model to address the research question below.  \n\n> How do different types of audio interfere with executive functioning, and does this interference differ depending upon whether or not noise-cancelling headphones are used? \n \n\n::: {.callout-tip collapse=\"true\"}\n#### things to think about:  \n\n- what is our outcome variable of interest?\n- what are our predictor variables that we are interested in?\n    - these should be in the fixed effects part.    \n- what is the clustering?\n    - this should be the random effects `(1 | cluster)` part\n- does audio type (`audio`) vary within clusters, or between?\n    - if so, we might be able to fit a random slope of `audio | cluster`. if not, then it doesn't make sense to do so.  \n- does delivery mode (`headphones`) vary within clusters, or between?\n      - if so, we might be able to fit a random slope of `headphones | cluster`. if not, then it doesn't make sense to do so. \n\n\n_If you get an error about model convergence, consider changing the optimiser (see [above](02_intromlm.html#Estimation))_\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-7' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-7', 'sol-start-7')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-7\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nefdata <- efdata %>%\n  mutate(\n    audio = fct_relevel(factor(audio), \"no_audio\"),\n    headphones = fct_relevel(factor(headphones), \"speakers\")\n  )\n\n\nsdmt_mod <- lmer(SDMT ~ audio * headphones + \n              (1 + audio | PID), data = efdata,\n              REML = TRUE, control = lmerControl(optimizer=\"bobyqa\"))\nsummary(sdmt_mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: SDMT ~ audio * headphones + (1 + audio | PID)\n   Data: efdata\nControl: lmerControl(optimizer = \"bobyqa\")\n\nREML criterion at convergence: 2376.2\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.34520 -0.62861  0.05762  0.60807  2.21250 \n\nRandom effects:\n Groups   Name             Variance Std.Dev. Corr       \n PID      (Intercept)      51.17    7.153               \n          audiowhite_noise 15.22    3.901    -0.25      \n          audiomusic       13.69    3.700     0.03 -0.16\n Residual                  31.49    5.612               \nNumber of obs: 360, groups:  PID, 30\n\nFixed effects:\n                                          Estimate Std. Error t value\n(Intercept)                               33.25800    1.98899  16.721\naudiowhite_noise                          -0.03044    1.44501  -0.021\naudiomusic                                -8.01731    1.41148  -5.680\nheadphonesanc_headphones                   6.85313    2.81173   2.437\naudiowhite_noise:headphonesanc_headphones  8.02458    2.04497   3.924\naudiomusic:headphonesanc_headphones       -3.58747    2.00128  -1.793\n\nCorrelation of Fixed Effects:\n            (Intr) adwht_ audmsc hdphn_ adw_:_\naudiowht_ns -0.352                            \naudiomusic  -0.174  0.192                     \nhdphnsnc_hd -0.707  0.249  0.123              \nadwht_ns:h_  0.249 -0.707 -0.136 -0.351       \nadmsc:hdph_  0.123 -0.135 -0.705 -0.173  0.191\n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 8</div><div class='question-body'>\n\n\nWe now have a model, but we don't have any p-values, confidence intervals, or inferential criteria on which to draw conclusions.  \n\nPick a method of your choosing and perform a test of/provide an interval for the relevant effect of interest.  \nProvide a brief write-up of the results along with a visualisation.  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Options\n\nAs with normal regression, we have two main ways in which we can conduct inference. We can focus on our coefficients, or we can compare models.  \n\nThere are a whole load of different methods available for drawing inferences from multilevel models, which means it can be a bit of a never-ending rabbit hole. For the purposes of this course, we'll limit ourselves to these two:  \n\n\n|                  | df approximations                                                  | likelihood-based                                                     |   |\n| ---------------- | ------------------------------------------------------------------ | -------------------------------------------------------------------- | \n| model parameters | `library(parameters)`<br>`model_parameters(model, ci_method=\"kr\")` | `confint(model, type=\"profile\")`                                     |    \n| model comparison | `library(pbkrtest)`<br>`KRmodcomp(model1,model0)`                  | `anova(model0,model)`                                                | \n|                  | fit models with `REML=TRUE`.<br>good option for small samples      | fit models with `REML=FALSE`.<br>needs large N at both levels (40+) |  \n\n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-8' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-8', 'sol-start-8')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-8\" style=\"display: none;\">\n\n\n\n\nIn this case we have $n=30$ participants (our level 2 sample size), and each participant has at most 15 observations (and some have fewer). These numbers are possibly a bit small for standard likelihood based methods. We would be better off using models fitted with REML because they will provide more accurate estimates of the variance components (the `(1 + audio | PID)` bit), and so better estimates of the standard errors for our fixed effects. \n\nThe easiest option here is to use the __parameters__ package:  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(parameters)\nmodel_parameters(sdmt_mod, ci_method=\"kr\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# Fixed Effects\n\nParameter                                         | Coefficient |   SE |          95% CI |     t |    df |      p\n-----------------------------------------------------------------------------------------------------------------\n(Intercept)                                       |       33.26 | 1.99 | [ 29.18, 37.34] | 16.71 | 27.97 | < .001\naudio [white_noise]                               |       -0.03 | 1.45 | [ -3.00,  2.94] | -0.02 | 27.59 | 0.983 \naudio [music]                                     |       -8.02 | 1.41 | [-10.92, -5.12] | -5.67 | 27.42 | < .001\nheadphones [anc_headphones]                       |        6.85 | 2.81 | [  1.09, 12.62] |  2.44 | 27.94 | 0.021 \naudio [white_noise] × headphones [anc_headphones] |        8.02 | 2.05 | [  3.83, 12.22] |  3.92 | 27.73 | < .001\naudio [music] × headphones [anc_headphones]       |       -3.59 | 2.00 | [ -7.69,  0.52] | -1.79 | 27.77 | 0.084 \n\n# Random Effects\n\nParameter                              | Coefficient |   SE |        95% CI\n---------------------------------------------------------------------------\nSD (Intercept: PID)                    |        7.15 | 1.11 | [ 5.28, 9.69]\nSD (audiowhite_noise: PID)             |        3.90 | 1.04 | [ 2.31, 6.58]\nSD (audiomusic: PID)                   |        3.70 | 1.10 | [ 2.07, 6.62]\nCor (Intercept~audiowhite_noise: PID)  |       -0.25 | 0.31 | [-0.72, 0.37]\nCor (Intercept~audiomusic: PID)        |        0.03 | 0.32 | [-0.53, 0.58]\nCor (audiowhite_noise~audiomusic: PID) |       -0.16 | 0.41 | [-0.76, 0.58]\nSD (Residual)                          |        5.61 | 0.24 | [ 5.16, 6.10]\n```\n:::\n:::\n\n\nAnd if we want to go down the model comparison route, we just need to isolate the relevant part(s) of the model that we are interested in. \nFor instance, to test the interaction:  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsdmt_res <- lmer(SDMT ~ audio + headphones + \n              (1 + audio | PID), data = efdata,\n              REML = TRUE, control = lmerControl(optimizer=\"bobyqa\"))\nlibrary(pbkrtest)\nKRmodcomp(largeModel = sdmt_mod, smallModel = sdmt_res)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nlarge : SDMT ~ audio * headphones + (1 + audio | PID)\nsmall : SDMT ~ audio + headphones + (1 + audio | PID)\n        stat    ndf    ddf F.scaling   p.value    \nFtest 10.637  2.000 26.756   0.96406 0.0003987 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n:::int\nInclusion of the interaction between headphones and audio-type was found to improve model fit ($F(2, 26.8^*) = 10.64, p < .001$). \n\nWhen listening via speakers, music (but not white noise) was associated with lower scores on the SDMT (TODO) compared to no audio. Wearing ANC-headphones (but not listening to any audio) was associated with higher SDMT scores (TODO) compared to no headphones. This was also evidenced when listening to white-noise (TODO). The apparent detrimental influence of music was not found to differ depending on whether headphones were worn (TODO). These results are displayed in @fig-efplot.  \n$\\textrm{ }^*$: denominator degrees of freedom approximated using Kenward-Rogers method.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(sjPlot)\nplot_model(sdmt_mod, type=\"int\")\n```\n\n::: {.cell-output-display}\n![Interaction between the type (no audio/white noise/music) and the delivery (speakers/ANC headphones) on executive functioning task (SDMT)](02_intromlm_files/figure-html/fig-efplot-1.png){#fig-efplot fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n:::\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n## Wellbeing Over Time (Longitudinal)  \n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\nAnother very crucial advantage of these methods is that we can use them to study how people change over time.  \n\n:::frame\n__Wellbeing in Work: Longitudinal Data__  \n\nThe \"Wellbeing in Work\" dataset contains information on employees who were randomly assigned to one of three employment conditions:\n\n* control: No change to employment. Employees continue at 5 days a week, with standard allocated annual leave quota.    \n* unlimited_leave : Employees were given no limit to their annual leave, but were still expected to meet required targets as specified in their job description. \n* fourday_week: Employees worked a 4 day week for no decrease in pay, and were still expected to meet required targets as specified in their job description.\n\nWellbeing was was assessed at baseline (start of maintenance), 12 months post, 24 months post, and 36 months post.  \n\nThe researchers had two main questions: \n\n- Q1): Overall, did the participants' wellbeing stay the same or did it change?\n- Q2): Did the employment condition groups differ in the how wellbeing changed over the assessment period?   \n\nThe data is available, in **.rda** format, at [https://uoepsy.github.io/data/wellbeingwork3.rda](https://uoepsy.github.io/data/wellbeingwork3.rda). You can read it directly into your R environment using: \n\n::: {.cell layout-align=\"center\" code-copy='true'}\n\n```{.r .cell-code}\nload(url(\"https://uoepsy.github.io/data/wellbeingwork3.rda\"))\n```\n:::\n\nAfter running the code above you will find the data in an object called `wellbeingwork3` in your environment.  \n\n:::\n\n\n\n<div class='question-begin'>Question 9</div><div class='question-body'>\n\n  \n\n> Q1): Overall, did the participants' wellbeing stay the same or did it change?  \n\n\nEach of our participants have measurements at 4 assessments. \nWe need to think about what this means for the **random effects** that we will include in our model (our **random effect structure**). Would we like our models to accommodate individuals to vary in their overall wellbeing, to vary in how they change in wellbeing over the course of the assessment period, or both?\n\nTo investigate whether wellbeing changed over the course of the assessments, or whether it stayed the same, we can fit and compare 2 models:  \n\n1. The \"null\" or \"intercept-only\" model. \n2. A model with wellbeing predicted by time point.  \n\nAnd we can then compare them in terms of model fit (as mentioned above, there are lots of different ways we might do this).  \n\nOur sample size here (180 participants, each with 4 observations) is reasonably large given the relative simplicity of our model. We might consider running a straightforward Likelihood Ratio Test using `anova(restricted_model, full_model)` to compare our two models (in which case we should fit them with `REML=FALSE`)\n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\n- Remember, we shouldn't use likelihood ratio tests to compare models with different random effect structures.  \n- (For now, don't worry too much about \"singular fits\". We'll talk more about how we might deal with them next week!)\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-9' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-9', 'sol-start-9')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-9\" style=\"display: none;\">\n\n\n\nThis is our null model:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm.null <- lmer(Wellbeing ~ 1 + (1 | ID), data=wellbeingwork3, REML=FALSE)\nsummary(m.null)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by maximum likelihood  ['lmerMod']\nFormula: Wellbeing ~ 1 + (1 | ID)\n   Data: wellbeingwork3\n\n     AIC      BIC   logLik deviance df.resid \n  4400.8   4414.6  -2197.4   4394.8      717 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.5224 -0.6067 -0.0426  0.5918  3.6020 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n ID       (Intercept)  4.762   2.182   \n Residual             22.479   4.741   \nNumber of obs: 720, groups:  ID, 180\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  40.0431     0.2402   166.7\n```\n:::\n:::\n\nWe can see the `4.76 / (4.76 + 22.48)`, or 0.17 of the total variance is attributable to participant-level variation. \n\nNow lets suppose we want to compare this null model with a model with an effect of `TimePoint` (to assess whether there is overall change over time).\nWhich model should we compare `m.null` to?  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodA <- lmer(Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID), data=wellbeingwork3, REML=FALSE)\nmodB <- lmer(Wellbeing ~ 1 + TimePoint + (1 | ID), data=wellbeingwork3, REML=FALSE)\n```\n:::\n\nA comparison between these `m.null` and `modA` will not be assessing the influence of _only_ the fixed effect of TimePoint (remember, we shouldn't compare models that differ in both fixed and random effects)  \nHowever, `modB` doesn't include our by-participant random effects of timepoint, so comparing this to `m.null` is potentially going to mis-attribute random deviations in participants' change to being an overall effect of timepoint.  \n\nIf we want to conduct a model comparison to isolate the effect of overall change over time (a fixed effect of `TimePoint`), we _might_ want to compare these two models:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm.base0 <- lmer(Wellbeing ~ 1 + (1 + TimePoint | ID), data=wellbeingwork3, REML=FALSE)\nm.base <- lmer(Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID), data=wellbeingwork3, REML=FALSE)\n```\n:::\n\nThe first of these models is a bit weird to think about - how can we have by-participant random deviations of `TimePoint` if we don't have a fixed effect of `TimePoint`? That makes very little sense. What it is actually fitting is a model where there is assumed to be __no overall effect__ of TimePoint. So the fixed effect is 0. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Straightforward LRT\nanova(m.base0, m.base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: wellbeingwork3\nModels:\nm.base0: Wellbeing ~ 1 + (1 + TimePoint | ID)\nm.base: Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID)\n        npar    AIC    BIC  logLik deviance  Chisq Df Pr(>Chisq)    \nm.base0    5 4202.4 4225.2 -2096.2   4192.4                         \nm.base     6 4171.7 4199.2 -2079.8   4159.7 32.649  1  1.104e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class='question-begin'>Question 10</div><div class='question-body'>\n\n\n\n> Q: Did the employment condition groups differ in the how wellbeing changed over the assessment period?   \n\n:::hints\n**Hint:** It helps to break it down. There are two questions here:  \n\n  1. do groups differ overall?  \n  2. do groups differ over time?  \n\nWe can begin to see that we're asking two questions about the `Condition` variable here: \"is there an effect of Condition?\" and \"Is there an interaction between TimePoint and Condition?\".  \n\nTry fitting two more models which incrementally build these levels of complexity, and compare them (perhaps to one another, perhaps to models from the previous question - think about what each comparison is testing!)  \n:::\n  \n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-10' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-10', 'sol-start-10')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-10\" style=\"display: none;\">\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm.int <- lmer(Wellbeing ~ 1 + TimePoint + Condition + (1 + TimePoint | ID), \n              data=wellbeingwork3, REML=FALSE)\nm.full <- lmer(Wellbeing ~ 1+ TimePoint*Condition + (1 + TimePoint | ID), \n               data=wellbeingwork3, REML=FALSE)\n```\n:::\n\n\nWe're going to compare each model to the previous one to examine the improvement in fit due to inclusion of each parameter. \nWe could do this quickly with\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(m.base0, m.base, m.int, m.full)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: wellbeingwork3\nModels:\nm.base0: Wellbeing ~ 1 + (1 + TimePoint | ID)\nm.base: Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID)\nm.int: Wellbeing ~ 1 + TimePoint + Condition + (1 + TimePoint | ID)\nm.full: Wellbeing ~ 1 + TimePoint * Condition + (1 + TimePoint | ID)\n        npar    AIC    BIC  logLik deviance  Chisq Df Pr(>Chisq)    \nm.base0    5 4202.4 4225.2 -2096.2   4192.4                         \nm.base     6 4171.7 4199.2 -2079.8   4159.7 32.649  1  1.104e-08 ***\nm.int      8 4164.3 4200.9 -2074.2   4148.3 11.393  2   0.003358 ** \nm.full    10 4144.6 4190.4 -2062.3   4124.6 23.711  2  7.098e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n:::int \nConditions differed overall in wellbeing change $\\chi^2(2)=11.39, p = .003$  \nConditions differed in change over assessment period $\\chi^2(2)=23.71, p < .001$\n:::\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 11</div><div class='question-body'>\n\n\n\nVisualise the model estimated change in wellbeing over time for each Condition.  \n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\nThere are lots of ways you can visualise the model, try a couple: \n\n1. Using the **effects** package, this might help: `as.data.frame(effect(\"TimePoint:Condition\", model))`  \n2. We can also use **sjPlot**, as we have seen in DAPR2  \n\n:::\n\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-11' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-11', 'sol-start-11')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-11\" style=\"display: none;\">\n\n\n\nUsing the `effect()` function (and then adding the means and SEs from the original data):  \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nef <- as.data.frame(effect(\"TimePoint:Condition\", m.full))\n\nggplot(ef, aes(TimePoint, fit, color=Condition)) + \n  geom_line() +\n  geom_ribbon(aes(ymin=lower,ymax=upper,fill=Condition), alpha=.2)+\n  stat_summary(data=wellbeingwork3, aes(y=Wellbeing), \n               fun.data=mean_se, geom=\"pointrange\", size=1) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](02_intromlm_files/figure-html/unnamed-chunk-34-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\nAdditionally, __sjPlot__ can give us the model fitted values, but it's trickier to add on the observed means. We can add the raw data using `show.data=TRUE`, but that will make it a bit messier\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(sjPlot)\nplot_model(m.full, type=\"int\")\n```\n\n::: {.cell-output-display}\n![](02_intromlm_files/figure-html/unnamed-chunk-35-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n\n<div class='question-begin'>Question 12</div><div class='question-body'>\n\n\n\nExamine the parameter estimates and interpret them (i.e., what does each parameter represent?  \nCan you match them with parts of the plot obtained from `plot_model(m.full, type=\"int\")`?  \n\n\n::: {.callout-tip collapse=\"true\"}\n#### Hints\n\nWe can get the fixed effects using `fixef(model)`, and we can also use `tidy(model)` from the **broom.mixed** package, and similar to `lm` models in DAPR2, we can pull out the bit of the `summary()` using `summary(model)$coefficients`.   \n\n\n:::\n\n\n\n</div><p class=\"question-end\"></p>\n\n\n\n\n<div class=\"solution-begin\"><span id='sol-start-12' class=\"fa-solid fa-circle-right solution-icon clickable\" onclick=\"toggle_visibility('sol-body-12', 'sol-start-12')\">  Solution </span></div><div class=\"solution-body\" id = \"sol-body-12\" style=\"display: none;\">\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n                                   Estimate Std. Error t value\n(Intercept)                          38.352      0.394  97.270\nTimePoint                            -0.023      0.322  -0.072\nConditionunlimited_leave             -0.018      0.558  -0.033\nConditionfourday_week                -0.260      0.558  -0.466\nTimePoint:Conditionunlimited_leave    1.357      0.456   2.976\nTimePoint:Conditionfourday_week       2.282      0.456   5.005\n```\n:::\n:::\n\n\n* `(Intercept)` ==> Wellbeing at baseline in 'control' group.  \n* `TimePoint`  ==> Slope of welleing change in 'control' group.  \n* `Conditionunlimited_leave` ==> baseline wellbeing difference from 'unlimited_leave' group relative to 'control' group.  \n* `Conditionfourday_week` ==> baseline wellbeing difference from 'fourday_week' group relative to 'control' group.  \n* `TimePoint:Conditionunlimited_leave`  ==> slope of wellbeing change in 'unlimited_leave' group relative to 'control' group.  \n* `TimePoint:Conditionfourday_week`  ==> slope of wellbeing change in 'fourday_week' group relative to 'control' group.  \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_model(m.full, type=\"int\")\n```\n\n::: {.cell-output-display}\n![Well-being over time, for employees working in different conditions](02_intromlm_files/figure-html/fig-wblplot-1.png){#fig-wblplot fig-align='center' width=80%}\n:::\n:::\n\n\n* `(Intercept)` ==> the height of the red line at timepoint 0.  \n* `TimePoint`  ==> slope of the red line (basically flat).  \n* `Conditionunlimited_leave` ==> the difference at timepoint 0 in height of the blue line from height of the red line (basically 0, but blue line starts ever so slightly below the red).   \n* `Conditionfourday_week` ==> the difference at timepoint 0 in height of the green line from height of the red line (also very small, but it is a bit further below the red than the blue is).   \n* `TimePoint:Conditionunlimited_leave` ==> the difference from slope of red line to slope of blue line. i.e. while the red line goes -0.023 for every 1 across, the blue line goes $-0.023+1.357=1.334$ up for every 1 across.  \n* `TimePoint:Conditionfourday_week`  ==> difference from slope of red line to slope of green line. i.e. while the red line goes -0.023 for every 1 across, the green line goes $-0.023+2.282=2.259$ up for every 1 across. \n\n\n:::int\nCompared to the control group, wellbeing increased by 1.36 points/year more for employees with unlimited leave, and by 2.28 points/year for employees on the 4 day week.  \n:::\n\n\n\n\n</div><p class=\"solution-end\"></p>\n\n\n\n\n\n<div class=\"tocify-extend-page\" data-unique=\"tocify-extend-page\" style=\"height: 0;\"></div>",
    "supporting": [
      "02_intromlm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}