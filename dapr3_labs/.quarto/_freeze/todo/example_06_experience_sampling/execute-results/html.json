{
  "hash": "6b4070e02d7010ad6a5c59df110653f5",
  "result": {
    "markdown": "---\ntitle: \"Analysis Example 6: Experience Sampling\"\nlink-citations: yes\ncode-fold: true\nparams: \n    SHOW_SOLS: TRUE\n    TOGGLE: TRUE\n---\n\n\n\n\n:::frame\n\nEach of these pages provides an analysis run through for a different type of design. Each document is structured in the same way:  \n\n  - First the data is introduced. For the purpose of these tutorials, I will only use examples where the data can be shared - either because it is from an open access publication, or because it is unpublished or simulated. \n  - Second, the structure of the data is discussed so that we can more easily see what data structure the design creates, and how this aligns to the variables in the data.\n  - Third, we translate the research questions into formal equations, and then `lmer()` code. \n  - Finally, we will follow those through for our example data.\n\n:::\n\n## The example\nThis example comes from a study by Dr. Jessie Sun and colleagues. The full original article is available here[https://osf.io/yn3ac/]. For the purpose of this introductory example, we will use a subset of this data (from Study 3) that Dr. Sun shared via twitter, and that she uses for her teaching. \n\n## Data structure\nThe data comes from an experience sampling study. The subset we are going to use has measures of positive affect (PA) and extraversion (E) measured on multiple occasions. Our interes is on the within person association between PA and E.\n\n# Model specification\n\n## Equations\nIn this particular model \n\n# Analysis\n\n## Tidy data\nOK, as a first step, we read the data in. Here we are reading a .csv file direct from the web:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndat <- read_csv('https://osf.io/hwsxa/download')\n```\n:::\n\n\nThis data set is the full data set for the study. If you want to try and recreate more of the analyses from the paper, you will want to skip this step, as here we are cutting down to just the four variables of interest.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# subset to fewer variables\ndat2 <- \n  dat %>% \n  select(id, obs, e, pa)\n```\n:::\n\n\n## Centering\nNow, this is the step that is of specific interest given our discussions in lecture 4. For experience sampling data, it is often desirable to partition the variance in an individual's scores into what might be best considered their \"trait\" and \"state\" responses. Typically we operationalise trait as a persons mean score across all prompts, and their state score as mean centered responses. That is, state scores assess how someone differs from their own personal average.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Center the predictor variable (state extraversion)\n# around each person's mean\n\ndat2 <- \n  dat2 %>%\n  group_by(id) %>%\n  mutate(\n    e.m = mean(e, na.rm = TRUE),\n    e.c = e - mean(e, na.rm = TRUE)\n  )\n```\n:::\n\n\n## Describe\nNow we can take a look at our key variables of interest. First numerically\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndescriptive <- \n  dat2 %>%\n  group_by(id) %>%\n  summarise(\n    mean.e = mean(e, na.rm = TRUE),\n    sd.e = sd(e, na.rm = TRUE),\n    mean.pa = mean(e, na.rm = TRUE),\n    sd.pa = sd(e, na.rm = TRUE)\n  )\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(kableExtra)\nkable(round(descriptive,2)) %>%\n  kable_styling(\"striped\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> mean.e </th>\n   <th style=\"text-align:right;\"> sd.e </th>\n   <th style=\"text-align:right;\"> mean.pa </th>\n   <th style=\"text-align:right;\"> sd.pa </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 4.32 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n   <td style=\"text-align:right;\"> 4.32 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 4.86 </td>\n   <td style=\"text-align:right;\"> 1.35 </td>\n   <td style=\"text-align:right;\"> 4.86 </td>\n   <td style=\"text-align:right;\"> 1.35 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 4.52 </td>\n   <td style=\"text-align:right;\"> 2.31 </td>\n   <td style=\"text-align:right;\"> 4.52 </td>\n   <td style=\"text-align:right;\"> 2.31 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 2.90 </td>\n   <td style=\"text-align:right;\"> 1.81 </td>\n   <td style=\"text-align:right;\"> 2.90 </td>\n   <td style=\"text-align:right;\"> 1.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 3.39 </td>\n   <td style=\"text-align:right;\"> 2.01 </td>\n   <td style=\"text-align:right;\"> 3.39 </td>\n   <td style=\"text-align:right;\"> 2.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 3.46 </td>\n   <td style=\"text-align:right;\"> 2.32 </td>\n   <td style=\"text-align:right;\"> 3.46 </td>\n   <td style=\"text-align:right;\"> 2.32 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 2.70 </td>\n   <td style=\"text-align:right;\"> 1.76 </td>\n   <td style=\"text-align:right;\"> 2.70 </td>\n   <td style=\"text-align:right;\"> 1.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 4.69 </td>\n   <td style=\"text-align:right;\"> 2.17 </td>\n   <td style=\"text-align:right;\"> 4.69 </td>\n   <td style=\"text-align:right;\"> 2.17 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 4.47 </td>\n   <td style=\"text-align:right;\"> 2.19 </td>\n   <td style=\"text-align:right;\"> 4.47 </td>\n   <td style=\"text-align:right;\"> 2.19 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:right;\"> 4.63 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n   <td style=\"text-align:right;\"> 4.63 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 2.59 </td>\n   <td style=\"text-align:right;\"> 2.51 </td>\n   <td style=\"text-align:right;\"> 2.59 </td>\n   <td style=\"text-align:right;\"> 2.51 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 4.75 </td>\n   <td style=\"text-align:right;\"> 1.33 </td>\n   <td style=\"text-align:right;\"> 4.75 </td>\n   <td style=\"text-align:right;\"> 1.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 1.62 </td>\n   <td style=\"text-align:right;\"> 2.21 </td>\n   <td style=\"text-align:right;\"> 1.62 </td>\n   <td style=\"text-align:right;\"> 2.21 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 4.47 </td>\n   <td style=\"text-align:right;\"> 2.18 </td>\n   <td style=\"text-align:right;\"> 4.47 </td>\n   <td style=\"text-align:right;\"> 2.18 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 5.54 </td>\n   <td style=\"text-align:right;\"> 1.52 </td>\n   <td style=\"text-align:right;\"> 5.54 </td>\n   <td style=\"text-align:right;\"> 1.52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 3.97 </td>\n   <td style=\"text-align:right;\"> 1.83 </td>\n   <td style=\"text-align:right;\"> 3.97 </td>\n   <td style=\"text-align:right;\"> 1.83 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 4.06 </td>\n   <td style=\"text-align:right;\"> 2.66 </td>\n   <td style=\"text-align:right;\"> 4.06 </td>\n   <td style=\"text-align:right;\"> 2.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 4.33 </td>\n   <td style=\"text-align:right;\"> 2.01 </td>\n   <td style=\"text-align:right;\"> 4.33 </td>\n   <td style=\"text-align:right;\"> 2.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 3.12 </td>\n   <td style=\"text-align:right;\"> 2.69 </td>\n   <td style=\"text-align:right;\"> 3.12 </td>\n   <td style=\"text-align:right;\"> 2.69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:right;\"> 4.94 </td>\n   <td style=\"text-align:right;\"> 1.79 </td>\n   <td style=\"text-align:right;\"> 4.94 </td>\n   <td style=\"text-align:right;\"> 1.79 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 2.79 </td>\n   <td style=\"text-align:right;\"> 2.47 </td>\n   <td style=\"text-align:right;\"> 2.79 </td>\n   <td style=\"text-align:right;\"> 2.47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 4.51 </td>\n   <td style=\"text-align:right;\"> 2.55 </td>\n   <td style=\"text-align:right;\"> 4.51 </td>\n   <td style=\"text-align:right;\"> 2.55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 3.76 </td>\n   <td style=\"text-align:right;\"> 2.76 </td>\n   <td style=\"text-align:right;\"> 3.76 </td>\n   <td style=\"text-align:right;\"> 2.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:right;\"> 4.18 </td>\n   <td style=\"text-align:right;\"> 2.17 </td>\n   <td style=\"text-align:right;\"> 4.18 </td>\n   <td style=\"text-align:right;\"> 2.17 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 4.26 </td>\n   <td style=\"text-align:right;\"> 1.40 </td>\n   <td style=\"text-align:right;\"> 4.26 </td>\n   <td style=\"text-align:right;\"> 1.40 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:right;\"> 4.16 </td>\n   <td style=\"text-align:right;\"> 2.42 </td>\n   <td style=\"text-align:right;\"> 4.16 </td>\n   <td style=\"text-align:right;\"> 2.42 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 4.57 </td>\n   <td style=\"text-align:right;\"> 0.60 </td>\n   <td style=\"text-align:right;\"> 4.57 </td>\n   <td style=\"text-align:right;\"> 0.60 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 4.31 </td>\n   <td style=\"text-align:right;\"> 1.48 </td>\n   <td style=\"text-align:right;\"> 4.31 </td>\n   <td style=\"text-align:right;\"> 1.48 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 31 </td>\n   <td style=\"text-align:right;\"> 4.33 </td>\n   <td style=\"text-align:right;\"> 2.22 </td>\n   <td style=\"text-align:right;\"> 4.33 </td>\n   <td style=\"text-align:right;\"> 2.22 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 5.54 </td>\n   <td style=\"text-align:right;\"> 1.71 </td>\n   <td style=\"text-align:right;\"> 5.54 </td>\n   <td style=\"text-align:right;\"> 1.71 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 3.12 </td>\n   <td style=\"text-align:right;\"> 2.94 </td>\n   <td style=\"text-align:right;\"> 3.12 </td>\n   <td style=\"text-align:right;\"> 2.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 4.63 </td>\n   <td style=\"text-align:right;\"> 2.47 </td>\n   <td style=\"text-align:right;\"> 4.63 </td>\n   <td style=\"text-align:right;\"> 2.47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 35 </td>\n   <td style=\"text-align:right;\"> 5.29 </td>\n   <td style=\"text-align:right;\"> 1.86 </td>\n   <td style=\"text-align:right;\"> 5.29 </td>\n   <td style=\"text-align:right;\"> 1.86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 4.57 </td>\n   <td style=\"text-align:right;\"> 2.15 </td>\n   <td style=\"text-align:right;\"> 4.57 </td>\n   <td style=\"text-align:right;\"> 2.15 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 5.79 </td>\n   <td style=\"text-align:right;\"> 3.00 </td>\n   <td style=\"text-align:right;\"> 5.79 </td>\n   <td style=\"text-align:right;\"> 3.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 38 </td>\n   <td style=\"text-align:right;\"> 4.19 </td>\n   <td style=\"text-align:right;\"> 1.56 </td>\n   <td style=\"text-align:right;\"> 4.19 </td>\n   <td style=\"text-align:right;\"> 1.56 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 39 </td>\n   <td style=\"text-align:right;\"> 4.85 </td>\n   <td style=\"text-align:right;\"> 0.84 </td>\n   <td style=\"text-align:right;\"> 4.85 </td>\n   <td style=\"text-align:right;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 4.65 </td>\n   <td style=\"text-align:right;\"> 1.78 </td>\n   <td style=\"text-align:right;\"> 4.65 </td>\n   <td style=\"text-align:right;\"> 1.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 4.64 </td>\n   <td style=\"text-align:right;\"> 2.35 </td>\n   <td style=\"text-align:right;\"> 4.64 </td>\n   <td style=\"text-align:right;\"> 2.35 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:right;\"> 5.33 </td>\n   <td style=\"text-align:right;\"> 1.52 </td>\n   <td style=\"text-align:right;\"> 5.33 </td>\n   <td style=\"text-align:right;\"> 1.52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 6.95 </td>\n   <td style=\"text-align:right;\"> 2.23 </td>\n   <td style=\"text-align:right;\"> 6.95 </td>\n   <td style=\"text-align:right;\"> 2.23 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 4.90 </td>\n   <td style=\"text-align:right;\"> 1.67 </td>\n   <td style=\"text-align:right;\"> 4.90 </td>\n   <td style=\"text-align:right;\"> 1.67 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 5.39 </td>\n   <td style=\"text-align:right;\"> 2.79 </td>\n   <td style=\"text-align:right;\"> 5.39 </td>\n   <td style=\"text-align:right;\"> 2.79 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 48 </td>\n   <td style=\"text-align:right;\"> 5.16 </td>\n   <td style=\"text-align:right;\"> 1.61 </td>\n   <td style=\"text-align:right;\"> 5.16 </td>\n   <td style=\"text-align:right;\"> 1.61 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 4.05 </td>\n   <td style=\"text-align:right;\"> 0.96 </td>\n   <td style=\"text-align:right;\"> 4.05 </td>\n   <td style=\"text-align:right;\"> 0.96 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:right;\"> 4.79 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 4.79 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:right;\"> 4.55 </td>\n   <td style=\"text-align:right;\"> 1.55 </td>\n   <td style=\"text-align:right;\"> 4.55 </td>\n   <td style=\"text-align:right;\"> 1.55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 5.13 </td>\n   <td style=\"text-align:right;\"> 2.50 </td>\n   <td style=\"text-align:right;\"> 5.13 </td>\n   <td style=\"text-align:right;\"> 2.50 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 53 </td>\n   <td style=\"text-align:right;\"> 4.80 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n   <td style=\"text-align:right;\"> 4.80 </td>\n   <td style=\"text-align:right;\"> 1.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 54 </td>\n   <td style=\"text-align:right;\"> 4.73 </td>\n   <td style=\"text-align:right;\"> 2.62 </td>\n   <td style=\"text-align:right;\"> 4.73 </td>\n   <td style=\"text-align:right;\"> 2.62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 55 </td>\n   <td style=\"text-align:right;\"> 5.44 </td>\n   <td style=\"text-align:right;\"> 1.55 </td>\n   <td style=\"text-align:right;\"> 5.44 </td>\n   <td style=\"text-align:right;\"> 1.55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 3.74 </td>\n   <td style=\"text-align:right;\"> 1.69 </td>\n   <td style=\"text-align:right;\"> 3.74 </td>\n   <td style=\"text-align:right;\"> 1.69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 57 </td>\n   <td style=\"text-align:right;\"> 4.16 </td>\n   <td style=\"text-align:right;\"> 1.34 </td>\n   <td style=\"text-align:right;\"> 4.16 </td>\n   <td style=\"text-align:right;\"> 1.34 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 4.19 </td>\n   <td style=\"text-align:right;\"> 2.49 </td>\n   <td style=\"text-align:right;\"> 4.19 </td>\n   <td style=\"text-align:right;\"> 2.49 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 2.26 </td>\n   <td style=\"text-align:right;\"> 2.30 </td>\n   <td style=\"text-align:right;\"> 2.26 </td>\n   <td style=\"text-align:right;\"> 2.30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 3.51 </td>\n   <td style=\"text-align:right;\"> 2.27 </td>\n   <td style=\"text-align:right;\"> 3.51 </td>\n   <td style=\"text-align:right;\"> 2.27 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 4.14 </td>\n   <td style=\"text-align:right;\"> 1.73 </td>\n   <td style=\"text-align:right;\"> 4.14 </td>\n   <td style=\"text-align:right;\"> 1.73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 5.38 </td>\n   <td style=\"text-align:right;\"> 2.25 </td>\n   <td style=\"text-align:right;\"> 5.38 </td>\n   <td style=\"text-align:right;\"> 2.25 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:right;\"> 4.82 </td>\n   <td style=\"text-align:right;\"> 1.37 </td>\n   <td style=\"text-align:right;\"> 4.82 </td>\n   <td style=\"text-align:right;\"> 1.37 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 5.10 </td>\n   <td style=\"text-align:right;\"> 2.14 </td>\n   <td style=\"text-align:right;\"> 5.10 </td>\n   <td style=\"text-align:right;\"> 2.14 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 3.50 </td>\n   <td style=\"text-align:right;\"> 1.98 </td>\n   <td style=\"text-align:right;\"> 3.50 </td>\n   <td style=\"text-align:right;\"> 1.98 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:right;\"> 3.62 </td>\n   <td style=\"text-align:right;\"> 1.93 </td>\n   <td style=\"text-align:right;\"> 3.62 </td>\n   <td style=\"text-align:right;\"> 1.93 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThis is quite a big table, and pretty hard to process, so we had better...\n\n## Visualize\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# panel plot: one plot per person\nggplot(data = dat2, aes(x = e, y = pa)) + \n  geom_point(size=1,colour='darkgrey') + \n  geom_smooth(fill=NA,method='lm',colour='black') +\n  xlab(\"State extraversion\") +  # x-axis label\n  ylab(\"State positive affect\") +  # y-axis label\n  theme(legend.position=\"none\",\n        axis.text.x = element_text(size=10),\n        axis.text.y = element_text(size=10),\n        axis.title.x = element_text(face=\"bold\",size=12),\n        axis.title.y = element_text(face=\"bold\",size=12)) +\n  scale_y_continuous(limits=c(-0.5,10.5),breaks=seq(0,10,5),expand=c(0,0)) +\n  scale_x_continuous(limits=c(-0.5,10.5),breaks=seq(0,10,5),expand=c(0,0)) +\n  facet_wrap(~id)  # make panel\n```\n\n::: {.cell-output-display}\n![](example_06_experience_sampling_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nNow this is better. Here we can see that by and large, we have positive associations across participants. How varied the slopes and intercepts are is often clearer on a sinle plot...\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# illustrating random slopes with a spaghetti plot\nggplot(data = dat2, aes(x = e, y = pa)) +\n  geom_point(aes(x = e, y = pa), colour='darkgrey',size=1,alpha=.5) +\n  geom_smooth(aes(colour = as.factor(id)),\n              fill=NA,method=\"lm\",size=.5) +  # linear trend for each participant\n  theme(legend.position=\"none\",\n        axis.text.x = element_text(size=10),\n        axis.text.y = element_text(size=10),\n        axis.title.x = element_text(face=\"bold\",size=12),\n        axis.title.y = element_text(face=\"bold\",size=12)) +\n  theme(plot.margin=unit(c(.5,.5,.5,.5),\"cm\")) +\n  xlab(\"State extraversion\") +  # x-axis label\n  ylab(\"State positive affect\") +  # y-axis label\n  scale_y_continuous(limits=c(0,10.5),breaks=seq(0,10,1),expand=c(0,0)) +\n  scale_x_continuous(limits=c(0,10.5),breaks=seq(0,10,1),expand=c(0,0))\n```\n\n::: {.cell-output-display}\n![](example_06_experience_sampling_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nSo although we have generally positive slopes, this looks like we may have call to try a model with random intercept and slopes by person.\n\n## Run models\n\nFirst we can run our baseline model:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lme4)\n#### Models ####\n# Null model for positive affect\nm0 <- lmer(pa ~ (1 | id), \n                    data = dat2)\nsummary(m0) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: pa ~ (1 | id)\n   Data: dat2\n\nREML criterion at convergence: 7171.1\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.4720 -0.6456 -0.0089  0.6448  3.9656 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n id       (Intercept) 1.423    1.193   \n Residual             2.572    1.604   \nNumber of obs: 1849, groups:  id, 62\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)   5.0034     0.1562   32.02\n```\n:::\n:::\n\n\nWe can use the info here to calculate the ICC:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nICC <- as.data.frame(VarCorr(m0))\n(ICC[1,4]/sum(ICC[,4]))*100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 35.62599\n```\n:::\n:::\n\n\nSo in this data, roughly 35% of the variance is at the between person level.\n\nThe key effect we are going to test in our reduced example is the relation between state extraversion and positive affect. So, for the next model, we will add the fixed effect of interest, retaining the randon intercept:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Random intercepts model\nm1 <- lmer(pa ~ e.c +  # fixed effect \n                         (1 | id),  # random intercept\n                       data = dat2) \nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: pa ~ e.c + (1 | id)\n   Data: dat2\n\nREML criterion at convergence: 6465.5\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.1996 -0.5971 -0.0225  0.5886  4.6390 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n id       (Intercept) 1.453    1.206   \n Residual             1.728    1.314   \nNumber of obs: 1849, groups:  id, 62\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  5.00397    0.15627   32.02\ne.c          0.44747    0.01513   29.57\n\nCorrelation of Fixed Effects:\n    (Intr)\ne.c 0.000 \n```\n:::\n:::\n\n\nThe t-value for e.c is huge. Even though we would not use this to calculate a p-value, it looks like we may well have a significant effect here. We can check this using model comparisons.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(m0, m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: dat2\nModels:\nm0: pa ~ (1 | id)\nm1: pa ~ e.c + (1 | id)\n   npar    AIC    BIC  logLik deviance Chisq Df Pr(>Chisq)    \nm0    3 7175.2 7191.7 -3584.6   7169.2                        \nm1    4 6465.1 6487.2 -3228.5   6457.1 712.1  1  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nNote the warning - our default estimator in `lmer` is REML. But by all our metrics here (smaller AIC and BIC, significant $\\chi^2$ test), extraversion state is a significant predictor of PA.\n\nOur plots also suggested random slopes: \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Random slopes model\nm2 <- lmer(pa ~ e.c +  # fixed effects \n                (1 + e.c | id),  # random intercept & slope\n              data = dat2) \nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: pa ~ e.c + (1 + e.c | id)\n   Data: dat2\n\nREML criterion at convergence: 6403.1\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.4634 -0.5565 -0.0147  0.5571  4.8291 \n\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr \n id       (Intercept) 1.45755  1.2073        \n          e.c         0.02785  0.1669   -0.17\n Residual             1.60973  1.2688        \nNumber of obs: 1849, groups:  id, 62\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  5.00398    0.15627   32.02\ne.c          0.44314    0.02671   16.59\n\nCorrelation of Fixed Effects:\n    (Intr)\ne.c -0.130\n```\n:::\n:::\n\n\nAnd compare the models:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(m1,m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: dat2\nModels:\nm1: pa ~ e.c + (1 | id)\nm2: pa ~ e.c + (1 + e.c | id)\n   npar    AIC    BIC  logLik deviance Chisq Df Pr(>Chisq)    \nm1    4 6465.1 6487.2 -3228.5   6457.1                        \nm2    6 6407.8 6440.9 -3197.9   6395.8  61.3  2  4.886e-14 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nSo again, by all metrics, the random slopes have improved our model.\n\n## Interpret Models\nThe information above gives us enough to go on, but let's get ourselves some confidence intervals to complete the picture. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Get boot-strapped confidence intervals\nconfint(m2,method='boot')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 2.5 %    97.5 %\n.sig01       0.9942891 1.4456121\n.sig02      -0.4624861 0.1408077\n.sig03       0.1178730 0.2117363\n.sigma       1.2196404 1.3127430\n(Intercept)  4.6925430 5.3239127\ne.c          0.3874104 0.4926960\n```\n:::\n:::\n\n\nIn this output, `.sig01` to `.sig03` refer to the three elements in the random effect correlation matrix. `sigma` relates to the residual variance, and the last two CI's are for the fixed effects.\n\nThe intercept in `m2` is the grand mean, and equals 5.00. The fixed effect for e.c says that on average, a unit change in `e.c` results in a 0.44 unit increase in `PA`. We have seen we have significant variances (or, that our model improves allowing them to vary), indicating there is a large degree of variation with respect to the level of `PA` across individuals, and the nature of the relationship between `PA` and `e.c` across people. The negative correlation in these random effects (*r* = -.17), suggests that for those who start higher in `PA`, the positive association with `e.c` is weaker (flatter slopes).\n\n",
    "supporting": [
      "example_06_experience_sampling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}