{"title":"Analysis Example: Cross-sectional multi-level","markdown":{"yaml":{"title":"Analysis Example: Cross-sectional multi-level","link-citations":"yes","code-fold":true,"params":{"SHOW_SOLS":true,"TOGGLE":true}},"headingText":"Overview","containsRefs":false,"markdown":"\n```{r setup, include=F}\nknitr::opts_chunk$set(message = F, warning = F, fig.align = 'center')\n```\n\n:::frame\n\nEach of these pages provides an analysis run through for a different type of design. Each document is structured in the same way:  \n\n  - First the data and research context is introduced. For the purpose of these tutorials, we will only use examples where the data can be shared - either because it is from an open access publication, or because it is unpublished or simulated. \n  - Second, we go through any tidying of the data that is required, before creating some brief descriptives and visualizations of the raw data.\n  - Then, we conduct an analysis. Where possible, we translate the research questions into formal equations prior to fitting the models in **lme4**. Model comparisons are conducted, along with checks of distributional assumptions on our model residuals. \n  - Finally, we visualize and interpret our analysis.\n  \nPlease note that there will be only minimal explanation of the steps undertaken here, as these pages are intended as example analyses rather than additional labs readings. Please also be aware that there are many decisions to be made throughout conducting analyses, and it may be the case that you disagree with some of the choices we make here. As always with these things, it is how we justify our choices that is important. We warmly welcome any feedback and suggestions to improve these examples: please email [ug.ppls.stats@ed.ac.uk](mailto:ug.ppls.stats@ed.ac.uk). \n\n:::\n\nOK, in this example we are keeping with Tom's home territory of organisational psychology. This data set was provided by Dr. David Hughes, from Manchester Business School. It is a subset of a larger data set that has been published on. \n\n- OrgID: organisation ID\n- Sex: 0= female, 1=male\n- Mot: self-rated motivation\n- Perf: boss rated performance\n- PubPri: 0= public, 1=private \n- Region: geographical location, 1=Wales, 2=England, 3=Scotland\n- Size: number of employees 1= <20, 2=21-50, 3=50-100, 4=100-250, 5=251-500, 6=500-1,000, 7=1,000+\n\nHere we are going to be looking at predicting employee performance from self-motivation, and investigating whether this effect is consistent across organisation. We will also look at whether the fact an organisation is public or private accounts for variation in model intercepts and slopes.\n\n# Data Wrangling\n\nThis data set is available at [https://uoepsy.github.io/data/MLM_Org.csv](https://uoepsy.github.io/data/MLM_Org.csv).  \n\n```{r}\nlibrary(tidyverse)\nperform <- read_csv(\"https://uoepsy.github.io/data/MLM_Org.csv\")\nperform %>%\n  filter(OrgID == \"Org1\")\n```\nHere we can see the first 10 employees in `Org1`. Look here at the values that are constant across the organisation, and those that vary by person.\n\n# Descriptives\n\nGiven our data structure, it likely makes most sense for us to look at the averages across organisations.\n\n```{r}\nsummarytab <- \n  perform %>%\n  group_by(OrgID) %>%\n  summarise(\n    N = n_distinct(Perform),\n    Mean.Perf = round(mean(Perform, na.rm=T),2),\n    SD.Perf = round(sd(Perform, na.rm=T),2),\n    Mean.Motiv = round(mean(Mot, na.rm=T),2),\n    SD.Motiv = round(sd(Mot, na.rm=T),2)\n    )\n```\n\n```{r}\nlibrary(kableExtra)\nkable(summarytab) %>%\n  kable_styling(\"striped\")\n```\n\nNote the different numbers of employees we have across organisation. Clearly this will mean the information provided by each organisation will vary.\n\n# Visualisations\n\nNext, we can visualize the relationship between motivation and performance within each organisation. \n\n```{r}\nperform %>%\n  ggplot(aes(x=Mot, y=Perform, group = OrgID)) +\n  geom_point(size = 2, alpha= .75) +\n  geom_smooth(method = \"lm\") +\n  labs(x=\"Motivation\", y=\"Performance\") +\n  facet_wrap(~OrgID)\n```\n\nWhat we see here is A LOT of variability. Not only do the intercepts change, so does the steepness and direction of the slopes.\n\n# Analysis\n\n## Equations\n\nOur model will take the structure specified below. However, we may also want to discuss whether public/private moderates the _within_ effect of motivation, or the _between_ effect of motivation, in which case we would need to separate out the group mean motivation and the group-mean centered motivation. \n$$\n\\begin{align}\n\\operatorname{Perform}_{ij} &= \\beta_{0i} + \\beta_{1i}(\\operatorname{Motivation}_j) + \\varepsilon_{ij}\\\\\n\\beta_{0i} &= \\gamma_{00} + \\zeta_{0i} \\\\\n\\beta_{1i} &= \\gamma_{10} + \\gamma_{11}(\\operatorname{isPrivate}_i) + \\zeta_{0i} \\\\\n& \\text{for OrgID i = 1,} \\dots \\text{,I}\n\\end{align}\n$$\n\n## Fitting the models\nAs we have in many of our examples, let's run an empty model, and look at the ICC for the grouping variable organisation. \n\n```{r}\nlibrary(lme4)\n# Empty model\nm0 <- lmer(Perform ~ 1 + \n             (1 | OrgID),\n           data = perform)\nsummary(m0)\n```\n\n```{r}\n# ICC\nvarM0 <- as.data.frame(VarCorr(m0))\nvarM0\n```\n\n```{r}\nround((varM0[1,4]/sum(varM0[,4]))*100,2)\n```\n\nSo, around 24% of the variance in our data is at the grouping level, meaning around 76% is at the person level. So clearly we have scope here for explanatory variables of both types.\n\nTo begin, we add motivation as a fixed effect:\n\n```{r}\n# Fixed effect for motivation\nm1 <- lmer(Perform ~ 1 + Mot +\n             (1 | OrgID),\n           data = perform)\nsummary(m1)\n```\n\nFrom this, we can calculate the reduction in the residual variance, or the PRV:\n\n```{r}\n# PRV - how much residual variance does motivation account for\nm1_sum <- summary(m1)\nvarM1 <- as.data.frame(m1_sum$varcor)\nvarM1\n```\n\n```{r}\nround(((varM0[2,4]-varM1[2,4])/varM0[2,4])*100,2)\n```\n\nNot bad, so there is a 12.5% reduction in level 1 residual variance from the inclusion of motivation. The coefficient is positive, which is what we would hope to see, motivated employees have better performance.\n\nWe will do all of our model comparisons in one go at the end of our model building, so let's continue. Next, is a random slope (as evidenced by our plots above) for motivation.\n\n```{r}\n# Random slope\nm2 <- lmer(Perform ~ 1 + Mot +\n             (1 + Mot | OrgID),\n           data = perform)\nsummary(m2)\n```\n\nAnd now we can look to compare the set of models before adding the predictors:\n\n```{r}\nanova(m0, m1, m2)\n```\n\nIn each case, adding the additional parameters has improved our model, so we will keep them all.\n\nOur big interest here is in whether organisations being public or private changes the relationship of motivation to performance. For this, we will want to include the cross level interaction between `Mot` and `PubPri`. \n\n```{r}\nm3 <- lmer(Perform ~ 1 + Mot + PubPri + Mot*PubPri +\n             (1 + Mot | OrgID),\n           data = perform)\nsummary(m3)\n```\n\nThe *t*-values here are pretty small. This doesn't look like the added effects have contributed much to our model. \n```{r}\n# model comparison\nanova(m2,m3)\n```\n\nAnd indeed our model comparison suggests not. But wait a minute, we forgot about something....\n\n...we need to center our predictors.\n\nLet's create variables which are the group mean motivation, and the group-mean centered motivation. \n\n```{r}\nperform <- \n  perform %>%\n  group_by(OrgID) %>%\n  mutate(\n    Mot_m = mean(Mot, na.rm=T),\n    Mot_c = Mot - mean(Mot, na.rm=T)\n  ) %>% ungroup\n```\n\nAnd re-run the models:\n\n```{r}\nm4 <- lmer(Perform ~ 1 + Mot_m + Mot_c +\n             (1 + Mot_c | OrgID),\n           data = perform)\nm5 <- lmer(Perform ~ 1 + Mot_m + Mot_c + PubPri + Mot_c*PubPri +\n             (1 + Mot_c | OrgID),\n           data = perform)\nanova(m4,m5)\nsummary(m5)\n```\nWhat do you notice about the results? Spend a little bit of time comparing the effects (fixed and random) and see the changes that result from centering a variable. Remember that our interpretation of the conditional main effects is the effect of a predictor on the outcome when the interacting variable = 0. Zero for Mot_c is average motivation, and zero for PubPri is public sector. So for every unit increase in motivation within a public centre organisation, performance increases by 1.77 units.\n\n\n\n# Check model\n\nI might be a little concerned about homoscedasticity here. The variance is a bit narrower at the tail ends:\n```{r}\nlibrary(lattice)\nplot(m5, sqrt(abs(resid(.)))~fitted(.), type = c(\"p\",\"smooth\"))\nqqmath(m5)\ndotplot.ranef.mer(ranef(m5))\n```\n\n```{r}\nlibrary(robustlmm)\nm5r <- rlmer(Perform ~ 1 + Mot_m + Mot_c + PubPri + Mot_c*PubPri +\n             (1 + Mot_c | OrgID),\n           data = perform)\n```\n\n\n# Visualise model\n\n```{r}\nlibrary(sjPlot)\nplot_model(m5, type=\"pred\",terms=c(\"Mot_m\"))\nplot_model(m5, type=\"pred\", terms=c(\"Mot_c\",\"PubPri\"))\n```\n\n# Interpret model\n\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"include-in-header":["assets/toggling.html"],"number-sections":false,"output-file":"example_04_cross_sectional_multilevel.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"0.9.587","toc_float":true,"theme":["united","assets/style-labs.scss"],"code-copy":false,"title":"Analysis Example: Cross-sectional multi-level","link-citations":"yes","params":{"SHOW_SOLS":true,"TOGGLE":true}},"extensions":{"book":{"multiFile":true}}}}}