{
  "hash": "308e130023e8fa71e45b18248468b7ee",
  "result": {
    "markdown": "---\ntitle: \"PCA and unequal variances\"\ncode-fold: true\nparams: \n    SHOW_SOLS: TRUE\n    TOGGLE: TRUE\n---\n\n\n\n\n# Simulating some data\n\nWe're including this code if you want to create some data and play around with it yourself, but __do not worry about understanding it!__ \nIn brief, what it does is 1) create a covariance matrix 2) generate data based on the covariance matrix and 3) rename the columns to \"item1\", \"item2\".. etc. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nset.seed(777)\nnitem <- 5  \nA <- matrix(runif(nitem^2)*2-1, ncol=nitem) \nscor <- t(A) %*% A\ndf <- MASS::mvrnorm(n=200,mu=rep(0,5),Sigma = scor) %>% as_tibble()\nnames(df)<-paste0(\"item\",1:5)\n```\n:::\n\n\nThe data we created has 5 items, all on similar scales:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(psych)\nlibrary(knitr)\nkable(describe(df)[,c(3:4)])\n```\n\n::: {.cell-output-display}\n|      |   mean|    sd|\n|:-----|------:|-----:|\n|item1 |  0.054| 1.126|\n|item2 | -0.098| 1.626|\n|item3 |  0.098| 0.957|\n|item4 | -0.179| 1.180|\n|item5 | -0.071| 1.141|\n:::\n:::\n\n\n<!-- # Cov and Cor -->\n\n<!-- For the initial dataset, the covariance matrix and correlation matrix are as follows: -->\n\n<!-- ```{r} -->\n<!-- kable(cov(df)) -->\n<!-- kable(cor(df)) -->\n<!-- ``` -->\n\n\n\n# Doing PCA \n\nWe can start conducting a PCA from various different points. We can either start with the data itself, or we can start with a matrix representing the relationships between the variables (e.g. either a covariance or a correlation matrix). \n\nWhen using the `principal()` function from the __psych__ package, if we give the function the dataset itself, then this will create a correlation matrix internally in order to conduct the PCA. The same will happen if we give the function the covariance matrix and say `covar = FALSE`. \n\nLet's suppose we are reducing down to just 1 component.  \nThese will all be the same:\n\n::: {.cell}\n\n```{.r .cell-code}\nprincipal(df, nfactors = 1)\nprincipal(cor(df), nfactors = 1)\nprincipal(cov(df), nfactors = 1, covar = FALSE)\n```\n:::\n\nHere are the loadings:\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> principal(df, nfactors = 1) </th>\n   <th style=\"text-align:right;\"> principal(cor(df), nfactors = 1) </th>\n   <th style=\"text-align:right;\"> principal(cov(df), nfactors = 1, covar = FALSE) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## PCA on the covariance matrix\n\nIf we use the covariance matrix, we get slightly different results, because the loadings are proportional to the scale of the variance for each item. \n\n::: {.cell}\n\n```{.r .cell-code}\nprincipal(cov(df), nfactors = 1, covar = TRUE)$loadings\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLoadings:\n      PC1   \nitem1 -0.796\nitem2  0.772\nitem3 -0.874\nitem4  0.860\nitem5  0.898\n\n                 PC1\nSS loadings    3.540\nProportion Var 0.708\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> variance of item </th>\n   <th style=\"text-align:right;\"> loadings cor PCA </th>\n   <th style=\"text-align:right;\"> loadings cov PCA </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> item1 </td>\n   <td style=\"text-align:right;\"> 1.268 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.796 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item2 </td>\n   <td style=\"text-align:right;\"> 2.643 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.772 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item3 </td>\n   <td style=\"text-align:right;\"> 0.915 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.874 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item4 </td>\n   <td style=\"text-align:right;\"> 1.392 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.860 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item5 </td>\n   <td style=\"text-align:right;\"> 1.302 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.898 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nThis means that if the items are measured on very different scales, using the covariance matrix will lead to the components being dominated by the items with the largest variance. \n\nLet's make another dataset in which item2 is just measured on a completely different scale\n\n::: {.cell}\n\n```{.r .cell-code}\ndfb <- df %>% mutate(item2 = item2*20)\nkable(describe(dfb)[,c(3:4)])\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> item1 </td>\n   <td style=\"text-align:right;\"> 0.054 </td>\n   <td style=\"text-align:right;\"> 1.126 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item2 </td>\n   <td style=\"text-align:right;\"> -1.964 </td>\n   <td style=\"text-align:right;\"> 32.515 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item3 </td>\n   <td style=\"text-align:right;\"> 0.098 </td>\n   <td style=\"text-align:right;\"> 0.957 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item4 </td>\n   <td style=\"text-align:right;\"> -0.179 </td>\n   <td style=\"text-align:right;\"> 1.180 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item5 </td>\n   <td style=\"text-align:right;\"> -0.071 </td>\n   <td style=\"text-align:right;\"> 1.141 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> variance of item </th>\n   <th style=\"text-align:right;\"> loadings cor PCA </th>\n   <th style=\"text-align:right;\"> loadings cov PCA </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> item1 </td>\n   <td style=\"text-align:right;\"> 1.268 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> 0.288 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item2 </td>\n   <td style=\"text-align:right;\"> 1057.242 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 32.515 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item3 </td>\n   <td style=\"text-align:right;\"> 0.915 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.593 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item4 </td>\n   <td style=\"text-align:right;\"> 1.392 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.091 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> item5 </td>\n   <td style=\"text-align:right;\"> 1.302 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.064 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Use of `covar=..` \n\nThe `covar=TRUE/FALSE` argument of `principal()` only makes a difference if you give the function a covariance matrix.  \n\nIf you give the `principal()` function the raw data, then it will automatically conduct the PCA on the correlation matrix regardless of whether you put `covar=TRUE` or `covar=FALSE`\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> principal(dfb, nfactors = 1, covar = FALSE) </th>\n   <th style=\"text-align:right;\"> dfb, nfactors = 1, covar = TRUE) </th>\n   <th style=\"text-align:right;\"> principal(cor(dfb), nfactors = 1) </th>\n   <th style=\"text-align:right;\"> principal(cov(dfb), nfactors = 1, covar = FALSE) </th>\n   <th style=\"text-align:right;\"> principal(cov(dfb), nfactors = 1, covar = TRUE) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> -0.861 </td>\n   <td style=\"text-align:right;\"> 0.288 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 32.515 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.834 </td>\n   <td style=\"text-align:right;\"> -0.593 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.765 </td>\n   <td style=\"text-align:right;\"> 0.091 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.064 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}