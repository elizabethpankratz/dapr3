{"title":"PCA and unequal variances","markdown":{"yaml":{"title":"PCA and unequal variances","code-fold":true,"params":{"SHOW_SOLS":true,"TOGGLE":true}},"headingText":"Simulating some data","containsRefs":false,"markdown":"\n\n```{r include=F}\noptions(digits=3)\n```\n\n\nWe're including this code if you want to create some data and play around with it yourself, but __do not worry about understanding it!__ \nIn brief, what it does is 1) create a covariance matrix 2) generate data based on the covariance matrix and 3) rename the columns to \"item1\", \"item2\".. etc. \n\n```{r message=F,warning=F}\nlibrary(tidyverse)\nset.seed(777)\nnitem <- 5  \nA <- matrix(runif(nitem^2)*2-1, ncol=nitem) \nscor <- t(A) %*% A\ndf <- MASS::mvrnorm(n=200,mu=rep(0,5),Sigma = scor) %>% as_tibble()\nnames(df)<-paste0(\"item\",1:5)\n```\n\nThe data we created has 5 items, all on similar scales:\n```{r message=F,warning=F}\nlibrary(psych)\nlibrary(knitr)\nkable(describe(df)[,c(3:4)])\n```\n\n<!-- # Cov and Cor -->\n\n<!-- For the initial dataset, the covariance matrix and correlation matrix are as follows: -->\n\n<!-- ```{r} -->\n<!-- kable(cov(df)) -->\n<!-- kable(cor(df)) -->\n<!-- ``` -->\n\n\n\n# Doing PCA \n\nWe can start conducting a PCA from various different points. We can either start with the data itself, or we can start with a matrix representing the relationships between the variables (e.g. either a covariance or a correlation matrix). \n\nWhen using the `principal()` function from the __psych__ package, if we give the function the dataset itself, then this will create a correlation matrix internally in order to conduct the PCA. The same will happen if we give the function the covariance matrix and say `covar = FALSE`. \n\nLet's suppose we are reducing down to just 1 component.  \nThese will all be the same:\n```{r eval=F}\nprincipal(df, nfactors = 1)\nprincipal(cor(df), nfactors = 1)\nprincipal(cov(df), nfactors = 1, covar = FALSE)\n```\nHere are the loadings:\n```{r message=F,warning=F,echo=F}\nbind_cols(principal(df, nfactors = 1)$loadings[,1],\nprincipal(cor(df), nfactors = 1)$loadings[,1],\nprincipal(cov(df), nfactors = 1, covar = FALSE)$loadings[,1]) -> d\nnames(d) <- c(\"principal(df, nfactors = 1)\",\"principal(cor(df), nfactors = 1)\",\"principal(cov(df), nfactors = 1, covar = FALSE)\")\nrownames(d)<-names(df)\nkable(d) %>% kableExtra::kable_styling(full_width = T)\n```\n\n## PCA on the covariance matrix\n\nIf we use the covariance matrix, we get slightly different results, because the loadings are proportional to the scale of the variance for each item. \n```{r}\nprincipal(cov(df), nfactors = 1, covar = TRUE)$loadings\n```\n\n\n```{r message=F,warning=F,echo=F}\ncbind(principal(cov(df), nfactors = 1, covar = FALSE)$loadings[,1], principal(cov(df), nfactors = 1, covar = TRUE)$loadings[,1]) -> d\nd<- cbind(apply(df,MARGIN=2,var),d)\ncolnames(d)<-c(\"variance of item\",\"loadings cor PCA\",\"loadings cov PCA\")\nkable(d) %>% kableExtra::kable_styling(.,full_width = T)\n```\n\n\nThis means that if the items are measured on very different scales, using the covariance matrix will lead to the components being dominated by the items with the largest variance. \n\nLet's make another dataset in which item2 is just measured on a completely different scale\n```{r}\ndfb <- df %>% mutate(item2 = item2*20)\nkable(describe(dfb)[,c(3:4)])\n```\n\n```{r message=F,warning=F,echo=F}\ncbind(principal(cov(dfb), nfactors = 1, covar = FALSE)$loadings[,1], principal(cov(dfb), nfactors = 1, covar = TRUE)$loadings[,1]) -> d\nd<- cbind(apply(dfb,MARGIN=2,var),d)\ncolnames(d)<-c(\"variance of item\",\"loadings cor PCA\",\"loadings cov PCA\")\nkable(d) %>% kableExtra::kable_styling(.,full_width = T)\n```\n\n## Use of `covar=..` \n\nThe `covar=TRUE/FALSE` argument of `principal()` only makes a difference if you give the function a covariance matrix.  \n\nIf you give the `principal()` function the raw data, then it will automatically conduct the PCA on the correlation matrix regardless of whether you put `covar=TRUE` or `covar=FALSE`\n\n```{r echo=F,warning=F,message=F}\nbind_cols(principal(dfb, nfactors = 1, covar = FALSE)$loadings[,1],\n          principal(dfb, nfactors = 1, covar = TRUE)$loadings[,1],\n          principal(cor(dfb), nfactors = 1)$loadings[,1],\n          principal(cov(dfb), nfactors = 1, covar = FALSE)$loadings[,1],\n          principal(cov(dfb), nfactors = 1, covar = TRUE)$loadings[,1],\n          ) -> d\nnames(d) <- c(\"principal(dfb, nfactors = 1, covar = FALSE)\",\"dfb, nfactors = 1, covar = TRUE)\",\"principal(cor(dfb), nfactors = 1)\",\"principal(cov(dfb), nfactors = 1, covar = FALSE)\",\"principal(cov(dfb), nfactors = 1, covar = TRUE)\")\nrownames(d)<-names(df)\nkable(d) %>% kableExtra::kable_styling(full_width = T)\n```\n\n","srcMarkdownNoYaml":"\n\n```{r include=F}\noptions(digits=3)\n```\n\n# Simulating some data\n\nWe're including this code if you want to create some data and play around with it yourself, but __do not worry about understanding it!__ \nIn brief, what it does is 1) create a covariance matrix 2) generate data based on the covariance matrix and 3) rename the columns to \"item1\", \"item2\".. etc. \n\n```{r message=F,warning=F}\nlibrary(tidyverse)\nset.seed(777)\nnitem <- 5  \nA <- matrix(runif(nitem^2)*2-1, ncol=nitem) \nscor <- t(A) %*% A\ndf <- MASS::mvrnorm(n=200,mu=rep(0,5),Sigma = scor) %>% as_tibble()\nnames(df)<-paste0(\"item\",1:5)\n```\n\nThe data we created has 5 items, all on similar scales:\n```{r message=F,warning=F}\nlibrary(psych)\nlibrary(knitr)\nkable(describe(df)[,c(3:4)])\n```\n\n<!-- # Cov and Cor -->\n\n<!-- For the initial dataset, the covariance matrix and correlation matrix are as follows: -->\n\n<!-- ```{r} -->\n<!-- kable(cov(df)) -->\n<!-- kable(cor(df)) -->\n<!-- ``` -->\n\n\n\n# Doing PCA \n\nWe can start conducting a PCA from various different points. We can either start with the data itself, or we can start with a matrix representing the relationships between the variables (e.g. either a covariance or a correlation matrix). \n\nWhen using the `principal()` function from the __psych__ package, if we give the function the dataset itself, then this will create a correlation matrix internally in order to conduct the PCA. The same will happen if we give the function the covariance matrix and say `covar = FALSE`. \n\nLet's suppose we are reducing down to just 1 component.  \nThese will all be the same:\n```{r eval=F}\nprincipal(df, nfactors = 1)\nprincipal(cor(df), nfactors = 1)\nprincipal(cov(df), nfactors = 1, covar = FALSE)\n```\nHere are the loadings:\n```{r message=F,warning=F,echo=F}\nbind_cols(principal(df, nfactors = 1)$loadings[,1],\nprincipal(cor(df), nfactors = 1)$loadings[,1],\nprincipal(cov(df), nfactors = 1, covar = FALSE)$loadings[,1]) -> d\nnames(d) <- c(\"principal(df, nfactors = 1)\",\"principal(cor(df), nfactors = 1)\",\"principal(cov(df), nfactors = 1, covar = FALSE)\")\nrownames(d)<-names(df)\nkable(d) %>% kableExtra::kable_styling(full_width = T)\n```\n\n## PCA on the covariance matrix\n\nIf we use the covariance matrix, we get slightly different results, because the loadings are proportional to the scale of the variance for each item. \n```{r}\nprincipal(cov(df), nfactors = 1, covar = TRUE)$loadings\n```\n\n\n```{r message=F,warning=F,echo=F}\ncbind(principal(cov(df), nfactors = 1, covar = FALSE)$loadings[,1], principal(cov(df), nfactors = 1, covar = TRUE)$loadings[,1]) -> d\nd<- cbind(apply(df,MARGIN=2,var),d)\ncolnames(d)<-c(\"variance of item\",\"loadings cor PCA\",\"loadings cov PCA\")\nkable(d) %>% kableExtra::kable_styling(.,full_width = T)\n```\n\n\nThis means that if the items are measured on very different scales, using the covariance matrix will lead to the components being dominated by the items with the largest variance. \n\nLet's make another dataset in which item2 is just measured on a completely different scale\n```{r}\ndfb <- df %>% mutate(item2 = item2*20)\nkable(describe(dfb)[,c(3:4)])\n```\n\n```{r message=F,warning=F,echo=F}\ncbind(principal(cov(dfb), nfactors = 1, covar = FALSE)$loadings[,1], principal(cov(dfb), nfactors = 1, covar = TRUE)$loadings[,1]) -> d\nd<- cbind(apply(dfb,MARGIN=2,var),d)\ncolnames(d)<-c(\"variance of item\",\"loadings cor PCA\",\"loadings cov PCA\")\nkable(d) %>% kableExtra::kable_styling(.,full_width = T)\n```\n\n## Use of `covar=..` \n\nThe `covar=TRUE/FALSE` argument of `principal()` only makes a difference if you give the function a covariance matrix.  \n\nIf you give the `principal()` function the raw data, then it will automatically conduct the PCA on the correlation matrix regardless of whether you put `covar=TRUE` or `covar=FALSE`\n\n```{r echo=F,warning=F,message=F}\nbind_cols(principal(dfb, nfactors = 1, covar = FALSE)$loadings[,1],\n          principal(dfb, nfactors = 1, covar = TRUE)$loadings[,1],\n          principal(cor(dfb), nfactors = 1)$loadings[,1],\n          principal(cov(dfb), nfactors = 1, covar = FALSE)$loadings[,1],\n          principal(cov(dfb), nfactors = 1, covar = TRUE)$loadings[,1],\n          ) -> d\nnames(d) <- c(\"principal(dfb, nfactors = 1, covar = FALSE)\",\"dfb, nfactors = 1, covar = TRUE)\",\"principal(cor(dfb), nfactors = 1)\",\"principal(cov(dfb), nfactors = 1, covar = FALSE)\",\"principal(cov(dfb), nfactors = 1, covar = TRUE)\")\nrownames(d)<-names(df)\nkable(d) %>% kableExtra::kable_styling(full_width = T)\n```\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"include-in-header":["assets/toggling.html"],"number-sections":false,"output-file":"explainer_pcavar.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.340","toc_float":true,"theme":["united","assets/style-labs.scss"],"link-citations":true,"code-copy":false,"title":"PCA and unequal variances","params":{"SHOW_SOLS":true,"TOGGLE":true}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}