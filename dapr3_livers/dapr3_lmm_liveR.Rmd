---
title: "dapr3 Live Rs"
author: "josiah king"
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sjPlot)
library(ICC)
library(lme4)

load("dapr3_liveRs.RData")
```

after accounting for differences due to age, is the influence of caffeine consumption on reaction times dependent upon whether it coffee is taken with or without milk?  

**NOTE:** This data is all simulated (we've just used some random names of people in the psychology department. Nothing is accurate). I have no idea how old people are, nor how they take their coffee! (although FWIW, I gather that most days Tom has 2 espressos before 8am!).  


# Week 1

Consider two studies.  

**Scenario 1**  

First, we just get our participants, and record their reaction times. We also ask them how many coffees they have had that day, and whether they take milk.  

*Between-person*: One value per person

```{r}
psychRT_quick

# plot:
ggplot(psychRT_quick, aes(x=ncoffees, y=RT))+
  geom_point() +
  geom_smooth(method=lm,se=F)+
  geom_label(aes(label=pid),hjust=0,position=position_nudge(x=.1))

# fit a model:


```
**Scenario 2**  

We get our participants, and we record their reaction times after they have had 1 coffee. 
Then we give them another coffee, and we record their reaction times again.  
Then we give them another coffee, and we record their reaction times again.  
...  
...  
...  
We end up with some highly caffeinated participants, but we observe them at various levels of coffee consumption!  

*Within-person*: multiple values per person 

```{r}
psychRT

# plot
ggplot(psychRT, aes(x=ncoffees, y=RT))+
  geom_point() +
  geom_smooth(method=lm,se=F) +
  geom_label(data=filter(psychRT,pid=="Josiah"),
             aes(label=pid),hjust=0,
             position=position_nudge(x=.1))


# fit an lm
summary(lm(RT~ncoffees,psychRT))

mm = lm(RT~ncoffees,psychRT)
# residuals are NOT independent
plot(mm)

```
Variation in RT is partly attributable to differences between people.  
- it looks like Tom is possibly, on average, a bit quicker than Holly?
- and Bérengère possibly quicker still?  


```{r}
# ICC
library(ICC)
ICCbare(x=pid, y=RT,data=psychRT)

## plot


```


Let's pivot (if we have time)

```{r}
psychRT

psychRT %>% 
  select(-caff) %>%
  pivot_wider(names_from=ncoffees, values_from=RT) %>%
  pivot_longer(`0`:`6`, names_to="howmanycoffees", values_to="reaction")
```

# Week 2

> after accounting for differences due to age, is the influence of caffeine consumption on reaction times dependent upon whether it coffee is taken with or without milk?  

__design__  
We recruited people from the psychology department, and measured their reaction times (RT). We then gave them a coffee, waited an hour, and measured their RT again. We then gave them _another_ coffee before measuring their RT again. and again. and again. Up to 7 coffees were consumed by each participant. Participants had coffee either with or without milk.  
**NOT A REAL STUDY**  

How many people? How many observations?  
```{r}

```


Plotting the data:
```{r}


```

Fitting a model:
```{r}


```

Plotting the model:  
```{r}


```

Why can't we have age|pid or milk|pid?  
```{r}


```

We need to actually _think_, not just wait for errors!  
```{r}
mm = lmer(RT~ 1 + milk + (1 + milk | pid), data = psychRT)
summary(mm)
```

