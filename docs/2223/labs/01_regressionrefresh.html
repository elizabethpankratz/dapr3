<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.587">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DAPR3 - Regression Refresh and Clustered Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-hand-o-right')) {
    f.classList.add('fa-hand-o-left')
    f.classList.remove('fa-hand-o-right')
} else {
    f.classList.add('fa-hand-o-right')
    f.classList.remove('fa-hand-o-left')
}
}
</script>

<script src="https://kit.fontawesome.com/120b08a6f5.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DAPR3</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-multi-level-models" role="button" data-bs-toggle="dropdown" aria-expanded="false">Multi Level Models</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-multi-level-models">    
        <li>
    <a class="dropdown-item" href="./01_regressionrefresh.html">
 <span class="dropdown-text">1: Linear Regression | Clustered Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_intromlm.html">
 <span class="dropdown-text">2: LM to MLM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_assumptranef.html">
 <span class="dropdown-text">3: Assumptions, Diagnostics</span></a>
  </li>  
        <li class="dropdown-header">4: Centering | Logistic</li>
        <li class="dropdown-header">5: Recap</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-dimension-reduction--sem" role="button" data-bs-toggle="dropdown" aria-expanded="false">Dimension reduction &amp; SEM</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-dimension-reduction--sem">    
        <li class="dropdown-header">7: Path Analysis</li>
        <li class="dropdown-header">8: Path Mediation</li>
        <li class="dropdown-header">9: Dimension Reduction</li>
        <li class="dropdown-header">10: EFA: Part 1</li>
        <li class="dropdown-header">11: EFA: Part 2</li>
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#linear-model-refresh" id="toc-linear-model-refresh" class="nav-link active" data-scroll-target="#linear-model-refresh">Linear Model Refresh</a></li>
  <li><a href="#complete-pooling-no-pooling" id="toc-complete-pooling-no-pooling" class="nav-link" data-scroll-target="#complete-pooling-no-pooling">Complete pooling, No pooling</a></li>
  <li><a href="#some-data-wrangling" id="toc-some-data-wrangling" class="nav-link" data-scroll-target="#some-data-wrangling">Some Data Wrangling</a></li>
  <li><a href="#exploring-clustering" id="toc-exploring-clustering" class="nav-link" data-scroll-target="#exploring-clustering">Exploring Clustering</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regression Refresh and Clustered Data</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="lo">
<p><strong>Preliminaries</strong></p>
<ol type="1">
<li>Open Rstudio, and <strong>create a new project for this course!!</strong></li>
<li>Create a new RMarkdown document or R script (whichever you like) for this week.</li>
</ol>
<p>These are the main packages we’re going to use in this block. It might make sense to install them now if you do not have them already.<br>
<!-- (note, the rstudio.ppls.ed.ac.uk server already has `lme4` and `tidyverse` installed for you).   --></p>
<ul>
<li><strong>tidyverse</strong> : for organising data<br>
</li>
<li><strong>ICC</strong> : for quickly calculating intraclass correlation coefficient</li>
<li><strong>lme4</strong> : for fitting generalised linear mixed effects models</li>
<li><strong>lmeresampler</strong> : for bootstrapping!</li>
<li><strong>effects</strong> : for tabulating and graphing effects in linear models</li>
<li><strong>broom.mixed</strong> : tidying methods for mixed models</li>
<li><strong>sjPlot</strong> : for plotting models</li>
<li><strong>HLMdiag</strong> : for examining case diagnostics at multiple levels</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>,<span class="st">"ICC"</span>,<span class="st">"lme4"</span>,<span class="st">"effects"</span>,<span class="st">"broom.mixed"</span>,<span class="st">"sjPlot"</span>,<span class="st">"HLMdiag"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the lmeresampler package has had some recent updates. better to install the most recent version:</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"aloy/lmeresampler"</span>)</span></code></pre></div>
</div>
</div>
<section id="linear-model-refresh" class="level1">
<h1>Linear Model Refresh</h1>
<div class="frame">
<p><strong>Data: Wellbeing in Scotland</strong></p>
<p>In DAPR2, one of the examples we used in <a href="https://uoepsy.github.io/dapr2/2122/labs/1_04_mlr.html">learning about linear regression</a> was in examining the relationship between time spent outdoors and mental wellbeing. In that example researchers had collected data from 32 residents of Edinburgh &amp; Lothians.</p>
<p>Researchers want to study this relationship across all of Scotland. They contact all the Local Authority Areas (LAAs) and ask them to collect data for them for them, with participants completing the Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being, and being asked to estimate the average number of hours they spend outdoors each week.</p>
<p>Twenty of the Local Authority Areas provided data. It is available at <a href="https://uoepsy.github.io/data/LAAwellbeing.csv">https://uoepsy.github.io/data/LAAwellbeing.csv</a>, and you can read it into your R environment using the code below:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>scotmw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/LAAwellbeing.csv"</span>)</span></code></pre></div>
</div>
<p>The dataset contains information on 132 participants. You can see the variables in the table below</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="ssotrfyesn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ssotrfyesn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ssotrfyesn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ssotrfyesn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ssotrfyesn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ssotrfyesn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ssotrfyesn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ssotrfyesn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ssotrfyesn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ssotrfyesn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ssotrfyesn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ssotrfyesn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ssotrfyesn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ssotrfyesn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ssotrfyesn .gt_from_md > :first-child {
  margin-top: 0;
}

#ssotrfyesn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ssotrfyesn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ssotrfyesn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ssotrfyesn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ssotrfyesn .gt_row_group_first td {
  border-top-width: 2px;
}

#ssotrfyesn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ssotrfyesn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ssotrfyesn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ssotrfyesn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ssotrfyesn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ssotrfyesn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ssotrfyesn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ssotrfyesn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ssotrfyesn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ssotrfyesn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ssotrfyesn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ssotrfyesn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ssotrfyesn .gt_left {
  text-align: left;
}

#ssotrfyesn .gt_center {
  text-align: center;
}

#ssotrfyesn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ssotrfyesn .gt_font_normal {
  font-weight: normal;
}

#ssotrfyesn .gt_font_bold {
  font-weight: bold;
}

#ssotrfyesn .gt_font_italic {
  font-style: italic;
}

#ssotrfyesn .gt_super {
  font-size: 65%;
}

#ssotrfyesn .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#ssotrfyesn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ssotrfyesn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ssotrfyesn .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#ssotrfyesn .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#ssotrfyesn .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">ppt</td>
<td class="gt_row gt_left">Participant ID</td></tr>
    <tr><td class="gt_row gt_left">name</td>
<td class="gt_row gt_left">Participant Name</td></tr>
    <tr><td class="gt_row gt_left">laa</td>
<td class="gt_row gt_left">Local Authority Area</td></tr>
    <tr><td class="gt_row gt_left">outdoor_time</td>
<td class="gt_row gt_left">Self report estimated number of hours per week spent outdoors</td></tr>
    <tr><td class="gt_row gt_left">wellbeing</td>
<td class="gt_row gt_left">Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.</td></tr>
    <tr><td class="gt_row gt_left">density</td>
<td class="gt_row gt_left">LAA Population Density (people per square km)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<div class="sticky">
<p><strong>Regression Refresh</strong></p>
<p>Recall that in the DAPR2 course last year we learned all about the linear regression model, which took the form:</p>
<p><span class="math display">\[
\begin{align}\\
&amp; \text{for observation }i \\
&amp; \color{red}{Y_i}\color{black} = \color{blue}{\beta_0 \cdot{} 1 + \beta_1 \cdot{} X_{1i} \ + \ ... \ + \ \beta_p \cdot{} X_{pi}}\color{black} + \varepsilon_i \\
\end{align}
\]</span></p>
<p>And if we wanted to write this more simply, we can express <span class="math inline">\(X_1\)</span> to <span class="math inline">\(X_p\)</span> as an <span class="math inline">\(n \times p\)</span> matrix (samplesize <span class="math inline">\(\times\)</span> parameters), and <span class="math inline">\(\beta_0\)</span> to <span class="math inline">\(\beta_p\)</span> as a vector of coefficients:</p>
<p><span class="math display">\[
\begin{align}
&amp; \color{red}{\mathbf{y}}\color{black} = \color{blue}{\boldsymbol{X\beta}}\color{black} + \boldsymbol{\varepsilon} \\
&amp; \quad \\
&amp; \text{where} \\
&amp; \varepsilon \sim N(0, \sigma) \text{ independently} \\
\end{align}
\]</span></p>
<p>In R, we fitted these models using:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> .... xp, <span class="at">data =</span> mydata)  </span></code></pre></div>
</div>
</div>
<div class="question-begin">
Question 1
</div>
<div class="question-body">
<p>Read in the Local Authority data from <a href="https://uoepsy.github.io/data/LAAwellbeing.csv">https://uoepsy.github.io/data/LAAwellbeing.csv</a> and plot the bivariate relationship between wellbeing and time spent outdoors.</p>
<p>Using <code>lm()</code>, fit the simple linear model:</p>
<p><span class="math display">\[
\text{Wellbeing}_i = \beta_0 + \beta_1 \cdot \text{Hours per week spent outdoors}_i + \varepsilon_i
\]</span></p>
<p>Think about the assumptions we make about this model:</p>
<p><span class="math display">\[
\text{where} \quad \varepsilon_i \sim N(0, \sigma) \text{ independently}
\]</span></p>
<p>Have we satisfied this assumption (specifically, the assumption of <em>independence</em> of errors)?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-1" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-1', 'sol-start-1')"> Solution </span>
</div>
<div id="sol-body-1" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>scotmw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/LAAwellbeing.csv"</span>) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> scotmw, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> wellbeing))<span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>simplemod <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> outdoor_time, <span class="at">data =</span> scotmw)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simplemod)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = wellbeing ~ outdoor_time, data = scotmw)

Residuals:
     Min       1Q   Median       3Q      Max 
-28.7089  -7.3501   0.0758   6.6307  25.4873 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   39.6086     2.6414  14.995   &lt;2e-16 ***
outdoor_time   0.1962     0.1449   1.354    0.178    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.51 on 130 degrees of freedom
Multiple R-squared:  0.0139,    Adjusted R-squared:  0.006313 
F-statistic: 1.832 on 1 and 130 DF,  p-value: 0.1782</code></pre>
</div>
</div>
<p>Our model from the previous question will assume that the residuals for all participants are independent of one another. But is this a reasonable assumption that we can make? Might we not think that the residents of the highlands might have generally higher levels of wellbeing than those living in Glasgow? Additionally, the association between outdoor time and wellbeing might be different depending on where you live?</p>
<p>The natural grouping of the people into their respective geographic area introduces a level of <em>dependence</em> which we would be best to account for.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 2
</div>
<div class="question-body">
<p>Try running the code below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> scotmw, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> wellbeing))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<p>Then try editing the code to include an aesthetic mapping from the LAA to the color in the plot.</p>
<p>How do your thoughts about the relationship between outdoor time and wellbeing change?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-2" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-2', 'sol-start-2')"> Solution </span>
</div>
<div id="sol-body-2" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> scotmw, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> wellbeing))<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> scotmw, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> wellbeing, <span class="at">col =</span> laa))<span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>From the second plot, we see a lot of the LAA appear to have a positive relationship (outdoor time is associated with higher wellbeing). There seem to be differences between LAAs in both the general wellbeing level (residents of Na h-Eileanan Siar - the outer hebrides - have high wellbeing), and in how outdoor time is associated with wellbeing (for instance, outdoor time doesn’t seem to help in Glasgow City).</p>
</div>
<p class="solution-end">
</p>
</section>
<section id="complete-pooling-no-pooling" class="level1">
<h1>Complete pooling, No pooling</h1>
<div class="frame">
<p><strong>Complete Pooling</strong></p>
<p>We can consider the simple regression model (<code>lm(wellbeing ~ outdoor_time, data = scotmw)</code>) to “pool” the information from all observations together. In this ‘Complete Pooling’ approach, we simply ignore the natural clustering of the people into their local authority areas, as if we were unaware of it. The problem is that this assumes the same regression line for all local authority areas, which might not be that appropriate. Additionally, we violate the assumption that our residuals are independent, because all of the residuals from certain groups will be more like one another than they are to the others.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="350"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Complete pooling can lead to bad fit for certain groups</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div class="frame">
<p><strong>No Pooling</strong></p>
<p>There are various ways we could attempt to deal with the problem that our data are in groups (or “clusters”). With the tools you have learned in DAPR2, you may be tempted to try including LAA in the model as another predictor, to allow for some local authority areas being generally better than others:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">+</span> laa, <span class="at">data =</span> scotmw)</span></code></pre></div>
</div>
<p>Or even to include an interaction to allow for local authority areas to show different patterns of association between outdoor time and wellbeing:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">*</span> laa, <span class="at">data =</span> scotmw)</span></code></pre></div>
</div>
<p>This approach gets termed the “No Pooling” method, because the information from each cluster contributes <em>only</em> to an estimated parameter for that cluster, and there is no pooling of information across clusters. This is a good start, but it means that a) we are estimating <em>a lot</em> of parameters, and b) we are not necessarily estimating the parameter of interest (the <em>overall</em> effect of practice on reading age). Furthermore, we’ll probably end up having high variance in the estimates at each group.</p>
</div>
<div class="question-begin">
Question 3
</div>
<div class="question-body">
<p>Fit a linear model which accounts for the grouping of participants into their different local authorities, but holds the association between outdoor time and wellbeing as constant across LAAs:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">+</span> laa, <span class="at">data =</span> scotmw)</span></code></pre></div>
</div>
<p>Can you construct a plot of the <strong>fitted</strong> values from this model, coloured by LAA?<br>
(Hint: you might want to use the <code>augment()</code> function from the <strong>broom</strong> package)</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-3" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-3', 'sol-start-3')"> Solution </span>
</div>
<div id="sol-body-3" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(mod1) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.,<span class="fu">aes</span>(<span class="at">x=</span>outdoor_time, <span class="at">y=</span>.fitted, <span class="at">col=</span>laa))<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 4
</div>
<div class="question-body">
<p>What happens (to the plot, and to your parameter estimates) when you include the interaction between <code>laa</code> and <code>outdoor_time</code>?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-4" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-4', 'sol-start-4')"> Solution </span>
</div>
<div id="sol-body-4" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">*</span> laa, <span class="at">data =</span> scotmw)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">augment</span>(mod2) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.,<span class="fu">aes</span>(<span class="at">x=</span>outdoor_time, <span class="at">y=</span>.fitted, <span class="at">col=</span>laa))<span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can see now that our model is fitting a different relationship between wellbeing and outdoor time for each LAA. This is good - we’re going to get better estimates for different LAAs (e.g.&nbsp;wellbeing of residents of the Highlands increases with more outdoor time, and wellbeing of residents of Glasgow does not).</p>
<p>We can see that this model provides a better fit - it results in a significant reduction in the residual sums of squares:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1, mod2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: wellbeing ~ outdoor_time + laa
Model 2: wellbeing ~ outdoor_time * laa
  Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
1    111 2726.2                              
2     92 1973.8 19    752.36 1.8456 0.02866 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>But accounting for this heterogeneity over clusters in the effect of interest comes at the expense of not pooling information across groups to get one estimate for “<strong>the</strong> association between outdoor time and wellbeing”. Additionally, these models will tend to have low statistical power because they are using fewer observations (only those within each cluster) to estimate parameters which only represent within-cluster effects.</p>
</div>
<p class="solution-end">
</p>
</section>
<section id="some-data-wrangling" class="level1">
<h1>Some Data Wrangling</h1>
<p>With more complex data structures comes more in-depth data wrangling in order to get it ready for fitting and estimating our model. Typically, the data we get will not be neat and tidy, and will come in different formats. Often we simply get whatever our experiment/questionnaire software spits out, and we have to work from there. When you are designing a study, you can do work on the front end to minimise the data-wrangling. Try to design an experiment/questionnaire while keeping in mind what the data comes out looking like.</p>
<p>Below we have some data from a fake experiment. We’ve tried to make it a bit more difficult to work with - a bit more similar to what we would <em>actually</em> get when doing real-life research.</p>
<div class="frame">
<p><strong>Data: Raising the stakes</strong></p>
<p>This data is from a simulated study that aims to investigate how levels of stress are influenced by the size and type of potential rewards.</p>
<p>30 volunteers from an amateur basketball league participated. Each participant completed 20 trials in which they were tasked with throwing a basketball and scoring a goal in order to score points. The number of points up for grabs varied between trials, ranging from 1 to 20 points, with the order randomised for each participant. If a participant successfully threw the ball in the basket, then their score increased accordingly. If they missed, their score decreased accordingly. Participants were informed of the number of points available prior to each throw.</p>
<p>To examine the influence of the <em>type</em> of reward/loss on stress-levels, the study consisted of two conditions. In the monetary condition, (n = 15) participants were informed at the start of the study that they would receive their final score in £ at the end of the study. In the reputation condition, (n = 15) participants were informed that the points would be inputted on to a scoreboard and distributed around the local basketball clubs and in the league newsletter.</p>
<p>Throughout each trial, participants’ heart rate variability (HRV) was measured via a chest strap. HRV is considered to be indirectly related to levels of stress (i.e., higher HRV = less stress).</p>
<p>The data is in stored in two separate files.</p>
<ol type="1">
<li>Information on the conditions for each trial for each participant is stored in <strong>.csv</strong> format at <a href="https://uoepsy.github.io/data/basketballconditions.csv">https://uoepsy.github.io/data/basketballconditions.csv</a>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">stakes</td>
<td style="text-align: left;">Number of points available to be won/lost based on successful completion of trial</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition</td>
<td style="text-align: left;">Whether the final score will be converted to £ or will be placed on a public leader-board</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sub</td>
<td style="text-align: left;">Participant Identifier</td>
</tr>
<tr class="even">
<td style="text-align: left;">throw</td>
<td style="text-align: left;">Whether the participant successfully threw the ball in the basket</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trial_no</td>
<td style="text-align: left;">Trial number (1 to 20</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Information on participants’ HRV for each trial is stored in <strong>.xlsx</strong> format, and can be downloaded from <a href="https://uoepsy.github.io/data/basketballhrv.xlsx">https://uoepsy.github.io/data/basketballhrv.xlsx</a>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sub</td>
<td style="text-align: left;">Subject Identifier</td>
</tr>
<tr class="even">
<td style="text-align: left;">trial_1</td>
<td style="text-align: left;">HRV average during trial 1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trial_2</td>
<td style="text-align: left;">HRV average during trial 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">trial_3</td>
<td style="text-align: left;">HRV average during trial 3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">…</td>
<td style="text-align: left;">HRV average during trial …</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="question-begin">
Question 5
</div>
<div class="question-body">
<p>Get the data into your R session.</p>
<p><strong>Note:</strong> For one of the files, this is a bit different to how we have given you data in previous exercises. You may remember that for a <strong>.csv</strong> file, you can read directly into R from the link using, <code>read_csv("https://uoepsy.......)</code>.</p>
<p>However, in reality you are likely to be confronted with data in all sorts of weird formats, such as <strong>.xlsx</strong> files from MS Excel. Have a look around the internet to try and find any packages/functions/techniques for getting both the datasets in to R.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-5" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-5', 'sol-start-5')"> Solution </span>
</div>
<div id="sol-body-5" class="solution-body" style="display: none;">
<div class="imp">
<p>Unfortunately, a few students are getting error messages which we could not solve when trying to read in the .xlsx data. The same data is available at https://uoepsy.github.io/data/bballhrv.csv so that you can read it in in the normal way.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/basketballconditions.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bball)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  stakes condition   sub throw trial_no
   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
1     13 money         1     1 trial_1 
2     17 money         1     1 trial_2 
3      7 money         1     1 trial_3 
4      1 money         1     1 trial_4 
5      2 money         1     1 trial_5 
6      8 money         1     1 trial_6 </code></pre>
</div>
</div>
<p>For the <strong>.xlsx</strong> data:</p>
<ul>
<li>Step 1: download the data to your computer<br>
</li>
<li>Step 2: load the <strong>readxl</strong> package.<br>
</li>
<li>Step 3: use the <code>read_xlsx()</code> function to read in the data, pointing it to the relevant place on your computer.</li>
</ul>
<p>You can actually do all these steps from within R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://uoepsy.github.io/data/basketballhrv.xlsx"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">"baskeballhrvdata.xlsx"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>bballhrv <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"baskeballhrvdata.xlsx"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
    sub trial_1 trial_2 trial_3 trial_4 trial_5 trial_6 trial_7 trial_8 trial_9
  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1     1    5.47    6.69    2.72    4.95    5.96    4.93    4.62    4.70    5.78
2     2    4.60    6.46    3.77    4.80    6.33    5.15    5.04    5.70    4.66
3     3    5.14    5.98    4.30    4.40    4.97    5.16    4.71    4.60    5.94
4     4    5.85    3.74    3.40    4.97    6.46    3.87    5.14    6.26    3.60
5     5    7.46    5.83    4.83    6.26    3.52    5.92    4.24    4.39    5.75
6     6    3.53    2.89    2.07    2.20    3.92    4.45    3.19    5.20    3.81
# … with 11 more variables: trial_10 &lt;dbl&gt;, trial_11 &lt;dbl&gt;, trial_12 &lt;dbl&gt;,
#   trial_13 &lt;dbl&gt;, trial_14 &lt;dbl&gt;, trial_15 &lt;dbl&gt;, trial_16 &lt;dbl&gt;,
#   trial_17 &lt;dbl&gt;, trial_18 &lt;dbl&gt;, trial_19 &lt;dbl&gt;, trial_20 &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 6
</div>
<div class="question-body">
<p>Is each dataset in wide or long format? We want them both in long format, so try to reshape either/both if necessary.</p>
<p>Hint - in the tidyverse functions, you can specify all columns between column <strong>x</strong> and column <strong>z</strong> by using the colon, <code>x:z</code>.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-6" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-6', 'sol-start-6')"> Solution </span>
</div>
<div id="sol-body-6" class="solution-body" style="display: none;">
<p>Only the HRV data is in wide format:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
    sub trial_1 trial_2 trial_3 trial_4 trial_5 trial_6 trial_7 trial_8 trial_9
  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1     1    5.47    6.69    2.72    4.95    5.96    4.93    4.62    4.70    5.78
2     2    4.60    6.46    3.77    4.80    6.33    5.15    5.04    5.70    4.66
3     3    5.14    5.98    4.30    4.40    4.97    5.16    4.71    4.60    5.94
4     4    5.85    3.74    3.40    4.97    6.46    3.87    5.14    6.26    3.60
5     5    7.46    5.83    4.83    6.26    3.52    5.92    4.24    4.39    5.75
6     6    3.53    2.89    2.07    2.20    3.92    4.45    3.19    5.20    3.81
# … with 11 more variables: trial_10 &lt;dbl&gt;, trial_11 &lt;dbl&gt;, trial_12 &lt;dbl&gt;,
#   trial_13 &lt;dbl&gt;, trial_14 &lt;dbl&gt;, trial_15 &lt;dbl&gt;, trial_16 &lt;dbl&gt;,
#   trial_17 &lt;dbl&gt;, trial_18 &lt;dbl&gt;, trial_19 &lt;dbl&gt;, trial_20 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bballhrv <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  bballhrv <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(trial_1<span class="sc">:</span>trial_20, <span class="at">names_to =</span> <span class="st">"trial_no"</span>, <span class="at">values_to =</span> <span class="st">"hrv"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
    sub trial_no   hrv
  &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
1     1 trial_1   5.47
2     1 trial_2   6.69
3     1 trial_3   2.72
4     1 trial_4   4.95
5     1 trial_5   5.96
6     1 trial_6   4.93</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="rtip">
<p><strong>Pivot!</strong></p>
<p>One of the more confusing things to get to grips with is the idea of reshaping a dataframe.<br>
For different reasons, you might sometimes want to have data in wide, or in long format.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.fromthebottomoftheheap.net/assets/img/posts/tidyr-longer-wider.gif" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Source: https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>When the data is wide, we can make it long using <code>pivot_longer()</code>. When we make data longer, we’re essentially making lots of columns into 2 longer columns. Above, in the animation, the wide variable <strong>x</strong>, <strong>y</strong> and <strong>z</strong> go into a new longer column called <strong>name</strong> that specifies which (x/y/z) it came from, and the values get put into the <strong>val</strong> column.</p>
<p>The animation takes a shortcut in the code it displays above, but you could also use <code>pivot_longer(c(x,y,z), names_to = "name", values_to = "val")</code>. To reverse this, and put it back to being wide, we tell R which columns to take the names and values <em>from</em>: <code>pivot_wider(names_from = name, values_from = val)</code>.</p>
</div>
<p>Now comes a fun bit. You may have noticed that we have two datasets for this study. If we are interested in relationships between the heart rate variability (HRV) of participants during each trial, as well as the experimental manipulations (i.e., the condition of each trial), these are currently in different datasets.<br>
Solution: we need to join them together!</p>
<p>Provided that both data-sets contain information on participant number and trial number, which uniquely identify each observation, we can join them together matching on those variables!</p>
<div class="question-begin">
Question 7
</div>
<div class="question-body">
<p>Join the two datasets (both in long format) together.</p>
<p>Note that the variables we are matching on need to have the information in the same format. For instance, R won’t be able to match <code>"trial_1","trial_2","trial_3"</code> with <code>1, 2, 3</code> because they are different things. We would need to edit one of them to be in the same format.</p>
<p><strong>Hint:</strong> You should end up with 600 rows.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-7" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-7', 'sol-start-7')"> Solution </span>
</div>
<div id="sol-body-7" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">full_join</span>(bball, bballhrv)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bball)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  stakes condition   sub throw trial_no   hrv
   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
1     13 money         1     1 trial_1   5.47
2     17 money         1     1 trial_2   6.69
3      7 money         1     1 trial_3   2.72
4      1 money         1     1 trial_4   4.95
5      2 money         1     1 trial_5   5.96
6      8 money         1     1 trial_6   4.93</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="rtip">
<p><strong>Joining data</strong></p>
<p>There are lots of different ways to join data-sets, depending on whether we want to keep rows from one data-set or the other, or keep only those in both data-sets etc.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/messy/joins.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Check out the help documentation for them all using <code>?full_join</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-clustering" class="level1">
<h1>Exploring Clustering</h1>
<div class="question-begin">
Question 8
</div>
<div class="question-body">
<p>Continuing with our basketball/hrv study, consider the following questions:</p>
<p>What are the units of observations?<br>
What are the groups/clusters?<br>
What varies <em>within</em> these clusters?<br>
What varies <em>between</em> these clusters?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-8" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-8', 'sol-start-8')"> Solution </span>
</div>
<div id="sol-body-8" class="solution-body" style="display: none;">
<p>What are the units of observations? <strong>trials</strong><br>
What are the groups/clusters? <strong>participants</strong> What varies <em>within</em> these clusters? <strong>size of reward</strong><br>
What varies <em>between</em> these clusters? <strong>type of reward</strong></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 9
</div>
<div class="question-body">
<p>Calculate the ICC, using the <code>ICCbare()</code> function from the <strong>ICC</strong> package.</p>
<p>Remember, you can look up the help for a function by typing a <code>?</code> followed by the function name in the console.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-9" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-9', 'sol-start-9')"> Solution </span>
</div>
<div id="sol-body-9" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ICC)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ICCbare</span>(<span class="at">x =</span> sub, <span class="at">y =</span> hrv, <span class="at">data =</span> bball)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3141482</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="statbox">
<p><strong>Understanding ICC a bit better</strong></p>
<p>Think about what ICC represents - the ratio of the variance between the groups to the total variance.<br>
You can think of the “variance between the groups” as the group means varying around the overall mean (the black dots around the black line), and the total variance as that plus the addition of the variance of the individual observations around each group mean (each set of coloured points around their respective larger black dot):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bball, <span class="fu">aes</span>(<span class="at">x=</span>sub, <span class="at">y=</span>hrv))<span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>sub),<span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom =</span> <span class="st">"pointrange"</span>)<span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(bball<span class="sc">$</span>hrv))<span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">col=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can also think of the ICC as the correlation between two randomly drawn observations from the same group. This is a bit of a tricky thing to get your head round if you try to relate it to the type of “correlation” that you are familiar with. Pearson’s correlation (e.g think about a typical scatterplot) operates on <em>pairs of observations</em> (a set of values on the x-axis and their corresponding values on the y-axis), whereas ICC operates on <em>data which is structured in groups</em>.</p>
<div class="optional-begin">
<span id="opt-start-10" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-10', 'opt-start-10')"> <span class="olab">Optional - ICC as the expected correlation between two observations from same group</span></span>
</div>
<div id="opt-body-10" class="optional-body" style="display: none;">
<p>Let’s suppose we had only 2 observations in each group.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>  cluster observation   y
1 group_1           1   4
2 group_1           2   2
3 group_2           1   4
4 group_2           2   2
5 group_3           1   7
6 group_3           2   5
7     ...         ... ...</code></pre>
</div>
</div>
<p>The ICC for this data is 0.18:</p>
<p>Now suppose we <em>reshape</em> our data so that we have one row per group, and one column for each observation to look like this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  cluster obs1  obs2 
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
1 group_1 4     2    
2 group_2 4     2    
3 group_3 7     5    
4 group_4 2     7    
5 group_5 3     8    
6 group_6 6     7    
7 ...     ...   ...  </code></pre>
</div>
</div>
<p>Calculating Pearson’s correlation on those two columns yields 0.2, which isn’t quite right. It’s close, but not quite..</p>
<div class="imp">
<p>The crucial thing here is that it is completely arbitrary which observations get called “obs1” and which get called “obs2”.<br>
The data aren’t paired, but <strong>grouped.</strong></p>
</div>
<p>Essentially, there are lots of different combinations of “pairs” here. There are the ones we have shown above:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  cluster obs1  obs2 
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
1 group_1 4     2    
2 group_2 4     2    
3 group_3 7     5    
4 group_4 2     7    
5 group_5 3     8    
6 group_6 6     7    
7 ...     ...   ...  </code></pre>
</div>
</div>
<p>But we might have equally chosen these:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  cluster obs1  obs2 
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
1 group_1 2     4    
2 group_2 2     4    
3 group_3 5     7    
4 group_4 7     2    
5 group_5 3     8    
6 group_6 6     7    
7 ...     ...   ...  </code></pre>
</div>
</div>
<p>or these:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  cluster obs1  obs2 
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
1 group_1 2     4    
2 group_2 4     2    
3 group_3 7     5    
4 group_4 2     7    
5 group_5 3     8    
6 group_6 6     7    
7 ...     ...   ...  </code></pre>
</div>
</div>
<p>If we take the correlation of all these combinations of pairings, then we get our ICC of 0.18!</p>
<p><strong>ICC = the expected correlation of a <em>randomly drawn pair</em> of observations from the same group.</strong></p>
<!-- We could even do this via simulation, and write our own customised function! -->
<!-- The code below creates a function for us to use. Can you figure out how it works?  -->
<!-- ```{r} -->
<!-- get_random_pair <- function(){ -->
<!--   my_sub = sample(unique(bball$sub), 1) -->
<!--   my_obs = sample(bball$hrv[bball$sub == my_sub], size=2) -->
<!--   my_obs -->
<!-- } -->
<!-- ``` -->
<!-- Try it out, by running it several times.  -->
<!-- ```{r} -->
<!-- get_random_pair() -->
<!-- ``` -->
<!-- Now let's make our computer do it loads and loads of times: -->
<!-- ```{r} -->
<!-- # replicate is a way of making R execute the same code repeatedly, n times. -->
<!-- sims <- replicate(1e6, get_random_pair()) -->
<!-- # t() is short for "transpose" and simple rotates the object 90 degrees (so rows become columns and columns become rows) -->
<!-- sims <- t(sims) -->
<!-- cor(sims[,1], sims[,2]) -->
<!-- ``` -->
</div>
<p class="optional-end">
</p>
<p><br><br></p>
<div class="optional-begin">
<span id="opt-start-11" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-11', 'opt-start-11')"> <span class="olab">Optional - Extra difficult. Calculate ICC manually</span></span>
</div>
<div id="opt-body-11" class="optional-body" style="display: none;">
<p>We have equal group sizes here (there are 2 <span class="math inline">\(\times\)</span> 15 participants, each with 20 observations), which makes calculating ICC by hand a lot easier, but it’s still a bit tricky.</p>
<p>Let’s take a look at the formula for ICC</p>
<p><span class="math display">\[
\begin{align}
ICC \; (\rho) = &amp; \frac{\sigma^2_{b}}{\sigma^2_{b} + \sigma^2_e} \\
\qquad \\
= &amp; \frac{\frac{MS_b - MS_e}{k}}{\frac{MS_b - MS_e}{k} + MS_e} \\
\qquad \\
= &amp; \frac{MS_b - MS_e}{MS_b + (k-1)MS_e} \\
\qquad \\
\qquad \\
\text{Where:} &amp; \\
k = &amp; \textrm{number of observations in each group} \\
MS_b = &amp; \textrm{Mean Squares between groups} = \frac{\text{Sums Squares between groups}}{df_\text{groups}}
= \frac{\sum\limits_{i=1}(\bar{y}_i - \bar{y})^2}{\textrm{n groups}-1}\\
MS_e = &amp; \textrm{Mean Squares within groups} \frac{\text{Sums Squares within groups}}{df_\text{within groups}}
= \frac{\sum\limits_{i=1}\sum\limits_{j=1}(y_{ij} - \bar{y_i})^2}{\textrm{n obs}-\textrm{n groups}}\\
\end{align}
\]</span></p>
<p>So we’re going to need to calculate the grand mean of <span class="math inline">\(y\)</span>, the group means of <span class="math inline">\(y\)</span>, and then the various squared differences between group means and grand mean, and between observations and their respective group means.</p>
<p>The code below will give us a new column which is the overall mean of y. This bit is fairly straightforward.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="rtip">
<p>We have seen a lot of the combination of <code>group_by() %&gt;% summarise()</code>, but we can also combine <code>group_by()</code> with <code>mutate()</code>!</p>
</div>
<p>Try the following:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sub) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div class="rtip">
<p><strong>The grouping gets carried forward.</strong></p>
<p>Using <code>group_by()</code> can quite easily land you in trouble if you forget that you have grouped the dataframe.</p>
<p>Look at the output of <code>class()</code> when we have grouped the data. It still mentions something about the grouping.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sub) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bball)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>To remove the grouping, we can use <code>ungroup()</code> (we could also just add this to the end of our code sequence above and re-run it):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(bball)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bball)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</div>
<p>Now we need to create a column which is the squared differences between the observations <span class="math inline">\(y_{ij}\)</span> and the group means <span class="math inline">\(\bar{y_i}\)</span>.<br>
We also want a column which is the squared differences between the group means <span class="math inline">\(\bar{y_i}\)</span> and the overall mean <span class="math inline">\(\bar{y}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> bball <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">within =</span> (hrv<span class="sc">-</span>group_mean)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">between =</span> (group_mean<span class="sc">-</span>grand_mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>And then we want to sum them:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ssbetween <span class="ot">=</span> <span class="fu">sum</span>(bball<span class="sc">$</span>between)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sswithin <span class="ot">=</span> <span class="fu">sum</span>(bball<span class="sc">$</span>within)</span></code></pre></div>
</div>
<p>Finally, we divide them by the degrees of freedom.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Squares between</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>msb <span class="ot">=</span> ssbetween <span class="sc">/</span> (<span class="dv">30-1</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Squares within </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">=</span> sswithin <span class="sc">/</span> (<span class="dv">600-30</span>)</span></code></pre></div>
</div>
<p>And calculate the ICC!!!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ICC</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>(msb<span class="sc">-</span>mse) <span class="sc">/</span>(msb <span class="sc">+</span> (<span class="dv">19</span><span class="sc">*</span>mse))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3141482</code></pre>
</div>
</div>
</div>
<p class="optional-end">
</p>
</div>
<div class="question-begin">
Question 10
</div>
<div class="question-body">
<blockquote class="blockquote">
<p>How do the size and type of potential reward/loss interact to influence levels of stress?</p>
</blockquote>
<p>Using <code>lm()</code>, we might fit the following model to investigate the research question above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(hrv <span class="sc">~</span> stakes<span class="sc">*</span>condition, <span class="at">data =</span> bball)</span></code></pre></div>
</div>
<p>However, we know that this simply ignores that our observations are not independent - we have repeated measures from the same individuals. Given that roughly 30% of the variation in HRV can be attributed to variability between participants (as found when we calculated ICC), we don’t want to mis-attribute this to differences between experimental conditions.</p>
<p>Using the “no pooling” method (i.e., including participant as a fixed effect), becomes difficult because the <code>sub</code> variable (the participant id variable) also uniquely identifies the two conditions. Note that if we fit the following model, some coefficients are not defined.<br>
Try it and see:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(hrv <span class="sc">~</span> stakes<span class="sc">*</span>sub <span class="sc">+</span> stakes<span class="sc">*</span>condition, <span class="at">data=</span>bball)</span></code></pre></div>
</div>
<p>This sort of perfectly balanced design has traditionally been approached with extensions of ANOVA (“repeated measures ANOVA”, “mixed ANOVA”). These methods can partition out variance due to one level of clustering (e.g.&nbsp;subjects), and can examine factorial designs when one factor is within cluster, and the other is between. You can see an example <a href="example_00_anova.html">here</a> if you are interested. However, ANOVA has a lot of constraints - it can’t handle multiple levels of clustering (e.g.&nbsp;children in classes in schools), it will likely require treating variables such as time as a factor, and it’s not great with missing data.<br>
The multi-level model (MLM) provides a more flexible framework, and this is what we will begin to look at next week.</p>
</div>
<p class="question-end">
</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>