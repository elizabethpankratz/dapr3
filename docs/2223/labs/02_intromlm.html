<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DAPR3 - Multilevel Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-hand-o-right')) {
    f.classList.add('fa-hand-o-left')
    f.classList.remove('fa-hand-o-right')
} else {
    f.classList.add('fa-hand-o-right')
    f.classList.remove('fa-hand-o-left')
}
}
</script>

<script src="https://kit.fontawesome.com/120b08a6f5.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DAPR3</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-multi-level-models" role="button" data-bs-toggle="dropdown" aria-expanded="false">Multi Level Models</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-multi-level-models">    
        <li>
    <a class="dropdown-item" href="./01_regressionrefresh.html">
 <span class="dropdown-text">1: Linear Regression | Clustered Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_intromlm.html">
 <span class="dropdown-text">2: Multilevel Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_assumptranef.html">
 <span class="dropdown-text">3: Assumptions, Diagnostics &amp; Random Effect Structures</span></a>
  </li>  
        <li class="dropdown-header">4: Centering in MLM | Logistic</li>
        <li class="dropdown-header">5: Recap</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-dimension-reduction--sem" role="button" data-bs-toggle="dropdown" aria-expanded="false">Dimension reduction &amp; SEM</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-dimension-reduction--sem">    
        <li class="dropdown-header">7: Path Analysis</li>
        <li class="dropdown-header">8: Path Mediation</li>
        <li class="dropdown-header">9: Dimension Reduction</li>
        <li class="dropdown-header">10: EFA: Part 1</li>
        <li class="dropdown-header">11: EFA: Part 2</li>
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introducing-multilevel-models" id="toc-introducing-multilevel-models" class="nav-link active" data-scroll-target="#introducing-multilevel-models">Introducing Multilevel Models</a></li>
  <li><a href="#fitting-multilevel-models" id="toc-fitting-multilevel-models" class="nav-link" data-scroll-target="#fitting-multilevel-models">Fitting Multilevel Models</a>
  <ul class="collapse">
  <li><a href="#introducing-lme4" id="toc-introducing-lme4" class="nav-link" data-scroll-target="#introducing-lme4">Introducing <strong>lme4</strong></a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation">Estimation</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-ml" id="toc-maximum-likelihood-ml" class="nav-link" data-scroll-target="#maximum-likelihood-ml">Maximum Likelihood (ML)</a></li>
  <li><a href="#restricted-maximum-likelihood-reml" id="toc-restricted-maximum-likelihood-reml" class="nav-link" data-scroll-target="#restricted-maximum-likelihood-reml">Restricted Maximum Likelihood (REML)</a></li>
  <li><a href="#model-convergence" id="toc-model-convergence" class="nav-link" data-scroll-target="#model-convergence">Model Convergence</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exercises-intro-mlm" id="toc-exercises-intro-mlm" class="nav-link" data-scroll-target="#exercises-intro-mlm">Exercises: Intro MLM</a>
  <ul class="collapse">
  <li><a href="#cross-sectional-wellbeing-across-scotland" id="toc-cross-sectional-wellbeing-across-scotland" class="nav-link" data-scroll-target="#cross-sectional-wellbeing-across-scotland">Cross-Sectional: Wellbeing Across Scotland</a></li>
  <li><a href="#longitudinal-wellbeing-over-time" id="toc-longitudinal-wellbeing-over-time" class="nav-link" data-scroll-target="#longitudinal-wellbeing-over-time">Longitudinal: Wellbeing Over Time</a></li>
  <li><a href="#repeated-measures-basketballhrv" id="toc-repeated-measures-basketballhrv" class="nav-link" data-scroll-target="#repeated-measures-basketballhrv">Repeated Measures: Basketball/HRV</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multilevel Models</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="lo">
<p><strong>A Note on terminology</strong></p>
<p>The methods we’re going to learn about in the first five weeks of this course are known by lots of different names: “multilevel models”; “hierarchical linear models”; “mixed-effect models”; “mixed models”; “nested data models”; “random coefficient models”; “random-effects models”; “random parameter models”… and so on).</p>
<p>What the idea boils down to is that <strong>model parameters vary at more than one level.</strong> This week, we’re going to explore what that means.</p>
<p>Throughout this course, we will tend to use the terms “mixed effect model”, “linear mixed model (LMM)” and “multilevel model (MLM)” interchangeably.</p>
</div>
<section id="introducing-multilevel-models" class="level1">
<h1>Introducing Multilevel Models</h1>
<div class="yellow">
<p>Multilevel Models (MLMs) (or “Linear Mixed Models” (LMMs)) take the approach of allowing the groups/clusters to vary around our <span class="math inline">\(\beta\)</span> estimates.</p>
<p>In the lectures, we saw this as:</p>
<p><span class="math display">\[
\begin{align}
&amp; \text{for observation }j\text{ in group }i \\
\quad \\
&amp; \text{Level 1:} \\
&amp; \color{red}{y_{ij}}\color{black} = \color{blue}{\beta_{0i} \cdot 1 + \beta_{1i} \cdot x_{ij}}\color{black} + \varepsilon_{ij} \\
&amp; \text{Level 2:} \\
&amp; \color{blue}{\beta_{0i}}\color{black} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
&amp; \color{blue}{\beta_{1i}}\color{black} = \gamma_{10} + \color{orange}{\zeta_{1i}} \\
\quad \\
&amp; \text{Where:} \\
&amp; \gamma_{00}\text{ is the population intercept, and }\color{orange}{\zeta_{0i}}\color{black}\text{ is the deviation of group }i\text{ from }\gamma_{00} \\
&amp; \gamma_{10}\text{ is the population slope, and }\color{orange}{\zeta_{1i}}\color{black}\text{ is the deviation of group }i\text{ from }\gamma_{10} \\
\end{align}
\]</span></p>
<p>We are now assuming <span class="math inline">\(\color{orange}{\zeta_0}\)</span>, <span class="math inline">\(\color{orange}{\zeta_1}\)</span>, and <span class="math inline">\(\varepsilon\)</span> to be normally distributed with a mean of 0, and we denote their variances as <span class="math inline">\(\sigma_{\color{orange}{\zeta_0}}^2\)</span>, <span class="math inline">\(\sigma_{\color{orange}{\zeta_1}}^2\)</span>, <span class="math inline">\(\sigma_\varepsilon^2\)</span> respectively.</p>
<p>The <span class="math inline">\(\color{orange}{\zeta}\)</span> components also get termed the “random effects” part of the model, Hence names like “random effects model”, etc.</p>
<div class="optional-begin">
<span id="opt-start-1" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-1', 'opt-start-1')"> <span class="olab">Optional Alternative notation</span></span>
</div>
<div id="opt-body-1" class="optional-body" style="display: none;">
<p>Many people use the symbol <span class="math inline">\(u\)</span> in place of <span class="math inline">\(\zeta\)</span>.<br>
In various resources, you are likely to see <span class="math inline">\(\alpha\)</span> used to denote the intercept instead of <span class="math inline">\(\beta_0\)</span>.</p>
<p>Sometimes, you will see the levels collapsed into one equation, as it might make for more intuitive reading. This often fits with the name “mixed effects” for these models:</p>
<p><span class="math display">\[
\color{red}{y_{ij}}\color{black} = (\color{blue}{\beta_0}\color{black} + \color{orange}{\zeta_{0i}}\color{black}) \cdot 1 + ( \color{blue}{\beta_{1}}\color{black} + \color{orange}{\zeta_{1i}} \color{black}) \cdot x_{ij}  +  \varepsilon_{ij} \\
\]</span></p>
<p>And then we also have the condensed matrix form of the model, in which the Z matrix represents the grouping structure, and the <span class="math inline">\(u\)</span> (or <span class="math inline">\(\zeta\)</span>) are the estimated random deviations.</p>
<p><span class="math display">\[
\mathbf{y} = \boldsymbol{X\beta} + \boldsymbol{Zu} + \boldsymbol{\varepsilon}
\]</span></p>
</div>
<p class="optional-end">
</p>
</div>
</section>
<section id="fitting-multilevel-models" class="level1">
<h1>Fitting Multilevel Models</h1>
<section id="introducing-lme4" class="level2">
<h2 class="anchored" data-anchor-id="introducing-lme4">Introducing <strong>lme4</strong></h2>
<div class="rtip">
<p>We’re going to use the <code>lme4</code> package, and specifically the functions <code>lmer()</code> and <code>glmer()</code>.<br>
“(g)lmer” here stands for “(generalised) linear mixed effects regression”.</p>
You will have seen some use of these functions in the lectures. The broad syntax is:<br>
<br>
<div style="margin-left:50px;">
<strong>lmer(<em>formula</em>, REML = <em>logical</em>, data = <em>dataframe</em>)</strong>
</div>
<p><br></p>
<p>We write the first bit of our <strong>formula</strong> just the same as our old friend the normal linear model <code>y ~ 1 + x + x2 + ...</code>, where <code>y</code> is the name of our outcome variable, <code>1</code> is the intercept (which we don’t have to explicitly state as it will be included anyway) and <code>x</code>, <code>x2</code> etc are the names of our explanatory variables.</p>
<p>With <strong>lme4</strong>, we now have the addition of __random effect terms)), specified in parenthesis with the <code>|</code> operator (the vertical line | is often found to the left of the z key on QWERTY keyboards).<br>
We use the <code>|</code> operator to separate the parameters (intercept, slope etc.) on the LHS, from the grouping variable(s) on the RHS, by which we would like to model these parameters as varying.</p>
<p><strong>Random Intercept</strong><br>
Let us suppose that we wish to model our intercept not as a fixed constant, but as varying randomly according to some grouping around a fixed center. We can such a model by allowing the intercept to vary by our grouping variable (<code>g</code> below):</p>
<div class="statbox">
<center>
<code>lmer(y ~ 1 + x + (1|g), data = df)</code>
</center>
<p><span class="math display">\[
\begin{align}
&amp; \text{Level 1:} \\
&amp; \color{red}{Y_{ij}} = \color{blue}{\beta_{0i} \cdot 1 + \beta_{1} \cdot X_{ij}} + \varepsilon_{ij} \\
&amp; \text{Level 2:} \\
&amp; \color{blue}{\beta_{0i}} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
\end{align}
\]</span></p>
</div>
<p><strong>Random Slope</strong><br>
By extension we can also allow the effect <code>y~x</code> to vary between groups, by including the <code>x</code> on the left hand side of <code>|</code> in the random effects part of the call to <code>lmer()</code>.</p>
<div class="statbox">
<center>
<code>lmer(y ~ 1 + x + (1 + x |g), data = df)</code>
</center>
<p><span class="math display">\[
\begin{align}
&amp; \text{Level 1:} \\
&amp; \color{red}{y_{ij}} = \color{blue}{\beta_{0i} \cdot 1 + \beta_{1i} \cdot x_{ij}} + \varepsilon_{ij} \\
&amp; \text{Level 2:} \\
&amp; \color{blue}{\beta_{0i}} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
&amp; \color{blue}{\beta_{1i}} = \gamma_{10} + \color{orange}{\zeta_{1i}} \\
\end{align}
\]</span></p>
</div>
</div>
</section>
<section id="estimation" class="level2">
<h2 class="anchored" data-anchor-id="estimation">Estimation</h2>
<section id="maximum-likelihood-ml" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-ml">Maximum Likelihood (ML)</h3>
<p>Remember back to DAPR2 when we introduced logistic regression, and we briefly discussed <strong>Maximum likelihood</strong> in an explanation of how models are fitted.</p>
<p>The key idea of <em>maximum likelihood estimation</em> (MLE) is that we (well, the computer) iteratively finds the set of estimates for our model which it considers to best reproduce our observed data. Recall our simple linear regression model of how time spent outdoors (hrs per week) is associated with mental wellbeing:</p>
<p><span class="math display">\[
\color{red}{Wellbeing_i} = \color{blue}{\beta_0 \cdot{} 1 + \beta_1 \cdot{} OutdoorTime_{i}} + \varepsilon_i
\]</span></p>
<p>There are values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma_\varepsilon\)</span> which maximise the probability of observing the data that we have. For linear regression, these we obtained these same values a different way, via minimising the sums of squares. And we saw that this is not possible for more complex models (e.g., logistic), which is where we turn to MLE.</p>
<div class="statbox">
<p>To read about the subtle difference between “likelihood” and “probability”, you can find a short explanation <a href="./lvp.html" target="_blank">here</a></p>
</div>
<p>If we are estimating just one single parameter (e.g.&nbsp;a mean), then we can imagine the process of <em>maximum likelihood estimation</em> in a one-dimensional world - simply finding the top of the curve:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mle" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/intro/mle.png" class="img-fluid figure-img" width="350"></p>
<p></p><figcaption class="figure-caption">Figure 1: MLE</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>However, our typical models estimate a whole bunch of parameters. The simple regression model above is already having to estimate <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma_\varepsilon\)</span>, and our multi-level models have far more! With lots of parameters being estimated and all interacting to influence the likelihood, our nice curved line becomes a complex surface (see Left panel of <a href="#fig-multisurf">Figure&nbsp;2</a>). So what we (our computers) need to do is find the maximum, but avoid local maxima and singularities (see <a href="#fig-maxima">Figure&nbsp;3</a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multisurf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/multisurftb.png" class="img-fluid figure-img" style="width:49.0%"></p>
<p></p><figcaption class="figure-caption">Figure 2: MLE for a more complex model</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="restricted-maximum-likelihood-reml" class="level3">
<h3 class="anchored" data-anchor-id="restricted-maximum-likelihood-reml">Restricted Maximum Likelihood (REML)</h3>
<p>When it comes to estimating multilevel models, maximum likelihood will consider the fixed effects as unknown values in its estimation of the variance components (the random effect variances). This leads to biased estimates of the variance components, specifically biasing them toward being too small, especially if <span class="math inline">\(n_\textrm{clusters} - n_\textrm{level 2 predictors} - 1 &lt; 50\)</span>. Restricted Maximum Likelihood (REML), however, separates the estimation of fixed and random parts of the model, leading to unbiased estimates of the variance components.</p>
<div class="rtip">
<p><code>lmer()</code> models are by default fitted with REML. This is better for small samples.</p>
</div>
<div class="sticky">
<p><strong>Model Comparisons in MLM</strong></p>
<p>When we compare models that differ in their fixed effects via comparing model deviance (e.g.&nbsp;the likelihood ratio), REML should <strong>not</strong> be used as only the variance components are included in the likelihood. Functions like <code>anova()</code> will automatically refit your models with <code>ML</code> for you, but it is worth checking.</p>
<p>We <strong>cannot</strong> compare (either with ML or REML) models that differ in both the fixed and random parts.</p>
</div>
</section>
<section id="model-convergence" class="level3">
<h3 class="anchored" data-anchor-id="model-convergence">Model Convergence</h3>
<p>For large datasets and/or complex models (lots of random-effects terms), it is quite common to get a <em>convergence warning</em>. There are lots of different ways to <a href="https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html">deal with these</a> (to try to rule out hypotheses about what is causing them).</p>
<p>For now, if <code>lmer()</code> gives you convergence errors, you could try changing the optimizer. Bobyqa is a good one: add <code>control = lmerControl(optimizer = "bobyqa")</code> when you run your model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lmer</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x1 <span class="sc">+</span> ... <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> .... <span class="sc">|</span> g), <span class="at">data =</span> df, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span></code></pre></div>
</div>
<div class="optional-begin">
<span id="opt-start-2" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-2', 'opt-start-2')"> <span class="olab">What <em>is</em> a convergence warning??</span></span>
</div>
<div id="opt-body-2" class="optional-body" style="display: none;">
<p>There are different techniques for maximum likelihood estimation, which we apply by using different ‘optimisers’. Technical problems to do with <strong>model convergence</strong> and <strong>‘singular fit’</strong> come into play when the optimiser we are using either can’t find a suitable maximum, or gets stuck in a singularity (think of it like a black hole of likelihood, which signifies that there is not enough variation in our data to construct such a complex model).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-maxima" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/intro/mle2.png" class="img-fluid figure-img" style="width:49.0%"></p>
<p></p><figcaption class="figure-caption">Figure 3: local/global maxima and singularities</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p class="optional-end">
</p>
</section>
</section>
</section>
<section id="exercises-intro-mlm" class="level1">
<h1>Exercises: Intro MLM</h1>
<section id="cross-sectional-wellbeing-across-scotland" class="level2">
<h2 class="anchored" data-anchor-id="cross-sectional-wellbeing-across-scotland">Cross-Sectional: Wellbeing Across Scotland</h2>
<div class="frame">
<p>Recall our dataset from last week, in which we used linear regression to determine how outdoor time (hours per week) is associated with wellbeing in different local authority areas (LAAs) of Scotland. We have data from various LAAs, from Glasgow City, to the Highlands.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>scotmw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/LAAwellbeing.csv"</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="lizlutdnzk" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lizlutdnzk .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lizlutdnzk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lizlutdnzk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lizlutdnzk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lizlutdnzk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lizlutdnzk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lizlutdnzk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lizlutdnzk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lizlutdnzk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lizlutdnzk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lizlutdnzk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lizlutdnzk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lizlutdnzk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lizlutdnzk .gt_from_md > :first-child {
  margin-top: 0;
}

#lizlutdnzk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lizlutdnzk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lizlutdnzk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lizlutdnzk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lizlutdnzk .gt_row_group_first td {
  border-top-width: 2px;
}

#lizlutdnzk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lizlutdnzk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lizlutdnzk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lizlutdnzk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lizlutdnzk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lizlutdnzk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lizlutdnzk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lizlutdnzk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lizlutdnzk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lizlutdnzk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lizlutdnzk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lizlutdnzk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lizlutdnzk .gt_left {
  text-align: left;
}

#lizlutdnzk .gt_center {
  text-align: center;
}

#lizlutdnzk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lizlutdnzk .gt_font_normal {
  font-weight: normal;
}

#lizlutdnzk .gt_font_bold {
  font-weight: bold;
}

#lizlutdnzk .gt_font_italic {
  font-style: italic;
}

#lizlutdnzk .gt_super {
  font-size: 65%;
}

#lizlutdnzk .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#lizlutdnzk .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lizlutdnzk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lizlutdnzk .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#lizlutdnzk .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#lizlutdnzk .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">ppt</td>
<td class="gt_row gt_left">Participant ID</td></tr>
    <tr><td class="gt_row gt_left">name</td>
<td class="gt_row gt_left">Participant Name</td></tr>
    <tr><td class="gt_row gt_left">laa</td>
<td class="gt_row gt_left">Local Authority Area</td></tr>
    <tr><td class="gt_row gt_left">outdoor_time</td>
<td class="gt_row gt_left">Self report estimated number of hours per week spent outdoors</td></tr>
    <tr><td class="gt_row gt_left">wellbeing</td>
<td class="gt_row gt_left">Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.</td></tr>
    <tr><td class="gt_row gt_left">density</td>
<td class="gt_row gt_left">LAA Population Density (people per square km)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<div class="question-begin">
Question 1
</div>
<div class="question-body">
<p>Using <code>lmer()</code> from the <strong>lme4</strong> package, fit a model predict <code>wellbeing</code> from <code>outdoor_time</code>, with by-LAA random intercepts.<br>
Pass the model to <code>summary()</code> to see the output.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-3" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-3', 'sol-start-3')"> Solution </span>
</div>
<div id="sol-body-3" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ri_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> laa), <span class="at">data =</span> scotmw)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ri_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: wellbeing ~ outdoor_time + (1 | laa)
   Data: scotmw

REML criterion at convergence: 866.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.2218 -0.7192  0.1217  0.6395  1.8287 

Random effects:
 Groups   Name        Variance Std.Dev.
 laa      (Intercept) 106.23   10.307  
 Residual              25.46    5.046  
Number of obs: 132, groups:  laa, 20

Fixed effects:
             Estimate Std. Error t value
(Intercept)  38.18979    2.64778   14.42
outdoor_time  0.21349    0.07236    2.95

Correlation of Fixed Effects:
            (Intr)
outdoor_tim -0.463</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 2
</div>
<div class="question-body">
<p>Sometimes the easiest way to start understanding your model is to visualise it.</p>
<p>Load the package <strong>broom.mixed</strong>. Along with some handy functions <code>tidy()</code> and <code>glance()</code> which give us the information we see in <code>summary()</code>, there is a handy function called <code>augment()</code> which returns us the data in the model plus the fitted values, residuals, hat values, Cook’s D etc..</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ri_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(wellbeing <span class="sc">~</span> outdoor_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> laa), <span class="at">data =</span> scotmw)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(ri_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132 × 14
   wellbeing outdoor_t…¹ laa   .fitted .resid  .hat .cooksd .fixed   .mu .offset
       &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1        37          20 West…    32.4  4.64  0.139 7.91e-2   42.5  32.4       0
 2        34          23 Falk…    31.7  2.28  0.192 3.00e-2   43.1  31.7       0
 3        39          29 Falk…    33.0  6.00  0.195 2.13e-1   44.4  33.0       0
 4        42          21 Scot…    40.1  1.95  0.163 1.74e-2   42.7  40.1       0
 5        37          10 Dumf…    37.4 -0.407 0.167 7.84e-4   40.3  37.4       0
 6        42          19 Argy…    43.9 -1.91  0.122 1.12e-2   42.2  43.9       0
 7        38          13 Pert…    46.1 -8.06  0.139 2.39e-1   41.0  46.1       0
 8        44          21 East…    44.4 -0.414 0.168 8.17e-4   42.7  44.4       0
 9        47          16 Inve…    42.7  4.30  0.193 1.07e-1   41.6  42.7       0
10        35          12 Midl…    33.1  1.94  0.161 1.69e-2   40.8  33.1       0
# … with 122 more rows, 4 more variables: .sqrtXwt &lt;dbl&gt;, .sqrtrwt &lt;dbl&gt;,
#   .weights &lt;dbl&gt;, .wtres &lt;dbl&gt;, and abbreviated variable name ¹​outdoor_time
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>Add to the code below to plot the model fitted values, and color them according to LAA. (you will need to edit <code>ri_model</code> to be whatever name you assigned to your model).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(ri_model) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> ...... </span></code></pre></div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-4" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-4', 'sol-start-4')"> Solution </span>
</div>
<div id="sol-body-4" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(ri_model) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> .fitted, <span class="at">col =</span> laa)) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 3
</div>
<div class="question-body">
<p>We have just fitted the model:</p>
<p><span class="math display">\[
\begin{align}
&amp; \text{For person } j \text{ in LAA } i \\
&amp; \color{red}{\textrm{Wellbeing}_{ij}}\color{black} = \color{blue}{\beta_{0i} \cdot 1 + \beta_{1} \cdot \textrm{Outdoor Time}_{ij}}\color{black} + \varepsilon_{ij} \\
&amp; \color{blue}{\beta_{0i}}\color{black} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
\end{align}
\]</span></p>
<p>For our estimates of <span class="math inline">\(\gamma_{00}\)</span> (the fixed value around which LAA intercepts vary) and <span class="math inline">\(\beta_1\)</span> (the fixed estimate of the relationship between wellbeing and outdoor time), we can use <code>fixef()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(ri_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept) outdoor_time 
   38.189795     0.213492 </code></pre>
</div>
</div>
<p>Can you add to the plot in the previous question, a thick black line with the intercept and slope given by <code>fixef()</code>?</p>
<div class="hints">
<p><strong>Hint:</strong> <code>geom_abline()</code></p>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-5" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-5', 'sol-start-5')"> Solution </span>
</div>
<div id="sol-body-5" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(ri_model) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> .fitted, <span class="at">col =</span> laa)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(ri_model)[<span class="dv">1</span>], <span class="at">slope =</span> <span class="fu">fixef</span>(ri_model)[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 4
</div>
<div class="question-body">
By now, you should have a plot which looks more or less like the left-hand figure below (we have added on the raw data - the points).<br>

<div style="display:inline-block; width: 55%;vertical-align: top;">
<div class="cell" data-layout-align="center" data-fig.asp="1">
<div class="cell-output-display">
<div id="fig-modfit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/fig-modfit-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 4: Model fitted values</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div style="display:inline-block; width: 40%;vertical-align: top;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-lmersummap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/intro/summarylmer2.png" class="img-fluid figure-img" width="400"></p>
<p></p><figcaption class="figure-caption">Figure 5: Summary model output<br>lmer(wellbeing~1 + outdoor_time + (1|laa),<br>data = scotmw)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p><br> <br> We’re going to map the parts of the plot in <a href="#fig-modfit">Figure&nbsp;4</a> to the <code>summary()</code> output of the model in <a href="#fig-lmersummap">Figure&nbsp;5</a>. Match the coloured sections Red, Orange, Yellow and Blue in <a href="#fig-lmersummap">Figure&nbsp;5</a> to the descriptions below of <a href="#fig-modfit">Figure&nbsp;4</a> A through D.</p>
<ol type="A">
<li>where the black line cuts the y axis</li>
<li>the standard deviation of the distances from all the individual LAA lines to the black line</li>
<li>the slope of the black line</li>
<li>the standard deviation of the distances from all the individual observations to the line for the LAA to which it belongs.</li>
</ol>
<p>Can you also match those same coloured sections in <a href="#fig-lmersummap">Figure&nbsp;5</a> to the mathematical terms in the model equation:</p>
<p><span class="math display">\[
\begin{align}
&amp; \text{Level 1:} \\
&amp; \color{red}{Wellbeing_{ij}}\color{black} = \color{blue}{\beta_{0i} \cdot 1 + \beta_{1} \cdot OutdoorTime_{ij}}\color{black} + \varepsilon_{ij} \\
&amp; \text{Level 2:} \\
&amp; \color{blue}{\beta_{0i}}\color{black} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
\quad \\
&amp; \text{where} \\
&amp; \color{orange}{\zeta_0}\color{black} \sim N(0, \sigma_{\color{orange}{\zeta_{0}}}\color{black})  \text{ independently} \\
&amp; \varepsilon \sim N(0, \sigma_{\varepsilon}) \text{ independently} \\
\end{align}
\]</span></p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-6" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-6', 'sol-start-6')"> Solution </span>
</div>
<div id="sol-body-6" class="solution-body" style="display: none;">
<ul>
<li>Yellow = B = <span class="math inline">\(\sigma_{\color{orange}{\zeta_{0}}}\)</span></li>
<li>Red = D = <span class="math inline">\(\sigma_{\varepsilon}\)</span><br>
</li>
<li>Blue = A = <span class="math inline">\(\gamma_{00}\)</span><br>
</li>
<li>Orange = C = <span class="math inline">\(\beta_{1}\)</span></li>
</ul>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 5
</div>
<div class="question-body">
<p>Fit a model which allows <em>also</em> (along with the intercept) the effect of <code>outdoor_time</code> to vary by-LAA.</p>
<p>Then, using <code>augment()</code> again, plot the model fitted values. What do you think you will see?<br>
Does it look like this model better represents the individual LAAs? Take a look at, for instance, Glasgow City.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-7" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-7', 'sol-start-7')"> Solution </span>
</div>
<div id="sol-body-7" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>rs_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">|</span> laa), <span class="at">data =</span> scotmw)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(rs_model) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> .fitted, <span class="at">col =</span> laa)) <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>wellbeing), <span class="at">alpha=</span>.<span class="dv">4</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
</section>
<section id="longitudinal-wellbeing-over-time" class="level2">
<h2 class="anchored" data-anchor-id="longitudinal-wellbeing-over-time">Longitudinal: Wellbeing Over Time</h2>
<div class="cell" data-layout-align="center">

</div>
<p>Another very crucial advantage of these methods is that we can use them to study how people change over time.</p>
<div class="frame">
<p><strong>Wellbeing in Work: Longitudinal Data</strong></p>
<p>The Wellbeing in Work data (<code>wellbeingwork3</code>) contains information on employees who were randomly assigned to one of three employment conditions:</p>
<ul>
<li>control: No change to employment. Employees continue at 5 days a week, with standard allocated annual leave quota.<br>
</li>
<li>unlimited_leave : Employees were given no limit to their annual leave, but were still expected to meet required targets as specified in their job description.</li>
<li>fourday_week: Employees worked a 4 day week for no decrease in pay, and were still expected to meet required targets as specified in their job description.</li>
</ul>
<p>Wellbeing was was assessed at baseline (start of maintenance), 12 months post, 24 months post, and 36 months post.</p>
<p>The researchers had two main questions:</p>
<ul>
<li>Overall, did the participants’ wellbeing stay the same or did it change?</li>
<li>Did the employment condition groups differ in the how wellbeing changed over the assessment period?</li>
</ul>
<p>The data is available, in <strong>.rda</strong> format, at <a href="https://uoepsy.github.io/data/wellbeingwork3.rda">https://uoepsy.github.io/data/wellbeingwork3.rda</a>. You can read it directly into your R environment using:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://uoepsy.github.io/data/wellbeingwork3.rda"</span>))</span></code></pre></div>
</div>
</div>
<div class="question-begin">
Question 6
</div>
<div class="question-body">
<blockquote class="blockquote">
<p>Q: Overall, did the participants’ wellbeing stay the same or did it change?</p>
</blockquote>
<p>Each of our participants have measurements at 4 assessments. We need to think about what this means for the <strong>random effects</strong> that we will include in our model (our <strong>random effect structure</strong>). Would we like our models to accommodate individuals to vary in their overall wellbeing, to vary in how they change in wellbeing over the course of the assessment period, or both?</p>
<p>To investigate whether wellbeing changed over the course of the assessments, or whether it stayed the same, we could fit and compare 2 models:</p>
<ol type="1">
<li>The “null” or “intercept-only” model.</li>
<li>A model with wellbeing predicted by time point.</li>
</ol>
<p>And we can then compare them in terms of model fit. As discussed in the lecture, there are lots of ways to assess inference in multilevel models.</p>
<p>Our sample size here (180 participants, each with 4 observations) is reasonably large given the relative simplicity of our model. We might consider running a straightforward Likelihood Ratio Test using <code>anova(restricted_model, full_model)</code> to compare our two models.</p>
<div class="hints">
<ul>
<li><strong>Remember, we shouldn’t compare models with different random effect structures.</strong><br>
</li>
<li><em>(For now, don’t worry too much about “singular fits”. We’ll talk more about how we might deal with them next week!)</em></li>
</ul>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-8" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-8', 'sol-start-8')"> Solution </span>
</div>
<div id="sol-body-8" class="solution-body" style="display: none;">
<p>This is our null model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>m.null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data=</span>wellbeingwork3)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.null)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: Wellbeing ~ 1 + (1 | ID)
   Data: wellbeingwork3

REML criterion at convergence: 4395.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.5195 -0.6051 -0.0456  0.5895  3.5966 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  4.82    2.195   
 Residual             22.48    4.741   
Number of obs: 720, groups:  ID, 180

Fixed effects:
            Estimate Std. Error t value
(Intercept)  40.0431     0.2408   166.3</code></pre>
</div>
</div>
<p>We can see the <code>4.82 / (4.82 + 22.48)</code>, or 0.18 of the total variance is attributable to participant-level variation.</p>
<p>Now lets suppose we want to compare this null model with a model with an effect of <code>TimePoint</code> (to assess whether there is overall change over time). Which model should we compare <code>m.null</code> to?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>modA <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">|</span> ID), <span class="at">data=</span>wellbeingwork3)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>modB <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data=</span>wellbeingwork3)</span></code></pre></div>
</div>
<p>A comparison between these <code>m.null</code> and <code>modA</code> will not be assessing the influence of <em>only</em> the fixed effect of TimePoint.</p>
<p>Remember, we shouldn’t compare models with different random effect structures.</p>
<p>However, <code>modB</code> doesn’t include our by-participant random effects of timepoint, so comparing this to <code>m.null</code> is potentially going to mis-attribute random deviations in participants’ change to being an overall effect of timepoint.</p>
<p>If we want to conduct a model comparison to isolate the effect of overall change over time (a fixed effect of <code>TimePoint</code>), we <em>might</em> want to compare these two models:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m.base0 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">|</span> ID), <span class="at">data=</span>wellbeingwork3)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>m.base <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">|</span> ID), <span class="at">data=</span>wellbeingwork3)</span></code></pre></div>
</div>
<p>The first of these models is a bit weird to think about - how can we have by-participant random deviations of <code>TimePoint</code> if we don’t have a fixed effect of <code>TimePoint</code>? That makes very little sense. What it is actually fitting is a model where there is assumed to be <strong>no overall effect</strong> of TimePoint. So the fixed effect is 0.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Straightforward LRT</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.base0, m.base)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: wellbeingwork3
Models:
m.base0: Wellbeing ~ 1 + (1 + TimePoint | ID)
m.base: Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID)
        npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
m.base0    5 4202.4 4225.2 -2096.2   4192.4                         
m.base     6 4171.7 4199.2 -2079.8   4159.7 32.649  1  1.104e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 7
</div>
<div class="question-body">
<blockquote class="blockquote">
<p>Q: Did the employment condition groups differ in the how wellbeing changed over the assessment period?</p>
</blockquote>
<div class="hints">
<p><strong>Hint:</strong> It helps to break it down. There are two questions here:</p>
<ol type="1">
<li>do groups differ overall?<br>
</li>
<li>do groups differ over time?</li>
</ol>
<p>We can begin to see that we’re asking two questions about the <code>Condition</code> variable here: “is there an effect of Condition?” and “Is there an interaction between TimePoint and Condition?”.</p>
<p>Try fitting two more models which incrementally build these levels of complexity, and compare them (perhaps to one another, perhaps to models from the previous question - think about what each comparison is testing!)</p>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-9" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-9', 'sol-start-9')"> Solution </span>
</div>
<div id="sol-body-9" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m.int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">+</span> Condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">|</span> ID), </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>wellbeingwork3)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>m.full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Wellbeing <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span> TimePoint<span class="sc">*</span>Condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> TimePoint <span class="sc">|</span> ID), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>wellbeingwork3)</span></code></pre></div>
</div>
<p>We’re going to compare each model to the previous one to examine the improvement in fit due to inclusion of each parameter. We could do this quickly with</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.base0, m.base, m.int, m.full)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: wellbeingwork3
Models:
m.base0: Wellbeing ~ 1 + (1 + TimePoint | ID)
m.base: Wellbeing ~ 1 + TimePoint + (1 + TimePoint | ID)
m.int: Wellbeing ~ 1 + TimePoint + Condition + (1 + TimePoint | ID)
m.full: Wellbeing ~ 1 + TimePoint * Condition + (1 + TimePoint | ID)
        npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
m.base0    5 4202.4 4225.2 -2096.2   4192.4                         
m.base     6 4171.7 4199.2 -2079.8   4159.7 32.649  1  1.104e-08 ***
m.int      8 4164.3 4200.9 -2074.2   4148.3 11.393  2   0.003358 ** 
m.full    10 4144.6 4190.4 -2062.3   4124.6 23.711  2  7.098e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="int">
<p>Conditions differed overall in wellbeing change <span class="math inline">\(\chi^2(2)=11.39, p = .003\)</span><br>
Conditions differed in change over assessment period <span class="math inline">\(\chi^2(2)=23.71, p &lt; .001\)</span></p>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 8
</div>
<div class="question-body">
<ul>
<li>Examine the parameter estimates and interpret them (i.e., what does each parameter represent?)</li>
<li>Make a graph of the model fit <em>and</em> the observed data.</li>
</ul>
<div class="hints">
<p><strong>Hints:</strong></p>
<ul>
<li>We can get the fixed effects using <code>fixef(model)</code>, and we can also use <code>tidy(model)</code> from the <strong>broom.mixed</strong> package, and similar to <code>lm</code> models in DAPR2, we can pull out the bit of the <code>summary()</code> using <code>summary(model)$coefficients</code>.<br>
</li>
<li>There are lots of ways you can visualise the model, try a couple:
<ol type="1">
<li>Using the <strong>effects</strong> package, does this help: <code>as.data.frame(effect("TimePoint:Condition", model))</code><br>
</li>
<li>Using <code>fitted(model)</code></li>
<li>Using <code>augment()</code> from the <strong>broom.mixed</strong> package.<br>
</li>
<li><strong>sjPlot</strong>, as we used in DAPR2</li>
</ol></li>
</ul>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-10" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-10', 'sol-start-10')"> Solution </span>
</div>
<div id="sol-body-10" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                                   Estimate Std. Error t value
(Intercept)                          38.352      0.398  96.456
TimePoint                            -0.023      0.325  -0.072
Conditionunlimited_leave             -0.018      0.562  -0.033
Conditionfourday_week                -0.260      0.562  -0.462
TimePoint:Conditionunlimited_leave    1.357      0.460   2.951
TimePoint:Conditionfourday_week       2.282      0.460   4.963</code></pre>
</div>
</div>
<ul>
<li><code>(Intercept)</code> ==&gt; Wellbeing at baseline in ‘control’ group</li>
<li><code>TimePoint</code> ==&gt; Slope of welleing change in ‘control’ group</li>
<li><code>Conditionunlimited_leave</code> ==&gt; baseline wellbeing difference from ‘unlimited_leave’ group relative to ‘control’ group</li>
<li><code>Conditionfourday_week</code> ==&gt; baseline wellbeing difference from ‘fourday_week’ group relative to ‘control’ group</li>
<li><code>TimePoint:Conditionunlimited_leave</code> ==&gt; slope of wellbeing change in ‘unlimited_leave’ group relative to ‘control’ group</li>
<li><code>TimePoint:Conditionfourday_week</code> ==&gt; slope of wellbeing change in ‘fourday_week’ group relative to ‘control’ group</li>
</ul>
<div class="int">
<p>Compared to the control group, wellbeing increased by 1.35 points/year more for employees with unlimited leave, and by 2.28 points/year for employees on the 4 day week.</p>
</div>
<p>To visualise the model fitted values and observed data, there are various options to choose from.</p>
<ol type="1">
<li>Using the <code>effect()</code> function (and then adding the means and SEs from the original data):</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">effect</span>(<span class="st">"TimePoint:Condition"</span>, m.full))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ef, <span class="fu">aes</span>(TimePoint, fit, <span class="at">color=</span>Condition)) <span class="sc">+</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">data=</span>wellbeingwork3, <span class="fu">aes</span>(<span class="at">y=</span>Wellbeing), </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fun.data=</span>mean_se, <span class="at">geom=</span><span class="st">"pointrange"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Using the <code>fitted()</code> function to extract and plot fitted values from the model:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wellbeingwork3, <span class="fu">aes</span>(TimePoint, Wellbeing, <span class="at">color=</span>Condition)) <span class="sc">+</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data=</span>mean_se, <span class="at">geom=</span><span class="st">"pointrange"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">fitted</span>(m.full)), <span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>) <span class="sc">+</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Or using <code>augment()</code>:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m.full) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(., <span class="fu">aes</span>(TimePoint, Wellbeing, <span class="at">color=</span>Condition)) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data=</span>mean_se, <span class="at">geom=</span><span class="st">"pointrange"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">y=</span>.fitted), <span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>) <span class="sc">+</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>finally, <strong>sjPlot</strong> can give us the model fitted values, but it’s trickier to add on the observed means. We can add the raw data using <code>show.data=TRUE</code>, but that will make it a bit messier</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m.full, <span class="at">type=</span><span class="st">"int"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_intromlm_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
</section>
<section id="repeated-measures-basketballhrv" class="level2">
<h2 class="anchored" data-anchor-id="repeated-measures-basketballhrv">Repeated Measures: Basketball/HRV</h2>
<p>While the wellbeing example considers the groupings or ‘clusters’ of different LAAs, a more relate-able grouping in psychological research is that of several observations belonging to the same individual. One obvious benefit of this is that we can collect many more observations with fewer participants, and account for the resulting dependency of observations.</p>
<div class="frame">
<p>Recall the data from the previous week, from an experiment in which heart rate variability (HRV) was measured for amateur basketball players when tasked with scoring a goal with varying levels and type of potential loss/reward.</p>
<p>A separate group of researchers conducted a replication of this experiment with 15 participants. There were some issues with the HRV measurements resulting in some missing data, and one participant being excluded completely (meaning a slightly unbalanced design in that 8 participants were in one condition and only 7 in the other).</p>
<p>You can find the data at: <a href="https://uoepsy.github.io/data/bball_replication.csv">https://uoepsy.github.io/data/bball_replication.csv</a> It contains the following variables:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="qnrbtqjawa" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qnrbtqjawa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qnrbtqjawa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qnrbtqjawa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qnrbtqjawa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qnrbtqjawa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qnrbtqjawa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qnrbtqjawa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qnrbtqjawa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qnrbtqjawa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qnrbtqjawa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qnrbtqjawa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qnrbtqjawa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qnrbtqjawa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qnrbtqjawa .gt_from_md > :first-child {
  margin-top: 0;
}

#qnrbtqjawa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qnrbtqjawa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qnrbtqjawa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qnrbtqjawa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qnrbtqjawa .gt_row_group_first td {
  border-top-width: 2px;
}

#qnrbtqjawa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qnrbtqjawa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qnrbtqjawa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qnrbtqjawa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qnrbtqjawa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qnrbtqjawa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qnrbtqjawa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qnrbtqjawa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qnrbtqjawa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qnrbtqjawa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qnrbtqjawa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qnrbtqjawa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qnrbtqjawa .gt_left {
  text-align: left;
}

#qnrbtqjawa .gt_center {
  text-align: center;
}

#qnrbtqjawa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qnrbtqjawa .gt_font_normal {
  font-weight: normal;
}

#qnrbtqjawa .gt_font_bold {
  font-weight: bold;
}

#qnrbtqjawa .gt_font_italic {
  font-style: italic;
}

#qnrbtqjawa .gt_super {
  font-size: 65%;
}

#qnrbtqjawa .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

#qnrbtqjawa .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qnrbtqjawa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qnrbtqjawa .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#qnrbtqjawa .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#qnrbtqjawa .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">stakes</td>
<td class="gt_row gt_left">Size of reward (points to be won/lost on a given trial). Ranges 1 to 20</td></tr>
    <tr><td class="gt_row gt_left">condition</td>
<td class="gt_row gt_left">Experimental Condition: Whether the participant was playing for monetary reward ('money') or for a place on the scoreboard ('kudos')</td></tr>
    <tr><td class="gt_row gt_left">sub</td>
<td class="gt_row gt_left">Participant Identifier</td></tr>
    <tr><td class="gt_row gt_left">throw</td>
<td class="gt_row gt_left">Whether the participant successfully completed the trial</td></tr>
    <tr><td class="gt_row gt_left">trial_no</td>
<td class="gt_row gt_left">Trial Number (1 to 20)</td></tr>
    <tr><td class="gt_row gt_left">hrv</td>
<td class="gt_row gt_left">Average Heart Rate Variability over the 10 seconds prior to throwing</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<div class="question-begin">
Question 9
</div>
<div class="question-body">
<p>Recall that the research question was concerned with how the size and type of potential reward influence stress levels (as measured by heart rate variability):</p>
<blockquote class="blockquote">
<p>How do the size and type of potential reward/loss interact to influence levels of stress?</p>
</blockquote>
<p>Fit a multi-level model to examine the effects of size and type of reward on HRV, and their interaction.</p>
<div class="hints">
<p>Remember to think about:</p>
<ul>
<li>what is our outcome variable of interest?</li>
<li>what are our predictor variables that we are interested in?
<ul>
<li>these should be in the fixed effects part.<br>
</li>
</ul></li>
<li>what is the clustering?
<ul>
<li>this should be the random effects <code>(1 | cluster)</code> part</li>
</ul></li>
<li>does size of reward (<code>stakes</code>) vary within clusters, or between?
<ul>
<li>if so, we might be able to fit a random slope of <code>stakes | cluster</code>. if not, then it doesn’t make sense to do so.<br>
</li>
</ul></li>
<li>does type of reward (<code>condition</code>) vary within clusters, or between? - if so, we might be able to fit a random slope of <code>condition | cluster</code>. if not, then it doesn’t make sense to do so.</li>
</ul>
<p><em>If you get an error about model convergence, consider changing the optimiser (see <a href="02_intromlm.html#Estimation">above</a>)</em></p>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-11" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-11', 'sol-start-11')"> Solution </span>
</div>
<div id="sol-body-11" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">+</span> stakes <span class="sc">|</span> sub), <span class="at">data =</span> bballrep,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hrv ~ stakes * condition + (1 + stakes | sub)
   Data: bballrep
Control: lmerControl(optimizer = "bobyqa")

REML criterion at convergence: 867

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6415 -0.6182 -0.0401  0.6038  2.7335 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 sub      (Intercept) 2.86473  1.6926        
          stakes      0.01661  0.1289   -0.85
 Residual             0.87768  0.9368        
Number of obs: 288, groups:  sub, 15

Fixed effects:
                      Estimate Std. Error t value
(Intercept)            4.76028    0.61973   7.681
stakes                 0.03215    0.04749   0.677
conditionmoney        -0.24945    0.90583  -0.275
stakes:conditionmoney -0.05519    0.06944  -0.795

Correlation of Fixed Effects:
            (Intr) stakes cndtnm
stakes      -0.851              
conditinmny -0.684  0.582       
stks:cndtnm  0.582 -0.684 -0.850</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<p>We now have a model, but we don’t have any p-values, confidence intervals, or inferential criteria on which to draw conclusions.</p>
<p>In the longitudinal study of wellbeing over time, we did a series of model comparisons, performing tests of the incremental inclusion of additional parameters. In the Basketball/HRV example we went straight for the full model. This is in part because the two research aims of the longitudinal example can be matched two models (one for the “overall” trajectory, and one looking at differences between groups), whereas the Basketball/HRV research question simply is interested in the theorised <code>stakes*condition</code> interaction.</p>
<p>There are some options here for us to choose from for this model: we can either perform tests against the null that certain parameter estimates are equal to zero (i.e.&nbsp;testing that the interaction is zero), or ca wen fit a reduced model and conduct model comparisons between that and the full model (thereby isolating and testing the improvement in the model due to including the interaction term).<br>
There are different methods of implementing these in R, as detailed in the table below. Standard likelihood ratio tests require models to be fitted with ML, and can be less reliable when samples are small (at any level). Often, approximations of the degrees of freedom are preferable, in part because these allow models to be fitted with REML. The more computationally expensive bootstrapping approach is perhaps the most recommended approach as it can provide more accurate p-values for the likelihood ratio test, as well as confidence intervals for our estimates, but for larger models it can take a lot of time to compute. Additionally, when performing the bootstrap it is important to watch out for issues with convergence in the bootstrap iterations - it may indicate your model needs simplification.</p>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 31%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Method</th>
<th style="text-align: right;">Model Comparison</th>
<th style="text-align: right;">Parameter Estimation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Approximations to <span class="math inline">\(ddf\)</span></td>
<td style="text-align: right;">Kenward-Rogers: <code>KRmodcomp(model2, model1)</code> from the <strong>pbkrtest</strong> package</td>
<td style="text-align: right;">Satterthwaite: load the <strong>lmerTest</strong> package and re-fit your model (the summary output will then have p-values)</td>
</tr>
<tr class="even">
<td style="text-align: right;">Likelihood Ratio Test</td>
<td style="text-align: right;"><code>anova(model1, model2)</code></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Parametric Bootstrap</td>
<td style="text-align: right;"><code>PBmodcomp(model2, model1)</code> from the <strong>pbkrtest</strong> package</td>
<td style="text-align: right;"><code>confint(model, method="boot")</code></td>
</tr>
</tbody>
</table>
<div class="question-begin">
Question 10
</div>
<div class="question-body">
<p>This study is interested in whether the previously reported interaction between size (<code>stakes</code>) and type (<code>condition)</code> of reward on stress levels - measured by heart-rate variability (<code>hrv</code>) - replicates in their new sample.</p>
<p>Pick a method of your choosing and perform a test of/provide an interval for the relevant effect of interest.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-12" class="fa fa-hand-o-right solution-icon clickable" onclick="toggle_visibility('sol-body-12', 'sol-start-12')"> Solution </span>
</div>
<div id="sol-body-12" class="solution-body" style="display: none;">
<p>In this case we have <span class="math inline">\(n=15\)</span> participants (our level 2 sample size), and each participant has approximately 20 observations (but some have missingness). The sample size might be a bit small for standard likelihood ratio tests (i.e.&nbsp;comparing models fitted with ML rather than REML). We would be better off using models fitted with REML because they will provide more accurate estimates of the variance components (the <code>1+stakes|sub</code> bit), and so better estimates of the standard errors of the fixed effects.</p>
<p>We’ll go through each approach here so you can see what it looks like. There’s no <em>right</em> answer here.</p>
<p><strong>Standard LRT</strong></p>
<p>If we choose a model comparison approach, we need to isolate the interaction term, because that’s what we’re interested in:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mod_res <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">+</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> stakes <span class="sc">|</span> sub), <span class="at">data =</span> bballrep,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">*</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> stakes <span class="sc">|</span> sub), <span class="at">data =</span> bballrep,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span></code></pre></div>
</div>
<p>This needs models fitted with ML rather than REML, but it will automatically re-fit them for you:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_res, mod_full)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>refitting model(s) with ML (instead of REML)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: bballrep
Models:
mod_res: hrv ~ stakes + condition + (1 + stakes | sub)
mod_full: hrv ~ stakes * condition + (1 + stakes | sub)
         npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
mod_res     7 872.33 897.97 -429.17   858.33                     
mod_full    8 873.62 902.93 -428.81   857.62 0.7111  1     0.3991</code></pre>
</div>
</div>
<div class="int">
<p>Inclusion of the interaction between size and type of reward was not found to improve model fit, as indicated by a likelihood ratio test (<span class="math inline">\(\chi^2(1) = 0.71, p = .399\)</span>).</p>
</div>
<p><strong>df approximations</strong></p>
<p>If instead we choose the approximation for degrees of freedom, then generally speaking the Kenward Rogers approach is preferable as it is a little more conservative.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pbkrtest)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">KRmodcomp</span>(mod_full, mod_res)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>large : hrv ~ stakes * condition + (1 + stakes | sub)
small : hrv ~ stakes + condition + (1 + stakes | sub)
         stat     ndf     ddf F.scaling p.value
Ftest  0.6317  1.0000 12.9927         1   0.441</code></pre>
</div>
</div>
<div class="int">
<p>Inclusion of the interaction between size and type of reward was not found to improve model fit (<span class="math inline">\(F(1, 13^*) = 0.63, p = .441\)</span>).</p>
<p><span class="math inline">\(\textrm{ }^*\)</span>: denominator degrees of freedom approximated using Kenward-Rogers method.</p>
</div>
<p>Alternatively, we can perform the tests on the fixed effects themselves. This is more like what you will remember from DAPR2, where we get a table of effects and we can interpret each one in turn. For now we’ll just focus on the interaction term as that is the main one of interest.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">*</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> stakes<span class="sc">|</span> sub), <span class="at">data =</span> bballrep,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_full)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: hrv ~ stakes * condition + (1 + stakes | sub)
   Data: bballrep
Control: lmerControl(optimizer = "bobyqa")

REML criterion at convergence: 867

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6415 -0.6182 -0.0401  0.6038  2.7335 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 sub      (Intercept) 2.86473  1.6926        
          stakes      0.01661  0.1289   -0.85
 Residual             0.87768  0.9368        
Number of obs: 288, groups:  sub, 15

Fixed effects:
                      Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)            4.76028    0.61973 13.08438   7.681 3.34e-06 ***
stakes                 0.03215    0.04749 13.09616   0.677    0.510    
conditionmoney        -0.24945    0.90583 13.00709  -0.275    0.787    
stakes:conditionmoney -0.05519    0.06944 13.04372  -0.795    0.441    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) stakes cndtnm
stakes      -0.851              
conditinmny -0.684  0.582       
stks:cndtnm  0.582 -0.684 -0.850</code></pre>
</div>
</div>
<div class="int">
<p>There was no significant interaction between size and type of reward (<span class="math inline">\(\beta = -0.06, SE = 0.07, t(13.04^*) = -0.8, p = .441\)</span>).</p>
<p><span class="math inline">\(\textrm{ }^*\)</span>: denominator degrees of freedom approximated using Satterthwaite method.</p>
</div>
<p><strong>parametric bootstrapping</strong></p>
<p>We could instead perform the parametric bootstrap for the likelihood ratio test instead. This requires us to remove any incomplete cases from the dataset first, and then re-fit the models.</p>
<div class="cell" data-layout-align="center">

</div>
<p>This will <em>also</em> (just like the standard LRT) refit the models for us with ML rather than REML (it just won’t tell us that it’s doing so!)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pbkrtest)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bballrep2 <span class="ot">=</span> <span class="fu">na.omit</span>(bballrep)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>mod_res <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">+</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> stakes <span class="sc">|</span> sub), <span class="at">data =</span> bballrep2,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>mod_full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(hrv <span class="sc">~</span> stakes <span class="sc">*</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> stakes <span class="sc">|</span> sub), <span class="at">data =</span> bballrep2,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer=</span><span class="st">"bobyqa"</span>))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">PBmodcomp</span>(mod_full, mod_res)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap test; time: 129.97 sec; samples: 1000; extremes: 468;
large : hrv ~ stakes * condition + (1 + stakes | sub)
hrv ~ stakes + condition + (1 + stakes | sub)
         stat df p.value
LRT    0.6122  1  0.4340
PBtest 0.6122     0.4685</code></pre>
</div>
</div>
<div class="int">
<p>Inclusion of the interaction between size and type of reward was not found to improve model fit, as indicated by a parametric bootstrapped (<span class="math inline">\(k=1000\)</span>) likelihood ratio test (<span class="math inline">\(\Delta 2loglik = 0.612, p = .469\)</span>).</p>
</div>
<p>Lastly, we could also opt to construct parametric bootstrapped confidence intervals around our fixed effect estimates:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod_full, <span class="at">method=</span><span class="st">"boot"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            2.5 %      97.5 %
.sig01                 1.01777802  2.41524811
.sig02                -0.96252286 -0.61207542
.sig03                 0.07907304  0.18089815
.sigma                 0.86358573  1.02589783
(Intercept)            3.50865914  6.14629755
stakes                -0.06090850  0.12560977
conditionmoney        -2.07035051  1.50523773
stakes:conditionmoney -0.19634219  0.06820011</code></pre>
</div>
</div>
<div class="int">
<p>There was no significant interaction between size and type of reward (<span class="math inline">\(\beta = -0.06, \text{ parametric bootstrapped 95\% CI: } [-0.196, 0.068]\)</span>).</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;">

</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>