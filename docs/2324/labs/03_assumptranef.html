<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DAPR3 - Assumptions, Diagnostics, and Random Effect Structures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-circle-right')) {
    f.classList.add('fa-circle-down')
    f.classList.remove('fa-circle-right')
} else {
    f.classList.add('fa-circle-right')
    f.classList.remove('fa-circle-down')
}
}
</script>

<script src="https://kit.fontawesome.com/120b08a6f5.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_regressionrefresh.html">Multilevel Models</a></li><li class="breadcrumb-item"><a href="./03_assumptranef.html">Assumptions, Diagnostics, and Random Effect Structures</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DAPR3</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Multilevel Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_regressionrefresh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Refresh and Clustered Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_intromlm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multilevel Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_assumptranef.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assumptions, Diagnostics, and Random Effect Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_centerglmer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Centering in MLM | Logistic MLM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_recap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recap of multilevel models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Path Analysis and Data Reduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_path1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Path Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">08_path2.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">09_pca.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">10_efa.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">11_efa2.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Additional Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
 <span class="menu-text">example_01_repeated_measures.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">example_02_intervention.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">example_03_many_trials.qmd</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example_00_anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis Example: Rpt &amp; Mixed ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">example2_01_EFA.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">lvp.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">explainer_3leveleq.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">explainer_pcavar.qmd</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exercises-assumptions-diagnostics" id="toc-exercises-assumptions-diagnostics" class="nav-link active" data-scroll-target="#exercises-assumptions-diagnostics">Exercises: Assumptions &amp; Diagnostics</a></li>
  <li><a href="#random-effect-structures" id="toc-random-effect-structures" class="nav-link" data-scroll-target="#random-effect-structures">Random Effect Structures</a></li>
  <li><a href="#exercises-crossed-ranefs" id="toc-exercises-crossed-ranefs" class="nav-link" data-scroll-target="#exercises-crossed-ranefs">Exercises: Crossed Ranefs</a></li>
  <li><a href="#exercises-nested-random-effects" id="toc-exercises-nested-random-effects" class="nav-link" data-scroll-target="#exercises-nested-random-effects">Exercises: Nested Random Effects</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assumptions, Diagnostics, and Random Effect Structures</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="exercises-assumptions-diagnostics" class="level1">
<h1>Exercises: Assumptions &amp; Diagnostics</h1>
<div class="frame">
<p><strong>Data: Wellbeing Across Scotland</strong></p>
<p>For these next set of exercises we continue with our recurring study in which researchers want to look at the relationship between time spent outdoors and mental wellbeing, across all of Scotland. Data is collected from 20 of the Local Authority Areas and is accessible at <a href="https://uoepsy.github.io/data/LAAwellbeing.csv">https://uoepsy.github.io/data/LAAwellbeing.csv</a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<div id="aetwnrwyvf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#aetwnrwyvf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#aetwnrwyvf thead, #aetwnrwyvf tbody, #aetwnrwyvf tfoot, #aetwnrwyvf tr, #aetwnrwyvf td, #aetwnrwyvf th {
  border-style: none;
}

#aetwnrwyvf p {
  margin: 0;
  padding: 0;
}

#aetwnrwyvf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aetwnrwyvf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#aetwnrwyvf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#aetwnrwyvf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#aetwnrwyvf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aetwnrwyvf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aetwnrwyvf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aetwnrwyvf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aetwnrwyvf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aetwnrwyvf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aetwnrwyvf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aetwnrwyvf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aetwnrwyvf .gt_spanner_row {
  border-bottom-style: hidden;
}

#aetwnrwyvf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#aetwnrwyvf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aetwnrwyvf .gt_from_md > :first-child {
  margin-top: 0;
}

#aetwnrwyvf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aetwnrwyvf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aetwnrwyvf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#aetwnrwyvf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#aetwnrwyvf .gt_row_group_first td {
  border-top-width: 2px;
}

#aetwnrwyvf .gt_row_group_first th {
  border-top-width: 2px;
}

#aetwnrwyvf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aetwnrwyvf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#aetwnrwyvf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#aetwnrwyvf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aetwnrwyvf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aetwnrwyvf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aetwnrwyvf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#aetwnrwyvf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aetwnrwyvf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aetwnrwyvf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aetwnrwyvf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aetwnrwyvf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aetwnrwyvf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aetwnrwyvf .gt_left {
  text-align: left;
}

#aetwnrwyvf .gt_center {
  text-align: center;
}

#aetwnrwyvf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aetwnrwyvf .gt_font_normal {
  font-weight: normal;
}

#aetwnrwyvf .gt_font_bold {
  font-weight: bold;
}

#aetwnrwyvf .gt_font_italic {
  font-style: italic;
}

#aetwnrwyvf .gt_super {
  font-size: 65%;
}

#aetwnrwyvf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#aetwnrwyvf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#aetwnrwyvf .gt_indent_1 {
  text-indent: 5px;
}

#aetwnrwyvf .gt_indent_2 {
  text-indent: 10px;
}

#aetwnrwyvf .gt_indent_3 {
  text-indent: 15px;
}

#aetwnrwyvf .gt_indent_4 {
  text-indent: 20px;
}

#aetwnrwyvf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="variable">variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="description">description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="variable" class="gt_row gt_left">ppt</td>
<td headers="description" class="gt_row gt_left">Participant ID</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">name</td>
<td headers="description" class="gt_row gt_left">Participant Name</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">laa</td>
<td headers="description" class="gt_row gt_left">Local Authority Area</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">outdoor_time</td>
<td headers="description" class="gt_row gt_left">Self report estimated number of hours per week spent outdoors</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">wellbeing</td>
<td headers="description" class="gt_row gt_left">Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.</td></tr>
    <tr><td headers="variable" class="gt_row gt_left">density</td>
<td headers="description" class="gt_row gt_left">LAA Population Density (people per square km)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<div class="question-begin">
Question 1
</div>
<div class="question-body">
<p>The code below will read in the data and fit the model with by-LAA random intercepts and slopes of outdoor time.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>scotmw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/LAAwellbeing.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>rs_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">|</span> laa), <span class="at">data =</span> scotmw)</span></code></pre></div>
</div>
<ol type="1">
<li>Plot the residuals vs fitted model, and assess the extend to which the assumption holds that the residuals are zero mean.</li>
<li>Construct a scale-location plot. This is where the square-root of the absolute value of the standardised residuals is plotted against the fitted values, and allows you to more easily assess the assumption of constant variance.</li>
</ol>
<ul>
<li>Optional: can you create the same plot using ggplot, starting with the <code>augment()</code> function from the <strong>broom.mixed</strong> package?</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>plot(model)</code> will give you this plot, but you might want to play with the <code>type = c(......)</code> argument to get the smoothing line</p>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-1" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-1', 'sol-start-1')">
Solution
</button>
</div>
<div id="sol-body-1" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rs_model, <span class="at">type=</span><span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, the mean value of the residuals is quite close to zero, right the way across the fitted values. This is good.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rs_model,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">form =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">resid</span>(.))) <span class="sc">~</span> <span class="fu">fitted</span>(.),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>In this plot we can see that the variance of the residuals is fairly constant across the fitted values. There is a slight dip at the lower end. We can see this in the previous plot too - all the points at the LHS of the plot are slightly more tightly grouped around the line. This is not enough to worry me, personally.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(rs_model) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrtr =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(.resid))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>sqrtr)) <span class="sc">+</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 2
</div>
<div class="question-body">
<p>Examine the normality of both the level 1 and level 2 residuals.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Use <code>hist()</code> if you like, or <code>qqnorm(residuals)</code> followed by <code>qqline(residuals)</code></li>
<li>Extracting the level 2 residuals (the random effects) can be difficult. <code>ranef(model)</code> will get you some of the way.</li>
</ul>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-2" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-2', 'sol-start-2')">
Solution
</button>
</div>
<div id="sol-body-2" class="solution-body" style="display: none;">
<p><strong>Level 1</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(rs_model))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(rs_model))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">resid</span>(rs_model))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Level 2</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(rs_model)<span class="sc">$</span>laa[, <span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Random intercept"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">ranef</span>(rs_model)<span class="sc">$</span>laa[, <span class="dv">1</span>])</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(rs_model)<span class="sc">$</span>laa[, <span class="dv">2</span>], <span class="at">main =</span> <span class="st">"Random slope"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">ranef</span>(rs_model)<span class="sc">$</span>laa[, <span class="dv">2</span>])</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>The normality of the residuals at both levels looks pretty decent here. This is especially good given that we only actually have 20 clusters (the LAAs). We have quite a small sample at this level.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 3
</div>
<div class="question-body">
<ol type="1">
<li>Which person in the dataset has the greatest influence on our model?<br>
</li>
<li>For which person is the model fit the worst (i.e., who has the highest residual?)</li>
<li>Which <em>LAA</em> has the greatest influence on our model?</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>as well as <code>hlm_influence()</code> in the <strong>HLMdiag</strong> package there is another nice function, <code>hlm_augment()</code></li>
<li>we can often end up in confusion because the <span class="math inline">\(i^{th}\)</span> observation inputted to our model (and therefore the <span class="math inline">\(i^{th}\)</span> observation of <code>hlm_influence()</code> output) <strong>might not be</strong> the <span class="math inline">\(i^{th}\)</span> observation in our original dataset - there may be missing data! (Luckily, we have no missing data in this dataset).</li>
</ul>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-3" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-3', 'sol-start-3')">
Solution
</button>
</div>
<div id="sol-body-3" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HLMdiag)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>l1_inf <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(rs_model,<span class="at">level=</span><span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(l1_inf<span class="sc">$</span>cooksd, <span class="at">cutoff=</span><span class="st">"internal"</span>)<span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">15</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Greatest influence:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hlm_augment</span>(rs_model, <span class="at">level=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(cooksd))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132 × 15
      id wellbeing outdoor_time laa          .resid .fitted .ls.resid .ls.fitted
   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1    74        35           33 Scottish Bo…  -5.15    40.2    -3.73        38.7
 2   129        60            5 City of Edi…   8.89    51.1     6.43        53.6
 3   109        31            8 Inverclyde    -9.22    40.2    -3.03        34.0
 4    59        32            7 Scottish Bo…  -6.43    38.4    -7.45        39.5
 5    31        35            7 Moray         -3.44    38.4     0.198       34.8
 6    90        70           34 Na h-Eilean…  -3.16    73.2    -1.19        71.2
 7    87        54           29 Highland      -5.33    59.3    -5.66        59.7
 8    62        26           21 Midlothian    -4.77    30.8     0.214       25.8
 9    67        37            7 East Ayrshi…   4.58    32.4     4.62        32.4
10    64        46           18 City of Edi… -10.5     56.5   -10.1         56.1
# ℹ 122 more rows
# ℹ 7 more variables: .mar.resid &lt;dbl&gt;, .mar.fitted &lt;dbl&gt;, cooksd &lt;dbl&gt;,
#   mdffits &lt;dbl&gt;, covtrace &lt;dbl&gt;, covratio &lt;dbl&gt;, leverage.overall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>scotmw[<span class="dv">74</span>, ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  ppt   name                 laa              outdoor_time wellbeing density
  &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 ID46  Groundskeeper Willie Scottish Borders           33        35      29</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/intro/willie.jpg" class="img-fluid figure-img" width="100"></p>
</figure>
</div>
</div>
</div>
<p>Highest residual:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hlm_augment</span>(rs_model, <span class="at">level=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(.resid)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132 × 15
      id wellbeing outdoor_time laa          .resid .fitted .ls.resid .ls.fitted
   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1    64        46           18 City of Edi… -10.5     56.5    -10.1        56.1
 2   107        22           12 East Ayrshi… -10.3     32.3    -10.1        32.1
 3    72        22           24 West Lothian -10.0     32.0     -9.24       31.2
 4   109        31            8 Inverclyde    -9.22    40.2     -3.03       34.0
 5   130        22           16 West Dunbar…  -8.98    31.0     -8.61       30.6
 6   129        60            5 City of Edi…   8.89    51.1      6.43       53.6
 7    93        65           18 City of Edi…   8.51    56.5      8.90       56.1
 8    85        47           15 City of Edi…  -8.25    55.2     -8.52       55.5
 9     7        38           13 Perth and K…  -7.84    45.8     -5.28       43.3
10   121        31           16 Dumfries an…  -7.78    38.8     -7.70       38.7
# ℹ 122 more rows
# ℹ 7 more variables: .mar.resid &lt;dbl&gt;, .mar.fitted &lt;dbl&gt;, cooksd &lt;dbl&gt;,
#   mdffits &lt;dbl&gt;, covtrace &lt;dbl&gt;, covratio &lt;dbl&gt;, leverage.overall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>scotmw[<span class="dv">64</span>, ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  ppt   name            laa               outdoor_time wellbeing density
  &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 ID37  Nicola Sturgeon City of Edinburgh           18        46    1958</code></pre>
</div>
</div>
<p>Most influential LAA:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hlm_augment</span>(rs_model, <span class="at">level=</span><span class="st">"laa"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(cooksd))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 10
   laa       .ranef.intercept .ranef.outdoor_time .ls.intercept .ls.outdoor_time
   &lt;chr&gt;                &lt;dbl&gt;               &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;
 1 Midlothi…           -1.76             -0.486           8.75           -1.26  
 2 Na h-Eil…           14.1               0.399          21.4             0.0553
 3 Glasgow …          -10.9              -0.464          -9.45           -0.593 
 4 City of …           10.8               0.199          16.2            -0.144 
 5 Stirling             6.51             -0.0758         13.3            -0.500 
 6 Shetland…            4.73              0.389           3.69            0.424 
 7 Angus               -4.86              0.0959         -6.82            0.265 
 8 West Lot…           -3.13             -0.344           4.13           -0.725 
 9 Falkirk             -7.45             -0.157         -12.3            -0.0360
10 Invercly…           -1.30              0.197         -14.5             1.17  
11 Highland             6.73              0.281           8.95            0.155 
12 West Dun…           -6.41             -0.267          -4.87           -0.395 
13 Moray               -2.22              0.133          -5.81            0.267 
14 Perth an…            1.49              0.257         -20.4             1.76  
15 East Ayr…           -5.67             -0.233          -3.63           -0.391 
16 Orkney I…            0.179             0.155          -0.816           0.212 
17 Scottish…           -0.264            -0.148           3.28           -0.367 
18 Dumfries…           -2.69             -0.0120         -7.27            0.261 
19 Argyll a…            1.65             -0.00518         4.67           -0.187 
20 East Ren…            0.502             0.0849          1.40            0.0247
# ℹ 5 more variables: cooksd &lt;dbl&gt;, mdffits &lt;dbl&gt;, covtrace &lt;dbl&gt;,
#   covratio &lt;dbl&gt;, leverage.overall &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 4
</div>
<div class="question-body">
<ol type="1">
<li>Looking at the random effects, which LAA shows the least improvement in wellbeing as outdoor time increases, and which shows the greatest improvement?<br>
</li>
<li>What is the estimated wellbeing for people from City of Edinburgh with zero hours of outdoor time per week, and what is their associated increases in wellbeing for every hour per week increase in outdoor time?</li>
</ol>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-4" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-4', 'sol-start-4')">
Solution
</button>
</div>
<div id="sol-body-4" class="solution-body" style="display: none;">
<p>It looks like the residents of Midlothian have the least improvement, and the Western Isles (Na h-Eileanan Siar) show the most increases of wellbeing with outdoor time. We can see this from the LAA-random slopes of outdoor time:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(rs_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$laa
                      (Intercept) outdoor_time
Angus                  -4.8568066  0.095850303
Argyll and Bute         1.6488121 -0.005181049
City of Edinburgh      10.8163125  0.199034174
Dumfries and Galloway  -2.6893688 -0.012005965
East Ayrshire          -5.6749200 -0.232750990
East Renfrewshire       0.5024800  0.084907037
Falkirk                -7.4525578 -0.156694328
Glasgow City          -10.9101439 -0.464232183
Highland                6.7315989  0.280992008
Inverclyde             -1.2966048  0.197142062
Midlothian             -1.7585791 -0.485961786
Moray                  -2.2165380  0.133392034
Na h-Eileanan Siar     14.0595006  0.399493656
Orkney Islands          0.1789928  0.154590585
Perth and Kinross       1.4894924  0.256689754
Scottish Borders       -0.2638474 -0.148174460
Shetland Islands        4.7262680  0.388873631
Stirling                6.5060959 -0.075781592
West Dunbartonshire    -6.4127140 -0.266515096
West Lothian           -3.1274727 -0.343667797

with conditional variances for "laa" </code></pre>
</div>
</div>
<p>We can get the cluster-specific coefficients either by adding the <code>fixef()</code> and <code>ranef()</code> together, or using <code>coef()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(rs_model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$laa
                      (Intercept) outdoor_time
Angus                    33.36700   0.31050188
Argyll and Bute          39.87261   0.20947052
City of Edinburgh        49.04011   0.41368575
Dumfries and Galloway    35.53443   0.20264561
East Ayrshire            32.54888  -0.01809942
East Renfrewshire        38.72628   0.29955861
Falkirk                  30.77124   0.05795725
Glasgow City             27.31366  -0.24958061
Highland                 44.95540   0.49564358
Inverclyde               36.92720   0.41179364
Midlothian               36.46522  -0.27131021
Moray                    36.00726   0.34804361
Na h-Eileanan Siar       52.28330   0.61414523
Orkney Islands           38.40280   0.36924216
Perth and Kinross        39.71329   0.47134133
Scottish Borders         37.95995   0.06647711
Shetland Islands         42.95007   0.60352520
Stirling                 44.72990   0.13886998
West Dunbartonshire      31.81109  -0.05186352
West Lothian             35.09633  -0.12901622

attr(,"class")
[1] "coef.mer"</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(rs_model)<span class="sc">$</span>laa[<span class="st">"City of Edinburgh"</span>,]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  (Intercept) outdoor_time
City of Edinburgh    49.04011    0.4136857</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<p><br></p>
</section>
<section id="random-effect-structures" class="level1">
<h1>Random Effect Structures</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nested and Crossed structures
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The same principle we have seen for one level of clustering can be extended to clustering at different levels (for instance, observations are clustered within subjects, which are in turn clustered within groups).</p>
<p>Consider the example where we have observations for each student in every class within a number of schools:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/structure_id.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p><strong>Question:</strong> Is “Class 1” in “School 1” the same as “Class 1” in “School 2”?</p>
<p>No.<br>
The classes in one school are distinct from the classes in another <strong>even though they are named the same</strong>.</p>
<p>The classes-within-schools example is a good case of <strong>nested random effects</strong> - one factor level (one group in a grouping varible) appears <em>only within</em> a particular level of another grouping variable.</p>
<p>In R, we can specify this using:</p>
<p><code>(1 | school) + (1 | class:school)</code></p>
<p>or, more succinctly:</p>
<p><code>(1 | school/class)</code></p>
<p>Consider another example, where we administer the same set of tasks at multiple time-points for every participant.</p>
<p><strong>Question:</strong> Are tasks nested within participants?</p>
<p>No.<br>
Tasks are seen by multiple participants (and participants see multiple tasks).</p>
<p>We could visualise this as the below:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/structure_crossed.png" class="img-fluid figure-img" width="400"></p>
</figure>
</div>
</div>
</div>
<p>In the sense that these are not nested, they are <strong>crossed</strong> random effects.</p>
<p>In R, we can specify this using:</p>
<p><code>(1 | subject) + (1 | task)</code></p>
<div class="blue">
<p><strong>Nested vs Crossed</strong></p>
<p><em>Nested:</em> Each group belongs uniquely to a higher-level group.</p>
<p><em>Crossed:</em> Not-nested.</p>
</div>
<p>Note that in the schools and classes example, had we changed data such that the classes had unique IDs (e.g., see below), then the structures <code>(1 | school) + (1 | class)</code> and <code>(1 | school/class)</code> would give the same results.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/structure_nested.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Random Effects in lme4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below are a selection of different formulas for specifying different random effect structures, taken from the <a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf">lme4 vignette</a>. This might look like a lot, but over time and repeated use of multilevel models you will get used to reading these in a similar way to getting used to reading the formula structure of <code>y ~ x1 + x2</code> in all our linear models. <br></p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 41%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Formula</th>
<th style="text-align: right;">Alternative</th>
<th style="text-align: right;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(\text{(1 | g)}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(\text{1 + (1 | g)}\)</span></td>
<td style="text-align: right;">Random intercept with fixed mean</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(\text{(1 | g1/g2)}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(\text{(1 | g1) + (1 | g1:g2)}\)</span></td>
<td style="text-align: right;">Intercept varying among <span class="math inline">\(g1\)</span> and <span class="math inline">\(g2\)</span> within <span class="math inline">\(g1\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(\text{(1 | g1) + (1 | g2)}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(\text{1 + (1 | g1) + (1 | g2)}\)</span></td>
<td style="text-align: right;">Intercept varying among <span class="math inline">\(g1\)</span> and <span class="math inline">\(g2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(\text{x + (x | g)}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(\text{1 + x + (1 + x | g)}\)</span></td>
<td style="text-align: right;">Correlated random intercept and slope</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(\text{x + (x || g)}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(\text{1 + x + (x | g) + (0 + x | g)}\)</span></td>
<td style="text-align: right;">Uncorrelated random intercept and slope</td>
</tr>
</tbody>
</table>
<p><strong>Table 1:</strong> Examples of the right-hand-sides of mixed effects model formulas. <span class="math inline">\(g\)</span>, <span class="math inline">\(g1\)</span>, <span class="math inline">\(g2\)</span> are grouping factors, <span class="math inline">\(x\)</span> is a predictor variable.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Building
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Random effect structures can get pretty complicated quite quickly. Very often it is not the random effects part that is of specific interest to us, but we wish to estimate random effects in order to more accurately partition up the variance in our outcome variable and provide better estimates of fixed effects.</p>
<p>It is a fine balance between fitting the most sophisticated model structure that we possibly can, and fitting a model that converges without too much simplification. Typically for many research designs, the following steps will keep you mostly on track to finding the maximal model:</p>
<p><code>lmer(outcome ~ fixed effects + (random effects | grouping structure))</code></p>
<ol type="1">
<li><p>Specify the <code>outcome ~ fixed effects</code> bit first.</p>
<ul>
<li>The outcome variable should be clear: it is the variable we are wishing to explain/predict.</li>
<li>The fixed effects are the things we want to use to explain/predict variation in the outcome variable. These will often be the things that are of specific inferential interest, and other covariates. Just like the simple linear model.</li>
</ul></li>
<li><p>If there is a grouping structure to your data, and those groups (preferably n&gt;7 or 8) are perceived as a random sample of a wider population (the specific groups aren’t interesting to you), then consider including random intercepts (and possibly random slopes of predictors) for those groups <code>(1 | grouping)</code>.</p></li>
<li><p>If there are multiple different grouping structures, is one nested within another? (If so, we can specify this as <code>(1 | high_level_grouping / low_level_grouping)</code>. If the grouping structures are not nested, we specify them as crossed: <code>(1 | grouping1) + (1 | grouping2)</code>.</p></li>
<li><p>If any of the things in the fixed effects vary within the groups, it might be possible to also include them as random effects.</p>
<ul>
<li>as a general rule, don’t specify random effects that are not also specified as fixed effects (an exception could be specifically for model comparison, to isolate the contribution of the fixed effect).<br>
</li>
<li>For things that do not vary within the groups, it rarely makes sense to include them as random effects. For instance if we had a model with <code>lmer(score ~ genetic_status + (1 + genetic_status | patient))</code> then we would be trying to model a process where “the effect of genetic_status on scores is different for each patient”. But if you consider an individual patient, their genetic status never changes. For patient <span class="math inline">\(i\)</span>, what is “the effect of genetic status on score”? It’s undefined. This is because genetic status only varies <em>between</em> patients.</li>
<li>Sometimes, things will vary within one grouping, but not within another. E.g. with patients nested within hospitals <code>(1 | hospital/patient)</code>, genetic_status varies <em>between</em> patients, but <em>within</em> hospitals. Therefore we could theoretically fit a random effect of <code>genetic_status | hospital</code>, but <strong>not</strong> one for <code>genetic_status | patient</code>.<br>
We can include these while preserving the nested structure of the data by separating out the groupings: <code>(1 + genetic_status | hospital) + (1 | patient:hospital)</code>.</li>
</ul></li>
<li><p>A common approach to fitting multilevel models is to fit the most complex model <em>that the study design allows</em>. This means including random effects for everything that makes <em>theoretical</em> sense to be included. Because this “maximal model” will often not converge, we then simplify our random effect structure to obtain a convergent model.<br>
Candidate random effect terms for removal are:</p></li>
</ol>
<ul>
<li>overly complex terms (e.g.&nbsp;<code>(1 + x1 * x2 | group)</code> could be simplified to <code>(1 + x1 + x2 | group)</code>).<br>
</li>
<li>those with little variance</li>
<li>those with near perfect correlation (we can alternatively remove just the correlation)</li>
</ul>
<ol start="6" type="1">
<li>Obtain final model, and proceed to checking assumptions, checking influence, plotting, and eventually writing up.</li>
</ol>
<!-- 

<div class="optional-begin"><button id='opt-start-5' class="fa-solid fa-circle-right optional-icon clickable" onclick="toggle_visibility('opt-body-5', 'opt-start-5')"> An example </button></div><div class="optional-body" id = "opt-body-5" style="display: none;">

 -->
<!-- Suppose we were also interested in the association between population density and wellbeing. Our data contains information on the population density for each LAA. Note that for all people in our data that are from the same LAA, they will have the same value in the `density` variable, because this is measured at the LAA level, not the person-level:   -->
<!-- ```{r} -->
<!-- scotmw %>%  -->
<!--   select(laa, density) -->
<!-- ``` -->
<!-- It doesn't really make sense to have random effects of density by LAA (the `density | laa` bit), because the association `wellbeing ~ density` is the same for _every_ person in that LAA. To say that "each LAA has a different effect of population density on wellbeing" is tricky, because we "effect of density on wellbeing" isn't really defined for an individual LAA.  -->
<!-- ```{r} -->
<!-- #| error: true -->
<!-- #| message: true -->
<!-- model_dens <- lmer(wellbeing ~ 1 + outdoor_time + density + -->
<!--                    (1 + outdoor_time + density | laa), data = scotmw) -->
<!-- ``` -->
<!-- The resulting model gives a singular fit, and we can see how this impacts the model estimates in the random effects. The random effect of `density | laa` is much smaller (explaining less variance), and is very highly correlated to the random intercept `1 | laa`, because it doesn't really contain a great deal more information (if you think about the `laa` and `density` columns of the dataset, there is a one-to-one mapping between them). Including the `density | laa` random effect here is not supported by the data.   -->
<!-- ```{r} -->
<!-- VarCorr(model_dens) -->
<!-- ``` -->
<!-- 

</div><p class="optional-end"></p>

 -->
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Singular fits
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You may have noticed that some of our models over the last few weeks have been giving a warning: <code>boundary (singular) fit: see ?isSingular</code>.<br>
Up to now, we’ve been largely ignoring these warnings. However, this week we’re going to look at how to deal with this issue.</p>
<p style="color:red">
boundary (singular) fit: see ?isSingular
</p>
<p>The warning is telling us that our model has resulted in a ‘singular fit’. Singular fits often indicate that the model is ‘overfitted’ - that is, the random effects structure which we have specified is too complex to be supported by the data.</p>
<p>Perhaps the most intuitive advice would be remove the most complex part of the random effects structure (i.e.&nbsp;random slopes). This leads to a simpler model that is not over-fitted. In other words, start simplifying from the top (where the most complexity is) to the bottom (where the lowest complexity is). Additionally, when variance estimates are very low for a specific random effect term, this indicates that the model is not estimating this parameter to differ much between the levels of your grouping variable. It might, in some experimental designs, be perfectly acceptable to remove this or simply include it as a fixed effect.</p>
<p>A key point here is that when fitting a mixed model, we should think about how the data are generated. Asking yourself questions such as “do we have good reason to assume subjects might vary over time, or to assume that they will have different starting points (i.e., different intercepts)?” can help you in specifying your random effect structure</p>
<p>You can read in depth about what this means by reading the help documentation for <code>?isSingular</code>. For our purposes, a relevant section is copied below:</p>
<p><em>… intercept-only models, or 2-dimensional random effects such as intercept + slope models, singularity is relatively easy to detect because it leads to random-effect variance estimates of (nearly) zero, or estimates of correlations that are (almost) exactly -1 or 1.</em></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Convergence warnings
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Issues of non-convergence can be caused by many things. If you’re model doesn’t converge, it does <em>not necessarily</em> mean the fit is incorrect, however it is <strong>is cause for concern</strong>, and should be addressed, else you may end up reporting inferences which do not hold.</p>
<p>There are lots of different things which you could do which <em>might</em> help your model to converge. A select few are detailed below:</p>
<ul>
<li><p>double-check the model specification and the data</p></li>
<li><p>adjust stopping (convergence) tolerances for the nonlinear optimizer, using the optCtrl argument to [g]lmerControl. (see <code>?convergence</code> for convergence controls).</p>
<ul>
<li>What is “tolerance”? Remember that our optimizer is the the method by which the computer finds the best fitting model, by iteratively assessing and trying to maximise the likelihood (or minimise the loss).</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-tolerance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/tolerance.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: An optimizer will stop after a certain number of iterations, or when it meets a tolerance threshold</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><p>center and scale continuous predictor variables (e.g.&nbsp;with <code>scale</code>)</p></li>
<li><p>Change the optimization method (for example, here we change it to <code>bobyqa</code>): <code>lmer(..., control = lmerControl(optimizer="bobyqa"))</code><br>
<code>glmer(..., control = glmerControl(optimizer="bobyqa"))</code></p></li>
<li><p>Increase the number of optimization steps: <code>lmer(..., control = lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000))</code><br>
<code>glmer(..., control = glmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000))</code></p></li>
<li><p>Use <code>allFit()</code> to try the fit with all available optimizers. This will of course be slow, but is considered ‘the gold standard’; <em>“if all optimizers converge to values that are practically equivalent, then we would consider the convergence warnings to be false positives.”</em></p></li>
<li><p>Consider simplifying your model, for example by removing random effects with the smallest variance (but be careful to not simplify more than necessary, and ensure that your write up details these changes)</p></li>
</ul>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="exercises-crossed-ranefs" class="level1">
<h1>Exercises: Crossed Ranefs</h1>
<div class="frame">
<p><strong>Data: Test-enhanced learning</strong></p>
<p>An experiment was run to conceptually replicate “test-enhanced learning” (Roediger &amp; Karpicke, 2006): two groups of 25 participants were presented with material to learn. One group studied the material twice (<code>StudyStudy</code>), the other group studied the material once then did a test (<code>StudyTest</code>). Recall was tested immediately (one minute) after the learning session and one week later. The recall tests were composed of 175 items identified by a keyword (<code>Test_word</code>).</p>
<p>The researchers are interested in how test-enhanced learning influences time-to-recall. The critical (replication) prediction is that the <code>StudyTest</code> group will retain the material better (lower reaction times) on the 1-week follow-up test compared to the <code>StudyStudy</code> group.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Subject_ID</td>
<td style="text-align: left;">Unique Participant Identifier</td>
</tr>
<tr class="even">
<td style="text-align: left;">Group</td>
<td style="text-align: left;">Group denoting whether the participant studied the material twice (StudyStudy), or studied it once then did a test (StudyTest)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Delay</td>
<td style="text-align: left;">Time of recall test ('min' = Immediate, 'week' = One week later)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Test_word</td>
<td style="text-align: left;">Word being recalled (175 different test words)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rtime</td>
<td style="text-align: left;">Time to respond (milliseconds)</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The following code loads the data into your R environment by creating a variable called <code>tel</code>:</p>
<pre><code>load(url("https://uoepsy.github.io/data/RTtestlearning.RData"))</code></pre>
</div>
<div class="question-begin">
Question 5
</div>
<div class="question-body">
<p>Load and plot the data.</p>
<p>For this week, we’ll use Reaction Time as our proxy for the test performance, so you’ll probably want that variable on the y-axis.</p>
<p>Does it look like the effect was replicated?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Our outcome variable is reaction time, so we’ll want to plot that on the y axis.<br>
Then we want to show the reaction times for each group, at each test (<code>min</code> or <code>week</code> delay).<br>
Do we want to show <em>all</em> the datapoints, or maybe just the average for each group at each test (in which case, does <code>stat_summary()</code> help?).</p>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-6" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-6', 'sol-start-6')">
Solution
</button>
</div>
<div id="sol-body-6" class="solution-body" style="display: none;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://uoepsy.github.io/data/RTtestlearning.RData"</span>))</span></code></pre></div>
</div>
<p>You can make use of <code>stat_summary()</code>!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(telrt, <span class="fu">aes</span>(Delay, Rtime, <span class="at">col=</span>Group)) <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data=</span>mean_se, <span class="at">geom=</span><span class="st">"pointrange"</span>)<span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
</div>
<p>It’s more work, but some people might rather calculate the numbers and then plot them directly. It does just the same thing:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>telrt <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Delay, Group) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(Rtime),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">sd</span>(Rtime)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>())</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span>Delay, <span class="at">col =</span> Group)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean, <span class="at">ymin=</span>mean<span class="sc">-</span>se, <span class="at">ymax=</span>mean<span class="sc">+</span>se))<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Response Time (ms)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>That looks like test-enhanced learning to me!</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 6
</div>
<div class="question-body">
<blockquote class="blockquote">
<p>The critical (replication) prediction is that the <code>StudyStudy</code> group should perform somewhat better on the immediate recall test, but the <code>StudyTest</code> group will retain the material better and thus perform better on the 1-week follow-up test.</p>
</blockquote>
<p>Test the critical hypothesis using a multi-level model.<br>
<strong>Try</strong> to fit the maximally complex random effect structure that is supported by the experimental design.</p>
<p><strong>NOTE: Your model probably won’t converge. We’ll deal with that in the next question</strong></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>We can expect variability across subjects (some people are better at learning than others) <strong>and</strong> across items (some of the recall items are harder than others). How should this be represented in the random effects?</li>
<li><em>If a model takes ages to fit, you might want to cancel it by pressing the escape key. It is normal for complex models to take time, but for the purposes of this task, give up after a couple of minutes, and try simplifying your model.</em></li>
</ul>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-7" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-7', 'sol-start-7')">
Solution
</button>
</div>
<div id="sol-body-7" class="solution-body" style="display: none;">
<p>We know that we are interested in the <code>Rtime ~ Delay * Group</code> interaction, because we want to see how people perform at one week vs one minute (the <code>Delay</code> variable) and whether this is different between those in each condition (the <code>Group</code> variable, specifying whether participants are in the ‘StudyStudy’ condition or the ‘StudyTest’ condition).</p>
<p>We want to include Subject random effects <em>and</em> Item random effects, and these groupings are crossed, so we’re going to have <code>(1 + ??? | Subject_ID) + (1 + ??? | Test_word)</code>. Each subject is only in one group, so we can only have <code>(1 + Delay | Subject_ID)</code>, but the Test_word items are seen by subjects in both groups, and at both timepoints, so we can have <code>(1 + Delay * Group | Test_word)</code>.</p>
<p>This one will probably take a little bit of time:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Rtime <span class="sc">~</span> Delay <span class="sc">*</span> Group <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">|</span> Subject_ID) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">*</span> Group <span class="sc">|</span> Test_word),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>telrt, <span class="at">control=</span><span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span></code></pre></div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 7
</div>
<div class="question-body">
<p>Often, models with maximal random effect structures will not converge, or will obtain a singular fit. One suggested approach here is to simplify the model until you achieve convergence (<a href="https://doi.org/10.1016/j.jml.2012.11.001">Barr et al., 2013</a>).</p>
<p>Incrementally simplify your model from the previous question until you obtain a model that converges and is not a singular fit.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>you can look at the variance estimates and correlations easily by using the <code>VarCorr()</code> function. What jumps out?</p>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-8" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-8', 'sol-start-8')">
Solution
</button>
</div>
<div id="sol-body-8" class="solution-body" style="display: none;">
<p>There are very high correlations with the by-item random effects of the interaction Delay:Group. We might expect that because it’s an interaction term, but it is quite a complex bit of the model, so let’s remove it:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(m)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups     Name                     Std.Dev. Corr                
 Test_word  (Intercept)               17.8641                     
            Delayweek                 13.2793 -0.251              
            GroupStudyTest            18.0269 -0.797 -0.385       
            Delayweek:GroupStudyTest  13.1273  0.972 -0.016 -0.917
 Subject_ID (Intercept)               40.5201                     
            Delayweek                  7.4482 -0.038              
 Residual                            240.3113                     </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Rtime <span class="sc">~</span> Delay<span class="sc">*</span>Group <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">|</span> Subject_ID) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">+</span> Group <span class="sc">|</span> Test_word),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>telrt, <span class="at">control=</span><span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(m1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups     Name           Std.Dev. Corr         
 Test_word  (Intercept)      0.0000              
            Delayweek       18.6861    NaN       
            GroupStudyTest   8.3577    NaN -0.778
 Subject_ID (Intercept)     40.5125              
            Delayweek        7.3661 -0.036       
 Residual                  240.5318              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">isSingular</span>(m1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We still have a singular fit here, and we still have quite high<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> correlations between by-testword random effects. Thinking about the study, if we are going to remove <strong>one</strong> of the by-testword random effects (<code>Delay</code> or <code>Group</code>), which one do we consider to be more theoretically justified? Is the effect of Delay likely to vary by test-words? More so than the effect of group is likely to vary by test-words? Quite possibly - there’s no obvious reason for <em>certain</em> words to be more memorable for people in one group vs another. But there is reason for words to vary in the effect that delay of one week has - how familiar a word is will likely influence the amount to which a week’s delay has on recall.</p>
<p>Let’s remove the by-testword random effect of group.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Rtime <span class="sc">~</span> Delay<span class="sc">*</span>Group <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">|</span> Subject_ID) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span> <span class="sc">+</span> Delay <span class="sc">|</span> Test_word),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>telrt, <span class="at">control=</span><span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">isSingular</span>(m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Groups     Name        Std.Dev. Corr  
 Test_word  (Intercept)  11.6973       
            Delayweek    13.5692 -0.236
 Subject_ID (Intercept)  40.5155       
            Delayweek     7.4004 -0.037
 Residual               240.4432       </code></pre>
</div>
</div>
<p>Hooray, the model converged!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: Rtime ~ Delay * Group + (1 + Delay | Subject_ID) + (1 + Delay |  
    Test_word)
   Data: telrt
Control: lmerControl(optimizer = "bobyqa")

REML criterion at convergence: 241671.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.8200 -0.6685 -0.0096  0.6760  4.0783 

Random effects:
 Groups     Name        Variance Std.Dev. Corr 
 Test_word  (Intercept)   136.83  11.70        
            Delayweek     184.12  13.57   -0.24
 Subject_ID (Intercept)  1641.51  40.52        
            Delayweek      54.77   7.40   -0.04
 Residual               57812.93 240.44        
Number of obs: 17498, groups:  Test_word, 175; Subject_ID, 50

Fixed effects:
                         Estimate Std. Error t value
(Intercept)               744.047      8.925  83.363
Delayweek                  26.766      5.448   4.913
GroupStudyTest            -18.032     12.560  -1.436
Delayweek:GroupStudyTest  -17.647      7.566  -2.332

Correlation of Fixed Effects:
            (Intr) Delywk GrpStT
Delayweek   -0.285              
GropStdyTst -0.704  0.200       
Dlywk:GrpST  0.202 -0.694 -0.288</code></pre>
</div>
</div>
<p>Let’s quickly visualise the interaction. Remember, lower reaction times are better here. It looks like we have replicated the hypothesised effect:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m2, <span class="at">type=</span><span class="st">"int"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<p><br></p>
</section>
<section id="exercises-nested-random-effects" class="level1">
<h1>Exercises: Nested Random Effects</h1>
<div class="frame">
<p><strong>Data: Naming</strong></p>
<p>74 children from 10 schools were administered the full Boston Naming Test (BNT-60) on a yearly basis for 5 years to examine development of word retrieval. Five of the schools taught lessons in a bilingual setting with English as one of the languages, and the remaining five schools taught in monolingual English.</p>
<p>The data is available at <a href="https://uoepsy.github.io/data/bntmono.csv">https://uoepsy.github.io/data/bntmono.csv</a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">variable</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">child_id</td>
<td style="text-align: center;">unique child identifier</td>
</tr>
<tr class="even">
<td style="text-align: center;">school_id</td>
<td style="text-align: center;">unique school identifier</td>
</tr>
<tr class="odd">
<td style="text-align: center;">BNT60</td>
<td style="text-align: center;">score on the Boston Naming Test-60. Scores range from 0 to 60</td>
</tr>
<tr class="even">
<td style="text-align: center;">schoolyear</td>
<td style="text-align: center;">Year of school</td>
</tr>
<tr class="odd">
<td style="text-align: center;">mlhome</td>
<td style="text-align: center;">Mono/Bi-lingual School. 0 = Bilingual, 1 = Monolingual</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="question-begin">
Question 8
</div>
<div class="question-body">
<p>Let’s start by thinking about our clustering - we’d like to know how much of the variance in BNT60 scores is due to the clustering of data within children, who are themselves within schools. One easy way of assessing this is to fit an <em>intercept only</em> model, which has the appropriate random effect structure.</p>
<p>Using the model below, calculate the proportion of variance attributable to the clustering of data within children within schools.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>bnt_null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(BNT60 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">|</span> school_id<span class="sc">/</span>child_id), <span class="at">data =</span> bnt)</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>the random intercept variances are the building blocks here. There are no predictors in this model, so all the variance in the outcome gets attributed to either school-level nesting, child-level nesting, or else is lumped into the residual.</p>
</div>
</div>
</div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-9" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-9', 'sol-start-9')">
Solution
</button>
</div>
<div id="sol-body-9" class="solution-body" style="display: none;">
<p>As we can see from <code>summary(bnt_null)</code>, the random intercept variances are 36.52 for child-level, 28.76 for school-level, and the residual variance is 99.11.</p>
<p>So the nesting of data within children within schools accounts for <span class="math inline">\(\frac{36.52 + 28.76}{36.52 + 28.76 + 99.11} = 0.397\)</span> of the variance in the outcome BNT60.</p>
<p>We can calculate this directly using the model estimates if we want, but sometimes doing it by hand is more straightforward.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">VarCorr</span>(bnt_null)) <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grp, vcov) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_var =</span> vcov <span class="sc">/</span> <span class="fu">sum</span>(vcov),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_var2 =</span> <span class="fu">cumsum</span>(prop_var)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 grp     vcov  prop_var prop_var2
1 child_id:school_id 36.52302 0.2221657 0.2221657
2          school_id 28.76157 0.1749536 0.3971194
3           Residual 99.11079 0.6028806 1.0000000</code></pre>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 9
</div>
<div class="question-body">
<p>Fit a model examining the interaction between the effects of school year and mono/bilingual teaching on word retrieval, with random intercepts only for children and schools.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>make sure your variables are of the right type first - e.g.&nbsp;numeric, factor etc</p>
</div>
</div>
</div>
<p>Examine the fit and consider your model assumptions, and assess what might be done to improve the model in order to make better statistical inferences.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-10" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-10', 'sol-start-10')">
Solution
</button>
</div>
<div id="sol-body-10" class="solution-body" style="display: none;">
<p>This is a quick way to make a set of variables factors:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>bnt <span class="ot">&lt;-</span> bnt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(mlhome, school_id, child_id), factor))</span></code></pre></div>
</div>
<p>And now let’s fit our model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bntm0 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(BNT60 <span class="sc">~</span> schoolyear <span class="sc">*</span> mlhome <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school_id<span class="sc">/</span>child_id), <span class="at">data =</span> bnt)</span></code></pre></div>
</div>
<p>Residuals don’t look zero mean:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bntm0, <span class="at">type=</span><span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>It looks a little like, compared to our model (black lines below) the children’s scores (coloured lines) are more closely clustered together when they start school, and then they are more spread out by the end of the study. The fact that we’re fitting the same slope for each child is restricting us here, so we should try fitting random effects of schoolyear.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(bntm0) <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>schoolyear, <span class="at">col=</span>child_id)) <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> BNT60))<span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">y =</span> BNT60))<span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">col=</span><span class="st">"black"</span>, <span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">col=</span><span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>school_id)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>bntm1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(BNT60 <span class="sc">~</span> schoolyear <span class="sc">*</span> mlhome <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> schoolyear <span class="sc">|</span> school_id<span class="sc">/</span>child_id), <span class="at">data =</span> bnt)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bntm1, <span class="at">type=</span><span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Much better!</p>
<p>Let’s do some quick diagnostic checks for influence:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>inf1 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(bntm1, <span class="at">level=</span><span class="dv">1</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(inf1<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="st">"internal"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>If you check in the help for <code>dotplot_diag()</code>, it tells you that</p>
<ol type="a">
<li>we can add an index for the labels, and</li>
<li>the coordinates (x,y) are flipped. We’re telling R to change the limits of the y axis, but actually it is the x axis. This is just because we want to see the label for that point out to the right.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>infchild <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(bntm1, <span class="at">level=</span><span class="st">"child_id:school_id"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(infchild<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="st">"internal"</span>, <span class="at">index =</span> infchild<span class="sc">$</span><span class="st">`</span><span class="at">child_id:school_id</span><span class="st">`</span>) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">05</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>And then we can examine the effects to the fixed effects and our standard errors when we remove this child:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>del94 <span class="ot">&lt;-</span> <span class="fu">case_delete</span>(bntm1, <span class="at">level=</span><span class="st">"child_id:school_id"</span>, <span class="at">delete =</span> <span class="st">"ID94:SC9"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(del94<span class="sc">$</span>fixef.original, del94<span class="sc">$</span>fixef.delete)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        [,1]       [,2]
(Intercept)         6.265626  6.2627962
schoolyear          6.371168  6.3639335
mlhome1             0.138711 -0.3052998
schoolyear:mlhome1 -2.603763 -2.3701181</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Optional: Case deletion influence on standard errors
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can examine the influence that deleting a case has on the standard errors. The standard errors are the square-root of the diagonal of the model-implied variance-covariance matrix:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>( </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">diag</span>(del94<span class="sc">$</span>vcov.original)),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">diag</span>(del94<span class="sc">$</span>vcov.delete))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        [,1]      [,2]
(Intercept)        1.0413285 0.9557645
schoolyear         0.7719321 0.6717837
mlhome1            1.4683927 1.3525492
schoolyear:mlhome1 1.0875897 0.9498207</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>infschool <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(bntm1, <span class="at">level=</span><span class="st">"school_id"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(infschool<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="st">"internal"</span>, <span class="at">index =</span> infschool<span class="sc">$</span>school_id)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question 10
</div>
<div class="question-body">
<p>Using a method of your choosing, conduct inferences (i.e.&nbsp;obtain p-values or confidence intervals) from your final model and write up the results.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<button id="sol-start-11" class="fa-solid fa-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-11', 'sol-start-11')">
Solution
</button>
</div>
<div class="solution-body" id="sol-body-11" style="display: none;">


<p>We’ll use case-based bootstrapping for a demonstration, but other methods would be appropriate here. We have a large sample of children (74), each with 5 observations. However, we only have 10 schools. A standard likelihood ratio test using <code>anova(model1, model2)</code> might not be preferable here.</p>
<p>This took quite a while to run:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmeresampler)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>bntm1BS <span class="ot">&lt;-</span> <span class="fu">bootstrap</span>(bntm1, <span class="at">.f=</span>fixef, <span class="at">type =</span> <span class="st">"case"</span>, <span class="at">B =</span> <span class="dv">2000</span>, <span class="at">resample =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(bntm1BS, <span class="at">type =</span> <span class="st">"basic"</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  term               estimate lower upper type  level
  &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 (Intercept)           6.27   5.41  7.10 basic  0.95
2 schoolyear            6.37   5.72  7.02 basic  0.95
3 mlhome1               0.139 -1.12  1.40 basic  0.95
4 schoolyear:mlhome1   -2.60  -3.62 -1.70 basic  0.95</code></pre>
</div>
</div>
<div class="int">
<p>Multilevel level linear regression was used to investigate childrens’ development of word retrieval over 5 years of school, and whether development was dependent upon the school teaching classes monolingually or bilingually. Initial evaluation of the intercept-only model indicated that the clustering of multiple observations from children within schools accounted for 39.7% of the variance in scores on the Boston Naming Task (BNT60, range 0 to 60). BNT60 scores were modelled with fixed effects of school year (1-5) and monolingual teaching (monolingual vs bilingual, treatment coded with monolingual as the reference level). Random intercepts and slopes of school year were included for schools and for children nested within schools. The model was fitting with maximum likelihood estimation using the default optimiser from the <strong>lme4</strong> package (Bates et al., 2015).<br>
95% Confidence for fixed effect estimates were constructed by case-based bootstrapping with 2000 bootstraps in which children, (but neither observations within children nor the schools within which children were nested) were resampled. Results indicated that children’s scores on the BNT60 increased over the 5 years in which they were studied, with children from bilingual schools increasing in scores by 6.37 ([5.72 – 7.02]) every school year. There was a significant interaction between mono/bilingual schools and changes over the school year, with children from monolingual schools increasing -2.6 ([-3.62 – -1.7]) less than those from bilingual schools for every additional year of school. Full model results can be found in Table 1.</p>
</div>
<p>Table 1</p>
::: {.cell layout-align=“center”}

<table>
<tbody><tr>

<th class="thead firsttablerow firsttablecol col1">
&nbsp;
</th>

<th colspan="2" class="thead firsttablerow">
BNT 60
</th>
</tr>
<tr>

<td class="depvarhead firsttablerow firsttablecol col1">
Predictors
</td>

<td class="depvarhead firsttablerow col2">
Estimates
</td>

<td class="depvarhead firsttablerow col3">
95% CI<br>bootstrap
</td>
</tr>
<tr>

<td class="tdata firsttablecol col1">
Intercept
</td>
<td class="tdata centeralign modelcolumn1 col2">
6.27
</td>
<td class="tdata centeralign modelcolumn1 col3">
5.43&nbsp;–&nbsp;7.12
</td>
</tr>
<tr>

<td class="tdata firsttablecol col1">
School Year
</td>
<td class="tdata centeralign modelcolumn1 col2">
6.37
</td>
<td class="tdata centeralign modelcolumn1 col3">
4.85&nbsp;–&nbsp;7.89
</td>
</tr>
<tr>

<td class="tdata firsttablecol col1">
MonolingualSchool [1]
</td>
<td class="tdata centeralign modelcolumn1 col2">
0.14
</td>
<td class="tdata centeralign modelcolumn1 col3">
-2.75&nbsp;–&nbsp;3.03
</td>
</tr>
<tr>

<td class="tdata firsttablecol col1">
School<br>Year:MonolingualSchool<br>[1]
</td>
<td class="tdata centeralign modelcolumn1 col2">
-2.60
</td>
<td class="tdata centeralign modelcolumn1 col3">
-4.74&nbsp;–&nbsp;-0.46
</td>
</tr>
<tr>
<td colspan="3" class="randomparts">
Random Effects
</td>
</tr>
<tr>
<td class="tdata leftalign summary">
σ<sup>2</sup>
</td>
<td class="tdata summary summarydata" colspan="2">
8.64
</td>
</tr>
<tr>
<td class="tdata leftalign summary">
τ<sub>00</sub> <sub>child_id:school_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
1.77
</td>
</tr><tr>
<td class="tdata leftalign summary">
τ<sub>00</sub> <sub>school_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
3.83
</td>
</tr><tr>
<td class="tdata leftalign summary">
τ<sub>11</sub> <sub>child_id:school_id.schoolyear</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
6.83
</td>
</tr><tr>
<td class="tdata leftalign summary">
τ<sub>11</sub> <sub>school_id.schoolyear</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
1.89
</td>
</tr><tr>
<td class="tdata leftalign summary">
ρ<sub>01</sub> <sub>child_id:school_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
-0.42
</td>
</tr><tr>
<td class="tdata leftalign summary">
ρ<sub>01</sub> <sub>school_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
-0.39
</td>
</tr><tr>
<td class="tdata leftalign summary">
ICC
</td>
<td class="tdata summary summarydata" colspan="2">
0.91
</td>
</tr><tr>
<td class="tdata leftalign summary">
N <sub>child_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
74
</td>
</tr><tr>
<td class="tdata leftalign summary">
N <sub>school_id</sub>
</td>
<td class="tdata summary summarydata" colspan="2">
10
</td>
</tr><tr>
<td class="tdata leftalign summary firstsumrow">
Observations
</td>
<td class="tdata summary summarydata firstsumrow" colspan="2">
370
</td>
</tr>
<tr>
<td class="tdata leftalign summary">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td class="tdata summary summarydata" colspan="2">
0.420 / 0.947
</td>
</tr>

</tbody></table>
<p>:::</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">effect</span>(<span class="st">"schoolyear:mlhome"</span>,bntm1)) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span>schoolyear,<span class="at">y=</span>fit,<span class="at">col=</span>mlhome))<span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower,<span class="at">ymax=</span>upper))<span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="cn">NULL</span>,<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Bilingual"</span>,<span class="st">"Monolingual"</span>),<span class="at">values=</span><span class="fu">c</span>(<span class="st">"tomato1"</span>,<span class="st">"navyblue"</span>))<span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"- School Year -"</span>, <span class="at">y=</span><span class="st">"BNT-60"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03_assumptranef_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p class="solution-end">
</p>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;">

</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>It’s always going to be debateable about what is ‘too high’ because in certain situations you might expect correlations close to 1. It’s best to think through whether it is a feasible value given the study itself<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">© Copyright 2019-2023 <a href="https://www.ed.ac.uk/">The University of Edinburgh</a>. Site licensed under the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">GNU AGPLv3</a> license.</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>