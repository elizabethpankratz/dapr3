<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression Refresh and Clustered Data</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-chevron-circle-right')) {
    f.classList.add('fa-chevron-circle-down')
    f.classList.remove('fa-chevron-circle-right')
} else {
    f.classList.add('fa-chevron-circle-right')
    f.classList.remove('fa-chevron-circle-down')
}
}
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="assets/style-labs.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><strong>DAPR3</strong></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Multi Level Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_regressionrefresh.html">1: Linear Regression | Clustered Data</a>
    </li>
    <li>
      <a href="02_intromlm.html">2: LM to MLM</a>
    </li>
    <li>
      <a href="03_assumptranef.html">3: Assumptions, Diagnostics</a>
    </li>
    <li>
      <a href="04_centerglmer.html">4: Centering | Logistic</a>
    </li>
    <li>
      <a href="05_examples.html">5: Recap</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dimension reduction &amp; SEM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="07_path1.html">7: Path Analysis</a>
    </li>
    <li class="dropdown-header">8: Path Analysis</li>
    <li class="dropdown-header">9: Dimension Reduction</li>
    <li class="dropdown-header">10: EFA 1</li>
    <li class="dropdown-header">11: EFA 2</li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extra
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../resources.html">Useful Resources</a>
    </li>
    <li>
      <a href="../examples/example_01_repeated_measures.html">Example: Repeated Measures MLM</a>
    </li>
    <li>
      <a href="../examples/example_02_intervention.html">Example: Intervention Study</a>
    </li>
    <li>
      <a href="../examples/example_03_many_trials.html">Example: Many Trials</a>
    </li>
    <li>
      <a href="../examples/example_00_anova.html">Example: ANOVA (rpt measures &amp; mixed)</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Regression Refresh and Clustered Data</h1>

</div>


<div class="lo">
<p><strong>Preliminaries</strong></p>
<ol style="list-style-type: decimal">
<li>Open Rstudio, and <strong>create a new project for this course!!</strong></li>
<li>Create a new RMarkdown document or R script (whichever you like) for this week.</li>
</ol>
</div>
<div id="new-packages" class="section level1">
<h1>New Packages!</h1>
<div class="rtip">
<p>These are the main packages we’re going to use in this block. It might make sense to install them now if you do not have them already (note, the rstudio.ppls.ed.ac.uk server already has <code>lme4</code> and <code>tidyverse</code> installed for you).</p>
<ul>
<li><strong>tidyverse</strong> : for organising data<br />
</li>
<li><strong>ICC</strong> : for quickly calculating intraclass correlation coefficient</li>
<li><strong>lme4</strong> : for fitting generalised linear mixed effects models</li>
<li><strong>lmeresampler</strong> : for bootstrapping!</li>
<li><strong>effects</strong> : for tabulating and graphing effects in linear models</li>
<li><strong>broom.mixed</strong> : tidying methods for mixed models</li>
<li><strong>sjPlot</strong> : for plotting models</li>
<li><strong>DHARMa</strong> : for simulating residuals to assess assumptions</li>
<li><strong>HLMdiag</strong> : for examining case diagnostics at multiple levels</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;tidyverse&quot;</span>,<span class="st">&quot;ICC&quot;</span>,<span class="st">&quot;lme4&quot;</span>,<span class="st">&quot;effects&quot;</span>,<span class="st">&quot;broom.mixed&quot;</span>,<span class="st">&quot;sjPlot&quot;</span>,<span class="st">&quot;HLMdiag&quot;</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the lmeresampler package has had some recent updates. better to install the most recent version:</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;aloy/lmeresampler&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="linear-model-refresh" class="section level1">
<h1>Linear model refresh</h1>
<div class="statbox">
<p>Recall that in the DAPR2 course last year we learned all about the linear regression model, which took the form:</p>
<p><span class="math display">\[
\begin{align}\\
&amp; \text{for observation }i \\
&amp; \color{red}{Y_i} = \color{blue}{\beta_0 \cdot{} 1 + \beta_1 \cdot{} X_{1i} \ + \ ... \ + \ \beta_p \cdot{} X_{pi}} + \varepsilon_i \\ 
\end{align}
\]</span></p>
<p>And if we wanted to write this more simply, we can express <span class="math inline">\(X_1\)</span> to <span class="math inline">\(X_p\)</span> as an <span class="math inline">\(n \times p\)</span> matrix (samplesize <span class="math inline">\(\times\)</span> parameters), and <span class="math inline">\(\beta_0\)</span> to <span class="math inline">\(\beta_p\)</span> as a vector of coefficients:</p>
<p><span class="math display">\[
\mathbf{y} = \boldsymbol{X\beta} + \boldsymbol{\varepsilon}
\quad \\
\text{where} \quad \varepsilon \sim N(0, \sigma) \text{ independently}
\]</span></p>
</div>
<div class="frame">
<p><strong>Data: Toy Data</strong></p>
<p>Let’s consider a little toy example in which we might use linear regression to determine how practice (in hours per week) influences the reading age of different toy figurines</p>
<p>Imagine that we have data on various types of toys, from Playmobil, to Powerrangers, to farm animals.<br />
You can find a dataset at <a href="https://uoepsy.github.io/data/toyexample.csv" class="uri">https://uoepsy.github.io/data/toyexample.csv</a>, and read it into your R environment using the code below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>toys_read <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://uoepsy.github.io/data/toyexample.csv&quot;</span>)</span></code></pre></div>
The dataset contains information on 132 different toy figures. You can see the variables in the table below<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.
<br>
<div style="display:inline-block; width: 45%;vertical-align: middle;">
<p><img src="images/intro/toys.png" width="300px" style="display: block; margin: auto;" /></p>
</div>
<div style="display:inline-block; width: 45%;vertical-align: middle;">
<div id="xlaxikyqet" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xlaxikyqet .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xlaxikyqet .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xlaxikyqet .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xlaxikyqet .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xlaxikyqet .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xlaxikyqet .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xlaxikyqet .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xlaxikyqet .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xlaxikyqet .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xlaxikyqet .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xlaxikyqet .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xlaxikyqet .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xlaxikyqet .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xlaxikyqet .gt_from_md > :first-child {
  margin-top: 0;
}

#xlaxikyqet .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xlaxikyqet .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xlaxikyqet .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xlaxikyqet .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xlaxikyqet .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xlaxikyqet .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xlaxikyqet .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xlaxikyqet .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xlaxikyqet .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xlaxikyqet .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xlaxikyqet .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xlaxikyqet .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xlaxikyqet .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xlaxikyqet .gt_left {
  text-align: left;
}

#xlaxikyqet .gt_center {
  text-align: center;
}

#xlaxikyqet .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xlaxikyqet .gt_font_normal {
  font-weight: normal;
}

#xlaxikyqet .gt_font_bold {
  font-weight: bold;
}

#xlaxikyqet .gt_font_italic {
  font-style: italic;
}

#xlaxikyqet .gt_super {
  font-size: 65%;
}

#xlaxikyqet .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">toy_type</td>
<td class="gt_row gt_left">Type of Toy</td></tr>
    <tr><td class="gt_row gt_left">toy</td>
<td class="gt_row gt_left">Character</td></tr>
    <tr><td class="gt_row gt_left">hrs_week</td>
<td class="gt_row gt_left">Hours of practice per week</td></tr>
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_left">Age (in years)</td></tr>
    <tr><td class="gt_row gt_left">R_AGE</td>
<td class="gt_row gt_left">Reading Age</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="question-begin">
Question A1
</div>
<div class="question-body">
<p>Read in the toy data from <a href="https://uoepsy.github.io/data/toyexample.csv" class="uri">https://uoepsy.github.io/data/toyexample.csv</a> and plot the bivariate relationship between Reading Age and Hrs per Week practice, and then fit the simple linear model:
<span class="math display">\[
\text{Reading Age}_i = \beta_0 + \beta_1 \cdot \text{Hours per week practice}_i + \varepsilon_i
\]</span></p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-1" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-1&#39;, &#39;sol-start-1&#39;)"> Solution </span>
</div>
<div id="sol-body-1" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>toys_read <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://uoepsy.github.io/data/toyexample.csv&quot;</span>) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> toys_read, <span class="fu">aes</span>(<span class="at">x =</span> hrs_week, <span class="at">y =</span> R_AGE))<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-7-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>simplemod <span class="ot">&lt;-</span> <span class="fu">lm</span>(R_AGE <span class="sc">~</span> hrs_week, <span class="at">data =</span> toys_read)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simplemod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = R_AGE ~ hrs_week, data = toys_read)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -12.9086  -3.2084   0.0047   3.0493  12.3262 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)   3.4554     2.0379   1.696   0.0924 .
## hrs_week      0.7229     0.4866   1.486   0.1398  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.276 on 130 degrees of freedom
## Multiple R-squared:  0.01669,    Adjusted R-squared:  0.009131 
## F-statistic: 2.207 on 1 and 130 DF,  p-value: 0.1398</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question A2
</div>
<div class="question-body">
<p>Think about the assumptions we make about our model:
<span class="math display">\[
\text{where} \quad \varepsilon_i \sim N(0, \sigma) \text{ independently}
\]</span>
Have we satisfied this assumption (specifically, the assumption of <em>independence</em> of errors)?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-2" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-2&#39;, &#39;sol-start-2&#39;)"> Solution </span>
</div>
<div id="sol-body-2" class="solution-body" style="display: none;">
<p>Our model from the previous question will assume that the residuals for all toys are independent of one another. But is this a reasonable assumption that we can make? Might we not think that the Playmobil characters could be generally better at reading than the Power Rangers? Or even that ScoobyDoo figurines might be more receptive to practice than the Sock Puppets are?</p>
<p>The natural grouping of the toys into their respective type introduces a level of <em>dependence</em> which we would be best to account for.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question A3
</div>
<div class="question-body">
<p>Try running the code below.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> toys_read, <span class="fu">aes</span>(<span class="at">x=</span>hrs_week, <span class="at">y=</span>R_AGE))<span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Then try editing the code to include an aesthetic mapping from the type of toy to the color in the plot.<br />
How do your thoughts about the relationship between Reading Age and Practice change?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-3" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-3&#39;, &#39;sol-start-3&#39;)"> Solution </span>
</div>
<div id="sol-body-3" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> toys_read, <span class="fu">aes</span>(<span class="at">x=</span>hrs_week, <span class="at">y=</span>R_AGE))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> toys_read, <span class="fu">aes</span>(<span class="at">x=</span>hrs_week, <span class="at">y=</span>R_AGE, <span class="at">col=</span>toy_type))<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>From the second plot, we see a lot of the toy types appear to have a positive relationship (practice increases reading age). There seem to be differences between toy types in both the general reading level (Scooby Doo characters can read very well), and in how practice influences reading age (for instance, the Farm Animals don’t seem to improve at all with practice!).</p>
</div>
<p class="solution-end">
</p>
<div class="frame">
<p><strong>Complete Pooling</strong></p>
<p>We can consider the simple regression model (<code>lm(R_AGE ~ hrs_week, data = toys_read)</code>) to “pool” the information from all observations together. In this ‘Complete Pooling’ approach, we simply ignore the natural clustering of the toys, as if we were unaware of it. The problem is that this assumes the same regression line for all toy types, which might not be that appropriate:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-11"></span>
<img src="01_regressionrefresh_files/figure-html/unnamed-chunk-11-1.png" alt="Complete pooling can lead to bad fit for certain groups" width="350px" />
<p class="caption">
Figure 1: Complete pooling can lead to bad fit for certain groups
</p>
</div>
<p><strong>No Pooling</strong></p>
<p>There are various ways we could attempt to deal with the problem that our data are in groups (or “clusters”). With the tools you have learned in DAPR2, you may be tempted to try including toy type in the model as another predictor, to allow for some toy types being generally better than others:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(R_AGE <span class="sc">~</span> hrs_week <span class="sc">+</span> toy_type, <span class="at">data =</span> toys_read)</span></code></pre></div>
<p>Or even to include an interaction to allow for toy types to respond differently to practice:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(R_AGE <span class="sc">~</span> hrs_week <span class="sc">*</span> toy_type, <span class="at">data =</span> toys_read)</span></code></pre></div>
<p>This approach gets termed the “No Pooling” method, because the information from each cluster contributes <em>only</em> to an estimated parameter for that cluster, and there is no pooling of information across clusters. This is a good start, but it means that a) we are estimating <em>a lot</em> of parameters, and b) we are not necessarily estimating the parameter of interest (the <em>overall</em> effect of practice on reading age). Furthermore, we’ll probably end up having high variance in the estimates at each group.</p>
</div>
<div class="question-begin">
Question A4
</div>
<div class="question-body">
<p>Fit a linear model which accounts for the grouping of toys into their different types, but holds the effect of practice-hours-per-week on reading age as constant across types:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(R_AGE <span class="sc">~</span> hrs_week <span class="sc">+</span> toy_type, <span class="at">data =</span> toys_read)</span></code></pre></div>
<p>Can you construct a plot of the <strong>fitted</strong> values from this model, coloured by toy_type?<br />
(Hint: you might want to use the <code>augment()</code> function from the <strong>broom</strong> package)</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-4" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-4&#39;, &#39;sol-start-4&#39;)"> Solution </span>
</div>
<div id="sol-body-4" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(mod1) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.,<span class="fu">aes</span>(<span class="at">x=</span>hrs_week, <span class="at">y=</span>.fitted, <span class="at">col=</span>toy_type))<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question A5
</div>
<div class="question-body">
<p>What happens (to the plot, and to your parameter estimates) when you include the interaction between <code>toy_type</code> and <code>hrs_week</code>?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-5" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-5&#39;, &#39;sol-start-5&#39;)"> Solution </span>
</div>
<div id="sol-body-5" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(R_AGE <span class="sc">~</span> hrs_week <span class="sc">*</span> toy_type, <span class="at">data =</span> toys_read)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">augment</span>(mod2) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.,<span class="fu">aes</span>(<span class="at">x=</span>hrs_week, <span class="at">y=</span>.fitted, <span class="at">col=</span>toy_type))<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-16-1.png" width="80%" style="display: block; margin: auto;" />
We can see now that our model is fitting a different relationship between reading age and practice for each toy type. This is good - we’re going to get better estimates for different types of toy (e.g. scooby doo’s reading age increases with practice, farm animals don’t).</p>
<p>We can see that this model provides a better fit - it results in a significant reduction in the residual sums of squares:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1, mod2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: R_AGE ~ hrs_week + toy_type
## Model 2: R_AGE ~ hrs_week * toy_type
##   Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1    111 555.72                              
## 2     92 393.12 19    162.59 2.0026 0.01538 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>But accounting for this heterogeneity over clusters in the effect of interest comes at the expense of not pooling information across groups to get one estimate for “the effect of practice on reading age.” Additionally, these models will tend to have low statistical power because they are using fewer observations (only those within each cluster) to estimate parameters which only represent within-cluster effects.</p>
</div>
<p class="solution-end">
</p>
</div>
<div id="some-data-wrangling" class="section level1">
<h1>Some Data Wrangling</h1>
<div class="frame">
<p><strong>Data: Raising the stakes</strong></p>
<p>30 volunteers from an amateur basketball league participated in a study on stress induced by size and type of potential reward for successfully completing a throw. Each participant completed 20 trials in which they were tasked with throwing a basketball and scoring a goal in order to win a wager. The size of the wager varied between trials, ranging from 1 to 20 points, with the order randomised for each participant. If a participant successfully threw the ball in the basket, then their score increased accordingly. If they missed, their score decreased accordingly. Participants were informed of the size of the potential reward/loss prior to each throw.</p>
<p>To examine the influence of the <em>type</em> of reward/loss on stress-levels, the study consisted of two conditions. In the monetary condition, (n = 15) participants were informed at the start of the study that the points corresponded to a monetary reward, and that they would be given their total score in £ at the end of the study. In the reputation condition, (n = 15) participants were informed that the points would be inputted on to a scoreboard and distributed around the local basketball clubs and in the league newsletter.</p>
<p>Throughout each trial, participants’ heart rate variability (HRV) was measured via a chest strap. HRV is considered to be indirectly related to levels of stress (i.e., higher HRV = less stress).</p>
<p>The data is in stored in two separate files.</p>
<ul>
<li>Information on the conditions for each trial for each participant is stored in <strong>.csv</strong> format at <a href="https://uoepsy.github.io/data/basketballconditions.csv" class="uri">https://uoepsy.github.io/data/basketballconditions.csv</a>.</li>
<li>Information on participants’ HRV for each trial is stored in <strong>.xlsx</strong> format, and can be downloaded from <a href="https://uoepsy.github.io/data/basketballhrv.xlsx" class="uri">https://uoepsy.github.io/data/basketballhrv.xlsx</a></li>
</ul>
</div>
<p>We’re going to need to do some data wrangling now, so take a read through the boxes below on reshaping and merging data.</p>
<div class="rtip">
<p><strong>Pivot!</strong></p>
<p>One of the more confusing things to get to grips with is the idea of reshaping a dataframe.<br />
For different reasons, you might sometimes want to have data in wide, or in long format.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="https://www.fromthebottomoftheheap.net/assets/img/posts/tidyr-longer-wider.gif" alt="Source: https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/" width="80%" />
<p class="caption">
Figure 2: Source: <a href="https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/" class="uri">https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/</a>
</p>
</div>
<p>When the data is wide, we can make it long using <code>pivot_longer()</code>. When we make data longer, we’re essentially making lots of columns into 2 longer columns. Above, in the animation, the wide variable <strong>x</strong>, <strong>y</strong> and <strong>z</strong> go into a new longer column called <strong>name</strong> that specifies which (x/y/z) it came from, and the values get put into the <strong>val</strong> column.</p>
<p>The animation takes a shortcut in the code it displays above, but you could also use <code>pivot_longer(c(x,y,z), names_to = "name", values_to = "val")</code>. To reverse this, and put it back to being wide, we tell R which columns to take the names and values <em>from</em>: <code>pivot_wider(names_from = name, values_from = val)</code>.</p>
</div>
<div class="rtip">
<p><strong>Joining data</strong></p>
<p>Now comes a fun bit.
You may have noticed that we have two datasets for this study. If we are interested in relationships between the heart rate variability (HRV) of participants during each trial, as well as the experimental manipulations (i.e., the condition of each trial), these are currently in different datasets.<br />
Solution: we need to join them together!</p>
<p>Provided that both data-sets contain information on participant number and trial number, which uniquely identify each observation, we can join them together matching on those variables!</p>
<p>There are lots of different ways to join data-sets, depending on whether we want to keep rows from one data-set or the other, or keep only those in both data-sets etc.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/messy/joins.png" alt="Check out the help documentation for them all using `?full_join`." width="80%" />
<p class="caption">
Figure 3: Check out the help documentation for them all using <code>?full_join</code>.
</p>
</div>
</div>
<div class="question-begin">
Question B1
</div>
<div class="question-body">
<p>Get the data into your R session.</p>
<p><strong>Note:</strong> For one of the files, this is a bit different to how we have given you data in previous exercises. You may remember that for a <strong>.csv</strong> file, you can read directly into R from the link using, <code>read_csv("https://uoepsy.......)</code>.</p>
<p>However, in reality you are likely to be confronted with data in all sorts of weird formats, such as <strong>.xlsx</strong> files from MS Excel. Have a look around the internet to try and find any packages/functions/techniques for getting both the datasets in to R.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-6" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-6&#39;, &#39;sol-start-6&#39;)"> Solution </span>
</div>
<div id="sol-body-6" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://uoepsy.github.io/data/basketballconditions.csv&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bball)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   stakes condition   sub throw trial_no success_rate
##    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
## 1     13 money         1     1 trial_1             1
## 2     17 money         1     1 trial_2             1
## 3      7 money         1     1 trial_3             1
## 4      1 money         1     1 trial_4             1
## 5      2 money         1     1 trial_5             1
## 6      8 money         1     1 trial_6             1</code></pre>
<p>For the <strong>.xlsx</strong> data:</p>
<ul>
<li>Step 1: download the data to your computer<br />
</li>
<li>Step 2: load the <strong>readxl</strong> package.<br />
</li>
<li>Step 3: use the <code>read_xlsx()</code> function to read in the data, pointing it to the relevant place on your computer.</li>
</ul>
<p>You can actually do all these steps from within R.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;https://uoepsy.github.io/data/basketballhrv.xlsx&quot;</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&quot;baskeballhrvdata.xlsx&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>bballhrv <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;baskeballhrvdata.xlsx&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 21
##     sub trial_1 trial_2 trial_3 trial_4 trial_5 trial_6 trial_7 trial_8 trial_9
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1     1    5.47    6.69    2.72    4.95    5.96    4.93    4.62    4.70    5.78
## 2     2    4.60    6.46    3.77    4.80    6.33    5.15    5.04    5.70    4.66
## 3     3    5.14    5.98    4.30    4.40    4.97    5.16    4.71    4.60    5.94
## 4     4    5.85    3.74    3.40    4.97    6.46    3.87    5.14    6.26    3.60
## 5     5    7.46    5.83    4.83    6.26    3.52    5.92    4.24    4.39    5.75
## 6     6    3.53    2.89    2.07    2.20    3.92    4.45    3.19    5.20    3.81
## # … with 11 more variables: trial_10 &lt;dbl&gt;, trial_11 &lt;dbl&gt;, trial_12 &lt;dbl&gt;,
## #   trial_13 &lt;dbl&gt;, trial_14 &lt;dbl&gt;, trial_15 &lt;dbl&gt;, trial_16 &lt;dbl&gt;,
## #   trial_17 &lt;dbl&gt;, trial_18 &lt;dbl&gt;, trial_19 &lt;dbl&gt;, trial_20 &lt;dbl&gt;</code></pre>
</div>
<p class="solution-end">
</p>
<div class="imp">
<p>Unfortunartely, a few students are getting error messages which we could not solve when trying to read in the xlsx data. The same data is available at <a href="https://uoepsy.github.io/data/bballhrv.csv" class="uri">https://uoepsy.github.io/data/bballhrv.csv</a> so that you can read it in using:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;https://uoepsy.github.io/data/bballhrv.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="question-begin">
Question B2
</div>
<div class="question-body">
<p>Is each dataset in wide or long format? We want them both in long format, so try to reshape either/both if necessary.</p>
<p>Hint - in the tidyverse functions, you can specify all columns between column <strong>x</strong> and column <strong>z</strong> by using the colon, <code>x:z</code>.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-7" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-7&#39;, &#39;sol-start-7&#39;)"> Solution </span>
</div>
<div id="sol-body-7" class="solution-body" style="display: none;">
<p>Only the HRV data is in wide format:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 21
##     sub trial_1 trial_2 trial_3 trial_4 trial_5 trial_6 trial_7 trial_8 trial_9
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1     1    5.47    6.69    2.72    4.95    5.96    4.93    4.62    4.70    5.78
## 2     2    4.60    6.46    3.77    4.80    6.33    5.15    5.04    5.70    4.66
## 3     3    5.14    5.98    4.30    4.40    4.97    5.16    4.71    4.60    5.94
## 4     4    5.85    3.74    3.40    4.97    6.46    3.87    5.14    6.26    3.60
## 5     5    7.46    5.83    4.83    6.26    3.52    5.92    4.24    4.39    5.75
## 6     6    3.53    2.89    2.07    2.20    3.92    4.45    3.19    5.20    3.81
## # … with 11 more variables: trial_10 &lt;dbl&gt;, trial_11 &lt;dbl&gt;, trial_12 &lt;dbl&gt;,
## #   trial_13 &lt;dbl&gt;, trial_14 &lt;dbl&gt;, trial_15 &lt;dbl&gt;, trial_16 &lt;dbl&gt;,
## #   trial_17 &lt;dbl&gt;, trial_18 &lt;dbl&gt;, trial_19 &lt;dbl&gt;, trial_20 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bballhrv <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  bballhrv <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(trial_1<span class="sc">:</span>trial_20, <span class="at">names_to =</span> <span class="st">&quot;trial_no&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;hrv&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bballhrv)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##     sub trial_no   hrv
##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1     1 trial_1   5.47
## 2     1 trial_2   6.69
## 3     1 trial_3   2.72
## 4     1 trial_4   4.95
## 5     1 trial_5   5.96
## 6     1 trial_6   4.93</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B3
</div>
<div class="question-body">
<p>join the two datasets (both in long format) together.</p>
<p>Note that the variables we are matching on need to have the information in the same format. For instance, R won’t be able to match <code>"trial_1","trial_2","trial_3"</code> with <code>1, 2, 3</code> because they are different things. We would need to edit one of them to be in the same format.</p>
<p><strong>Hint:</strong> You should end up with 600 rows.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-8" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-8&#39;, &#39;sol-start-8&#39;)"> Solution </span>
</div>
<div id="sol-body-8" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">full_join</span>(bball, bballhrv)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bball)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   stakes condition   sub throw trial_no success_rate   hrv
##    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
## 1     13 money         1     1 trial_1             1  5.47
## 2     17 money         1     1 trial_2             1  6.69
## 3      7 money         1     1 trial_3             1  2.72
## 4      1 money         1     1 trial_4             1  4.95
## 5      2 money         1     1 trial_5             1  5.96
## 6      8 money         1     1 trial_6             1  4.93</code></pre>
</div>
<p class="solution-end">
</p>
</div>
<div id="exploring-clustering" class="section level1">
<h1>Exploring Clustering</h1>
<div class="question-begin">
Question B4
</div>
<div class="question-body">
<p>Continuing with our basketball/hrv study, consider the following questions:</p>
<p>What are the units of observations?<br />
What are the groups/clusters?<br />
What varies <em>within</em> these clusters?<br />
What varies <em>between</em> these clusters?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-9" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-9&#39;, &#39;sol-start-9&#39;)"> Solution </span>
</div>
<div id="sol-body-9" class="solution-body" style="display: none;">
<p>What are the units of observations? <strong>trials</strong><br />
What are the groups/clusters? <strong>participants</strong>
What varies <em>within</em> these clusters? <strong>size of reward</strong><br />
What varies <em>between</em> these clusters? <strong>type of reward</strong></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B5
</div>
<div class="question-body">
<p>Now that you have tidied and joined all the data together, plot the relationship between size of reward and HRV, ignoring the fact that there are repeated observations for each subject.<br />
Can you make a separate plot for each of the experimental conditions? (Hint: <code>facet_wrap()</code>)</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-10" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-10&#39;, &#39;sol-start-10&#39;)"> Solution </span>
</div>
<div id="sol-body-10" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bball, <span class="fu">aes</span>(<span class="at">x=</span>stakes,<span class="at">y=</span>hrv))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">alpha=</span>.<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>condition)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B6
</div>
<div class="question-body">
<blockquote>
<p>How are stress levels (measured via HRV) influenced by the size of potential reward/loss?</p>
</blockquote>
<p>Ignore the clustering, and fit a simple linear regression estimating how heart rate variability is influenced by how high the stakes are (i.e. how big the reward is) for a given throw.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-11" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-11&#39;, &#39;sol-start-11&#39;)"> Solution </span>
</div>
<div id="sol-body-11" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>simple_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(hrv <span class="sc">~</span> stakes, <span class="at">data =</span> bball)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hrv ~ stakes, data = bball)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.6396 -0.8275  0.0418  0.8787  4.0314 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.978570   0.114654  43.423   &lt;2e-16 ***
## stakes      -0.022790   0.009571  -2.381   0.0176 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.352 on 598 degrees of freedom
## Multiple R-squared:  0.009392,   Adjusted R-squared:  0.007736 
## F-statistic:  5.67 on 1 and 598 DF,  p-value: 0.01757</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B7
</div>
<div class="question-body">
<p>Consider the following research question:</p>
<blockquote>
<p>How do size and type of reward/loss interact to influence levels of stress?</p>
</blockquote>
<p>Extend your model to include the interaction between stakes and experimental condition and examine the parameter values.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-12" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-12&#39;, &#39;sol-start-12&#39;)"> Solution </span>
</div>
<div id="sol-body-12" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>simple_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(hrv <span class="sc">~</span> condition<span class="sc">*</span>stakes, <span class="at">data =</span> bball)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(simple_mod)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: hrv
##                   Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## condition          1   36.62  36.621 20.8484 6.042e-06 ***
## stakes             1   10.36  10.362  5.8989   0.01544 *  
## condition:stakes   1    9.34   9.344  5.3194   0.02143 *  
## Residuals        596 1046.91   1.757                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hrv ~ condition * stakes, data = bball)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.4250 -0.8292  0.0231  0.8821  4.1205 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            4.998385   0.158965  31.443   &lt;2e-16 ***
## conditionmoney        -0.039631   0.224810  -0.176   0.8601    
## stakes                -0.001148   0.013270  -0.087   0.9311    
## conditionmoney:stakes -0.043284   0.018767  -2.306   0.0214 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.325 on 596 degrees of freedom
## Multiple R-squared:  0.05106,    Adjusted R-squared:  0.04628 
## F-statistic: 10.69 on 3 and 596 DF,  p-value: 7.494e-07</code></pre>
<div class="int">
<p>Heart Rate Variability (HRV) was found to be influenced by both the size of the potential reward/loss of a given trial, whether whether participants were playing for money or for a place on the scoreboard, and the interaction between the two.
For a 1 point increase in stakes, HRV decreased by -0.04 (<span class="math inline">\(SE=0.02,t(596)=-2.31,p=0.02\)</span>)**** in the condition in which participants played for money relative to that in which participants played for kudos, suggesting that the size of the reward has a greater effect on stress levels when playing for money compared to playing for reputation.</p>
<p>**** <strong>Caveat:</strong> Our model did <strong>not</strong> account for by-participant clustering of data, thereby violating the assumption that errors are iid (independent and identically distributed).</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B8
</div>
<div class="question-body">
<p>Let’s start to examine the clustering a bit more.<br />
Plot the relationship between size of reward and HRV, with a separate line for each subject.</p>
<p><strong>Hint:</strong> remember the <code>group =</code> aesthetic in ggplot!</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-13" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-13&#39;, &#39;sol-start-13&#39;)"> Solution </span>
</div>
<div id="sol-body-13" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bball, <span class="fu">aes</span>(<span class="at">x=</span>stakes, <span class="at">y=</span>hrv, <span class="at">group=</span>sub, <span class="at">col=</span>condition))<span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">se=</span>F, <span class="at">alpha=</span>.<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span><span class="cn">NULL</span></span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-30-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B9
</div>
<div class="question-body">
<p>Calculate the ICC, using the <code>ICCbare()</code> function from the <strong>ICC</strong> package.</p>
<p>Remember, you can look up the help for a function by typing a <code>?</code> followed by the function name in the console.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-14" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-14&#39;, &#39;sol-start-14&#39;)"> Solution </span>
</div>
<div id="sol-body-14" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ICC)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ICCbare</span>(<span class="at">x =</span> sub, <span class="at">y =</span> hrv, <span class="at">data =</span> bball)</span></code></pre></div>
<pre><code>## [1] 0.3141482</code></pre>
</div>
<p class="solution-end">
</p>
<div class="optional-begin">
<span id="opt-start-15" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-15&#39;, &#39;opt-start-15&#39;)"> Optional - Extra difficult. Calculate ICC manually</span>
</div>
<div id="opt-body-15" class="optional-body" style="display: none;">
<p>We have equal group sizes here (there are 2 <span class="math inline">\(\times\)</span> 15 participants, each with 20 observations), which makes calculating ICC by hand a lot easier, but it’s still a bit tricky.</p>
<p>Let’s take a look at the formula for ICC</p>
<p><span class="math display">\[
\begin{align}
ICC \; (\rho) = &amp; \frac{\sigma^2_{b}}{\sigma^2_{b} + \sigma^2_e} \\
\qquad \\
= &amp; \frac{\frac{MS_b - MS_e}{k}}{\frac{MS_b - MS_e}{k} + MS_e} \\
\qquad \\
= &amp; \frac{MS_b - MS_e}{MS_b + (k-1)MS_e} \\
\qquad \\
\qquad \\
\text{Where:} &amp; \\ 
k = &amp; \textrm{number of observations in each group} \\
MS_b = &amp; \textrm{Mean Squares between groups} = \frac{\text{Sums Squares between groups}}{df_\text{groups}}
= \frac{\sum\limits_{i=1}(\bar{y}_i - \bar{y})^2}{\textrm{n groups}-1}\\
MS_e = &amp; \textrm{Mean Squares within groups} \frac{\text{Sums Squares within groups}}{df_\text{within groups}} 
= \frac{\sum\limits_{i=1}\sum\limits_{j=1}(y_{ij} - \bar{y_i})^2}{\textrm{n obs}-\textrm{n groups}}\\
\end{align}
\]</span>
So we’re going to need to calculate the grand mean of <span class="math inline">\(y\)</span>, the group means of <span class="math inline">\(y\)</span>, and then the various squared differences between group means and grand mean, and between observations and their respective group means.</p>
<p>The code below will give us a new column which is the overall mean of y. This bit is fairly straightforward.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="rtip">
<p>We have seen a lot of the combination of <code>group_by() %&gt;% summarise()</code>, but we can also combine <code>group_by()</code> with <code>mutate()</code>!</p>
</div>
<p>Try the following:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sub) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="rtip">
<p><strong>The grouping gets carried forward.</strong></p>
<p>Using <code>group_by()</code> can quite easily land you in trouble if you forget that you have grouped the dataframe.</p>
<p>Look at the output of <code>class()</code> when we have grouped the data. It still mentions something about the grouping.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">grand_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sub) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_mean =</span> <span class="fu">mean</span>(hrv)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bball)</span></code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>To remove the grouping, we can use <code>ungroup()</code> (we could also just add this to the end of our code sequence above and re-run it):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(bball)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bball)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<p>Now we need to create a column which is the squared differences between the observations <span class="math inline">\(y_{ij}\)</span> and the group means <span class="math inline">\(\bar{y_i}\)</span>.<br />
We also want a column which is the squared differences between the group means <span class="math inline">\(\bar{y_i}\)</span> and the overall mean <span class="math inline">\(\bar{y}\)</span>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> bball <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">within =</span> (hrv<span class="sc">-</span>group_mean)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">between =</span> (group_mean<span class="sc">-</span>grand_mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>And then we want to sum them:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ssbetween <span class="ot">=</span> <span class="fu">sum</span>(bball<span class="sc">$</span>between)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>sswithin <span class="ot">=</span> <span class="fu">sum</span>(bball<span class="sc">$</span>within)</span></code></pre></div>
<p>Finally, we divide them by the degrees of freedom.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Squares between</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>msb <span class="ot">=</span> ssbetween <span class="sc">/</span> (<span class="dv">30-1</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Squares within </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">=</span> sswithin <span class="sc">/</span> (<span class="dv">600-30</span>)</span></code></pre></div>
<p>And calculate the ICC!!!</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ICC</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>(msb<span class="sc">-</span>mse) <span class="sc">/</span>(msb <span class="sc">+</span> (<span class="dv">19</span><span class="sc">*</span>mse))</span></code></pre></div>
<pre><code>## [1] 0.3141482</code></pre>
</div>
<p class="optional-end">
</p>
<div class="statbox">
<p><strong>Understanding ICC a bit better</strong></p>
<p>Think about what ICC represents - the ratio of the variance between the groups to the total variance.<br />
You can think of the “variance between the groups” as the group means varying around the overall mean (the black dots around the black line), and the total variance as that plus the addition of the variance of the individual observations around each group mean (each set of coloured points around their respective larger black dot):</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bball, <span class="fu">aes</span>(<span class="at">x=</span>sub, <span class="at">y=</span>hrv))<span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>sub),<span class="at">alpha=</span>.<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom =</span> <span class="st">&quot;pointrange&quot;</span>)<span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(bball<span class="sc">$</span>hrv))<span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">col=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-40-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>You can also think of the ICC as the correlation between two randomly drawn observations from the same group.
This is a bit of a tricky thing to get your head round if you try to relate it to the type of “correlation” that you are familiar with. Pearson’s correlation (e.g think about a typical scatterplot) operates on <em>pairs of observations</em> (a set of values on the x-axis and their corresponding values on the y-axis), whereas ICC operates on <em>data which is structured in groups</em>.</p>
<div class="optional-begin">
<span id="opt-start-16" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-16&#39;, &#39;opt-start-16&#39;)"> Optional - ICC as the expected correlation between two observations from same group</span>
</div>
<div id="opt-body-16" class="optional-body" style="display: none;">
<p>Let’s suppose we had only 2 observations in each group.</p>
<pre><code>##   cluster observation   y
## 1 group_1           1   4
## 2 group_1           2   2
## 3 group_2           1   4
## 4 group_2           2   2
## 5 group_3           1   7
## 6 group_3           2   5
## 7     ...         ... ...</code></pre>
<p>The ICC for this data is 0.18:</p>
<p>Now suppose we <em>reshape</em> our data so that we have one row per group, and one column for each observation to look like this:</p>
<pre><code>## # A tibble: 7 × 3
##   cluster obs1  obs2 
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1 group_1 4     2    
## 2 group_2 4     2    
## 3 group_3 7     5    
## 4 group_4 2     7    
## 5 group_5 3     8    
## 6 group_6 6     7    
## 7 ...     ...   ...</code></pre>
<p>Calculating Pearson’s correlation on those two columns yields 0.2, which isn’t quite right. It’s close, but not quite..</p>
<div class="imp">
<p>The crucial thing here is that it is completely arbitrary which observations get called “obs1” and which get called “obs2.”<br />
The data aren’t paired, but <strong>grouped.</strong></p>
</div>
<p>Essentially, there are lots of different combinations of “pairs” here.
There are the ones we have shown above:</p>
<pre><code>## # A tibble: 7 × 3
##   cluster obs1  obs2 
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1 group_1 4     2    
## 2 group_2 4     2    
## 3 group_3 7     5    
## 4 group_4 2     7    
## 5 group_5 3     8    
## 6 group_6 6     7    
## 7 ...     ...   ...</code></pre>
<p>But we might have equally chosen these:</p>
<pre><code>## # A tibble: 7 × 3
##   cluster obs1  obs2 
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1 group_1 2     4    
## 2 group_2 2     4    
## 3 group_3 7     5    
## 4 group_4 2     7    
## 5 group_5 8     3    
## 6 group_6 6     7    
## 7 ...     ...   ...</code></pre>
<p>or these:</p>
<pre><code>## # A tibble: 7 × 3
##   cluster obs1  obs2 
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1 group_1 2     4    
## 2 group_2 4     2    
## 3 group_3 7     5    
## 4 group_4 7     2    
## 5 group_5 8     3    
## 6 group_6 7     6    
## 7 ...     ...   ...</code></pre>
<p>If we take the correlation of all these combinations of pairings, then we get our ICC of 0.18!</p>
<p><strong>ICC = the expected correlation of a <em>randomly drawn pair</em> of observations from the same group.</strong></p>
<!-- We could even do this via simulation, and write our own customised function! -->
<!-- The code below creates a function for us to use. Can you figure out how it works?  -->
<!-- ```{r} -->
<!-- get_random_pair <- function(){ -->
<!--   my_sub = sample(unique(bball$sub), 1) -->
<!--   my_obs = sample(bball$hrv[bball$sub == my_sub], size=2) -->
<!--   my_obs -->
<!-- } -->
<!-- ``` -->
<!-- Try it out, by running it several times.  -->
<!-- ```{r} -->
<!-- get_random_pair() -->
<!-- ``` -->
<!-- Now let's make our computer do it loads and loads of times: -->
<!-- ```{r} -->
<!-- # replicate is a way of making R execute the same code repeatedly, n times. -->
<!-- sims <- replicate(1e6, get_random_pair()) -->
<!-- # t() is short for "transpose" and simple rotates the object 90 degrees (so rows become columns and columns become rows) -->
<!-- sims <- t(sims) -->
<!-- cor(sims[,1], sims[,2]) -->
<!-- ``` -->
</div>
<p class="optional-end">
</p>
</div>
<!-- # GEE -->
<!-- if we're just interested in the effect of x on y and want to adjust for the clustering of the data, generalising estimation equations (GEE) can sometimes be useful. They are in some ways more limited than multilevel models, but simplicity can often be a good thing. -->
<!-- GEEs allow fitting of various correlation structures:  -->
<!-- - "independence": the observations within the groups are uncorrelated. -->
<!-- - "exchangeable": each pair of observations in a group has the same correlation. -->
<!-- - "unstructured": each pair of observations in a group is allowed to have a different correlation. -->
<!-- - "ar1": used to fit an autoregressive structure.  -->
<!-- For repeated measures, "exchangeable" is recommended, but if there is some expected temporal correlation (e.g. participants are influenced by their previous trials) then you might consider an autoregressive structure.  -->
<!-- Subjects are already arranged in order, but they need to be numeric. -->
<!-- ```{r} -->
<!-- ## make group id numeric an ordered -->
<!-- bball %>% mutate( -->
<!--   sub = as.numeric(sub) -->
<!--   ) %>% arrange(sub) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- library(geepack) -->
<!-- geemod <- geeglm(hrv ~ stakes, -->
<!--        id=sub, data = bball, -->
<!--        corstr="exchangeable") -->
<!-- ``` -->
<!-- 

<div class='question-begin'>Question </div><div class='question-body'>

 -->
<!-- Fit the GEE above, and examine the summary output. The package is designed to be interpreted similarly to `lm()` and `glm()`. -->
<!-- 

</div><p class="question-end"></p>

 -->
<!-- 

<div class="solution-begin"><span id='sol-start-17' class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility('sol-body-17', 'sol-start-17')">  Solution </span></div><div class="solution-body" id = "sol-body-17" style="display: none;">

 -->
<!-- ```{r} -->
<!-- summary(geemod) -->
<!-- ``` -->
<!-- Note that the point estimate is the same (`coef(geemod)[2]`) as that from our simple model `lm(hrv ~ stakes, data = bball)` but the standard errors are wider (and the relationship is no longer significant).   -->
<!-- 

</div><p class="solution-end"></p>

 -->
</div>
<div id="fixed-effects" class="section level1">
<h1>Fixed effects</h1>
<div class="question-begin">
Question C1
</div>
<div class="question-body">
<p>Let’s suppose we want to account for the by-participant clustering in our data with the “No pooling” method (i.e., in our multiple regression model, include participant ID as an additional predictor, along with its interaction with explanatory variable of interest).</p>
<ol style="list-style-type: decimal">
<li>Make sure that the participant ID variable is a factor!<br />
</li>
<li>Fit the model</li>
<li>Use the <code>plot_model()</code> function (with <code>type = "int"</code>) to plot the interaction terms between <code>stakes</code> and each participant.</li>
</ol>
<p><strong>Note:</strong> When examining parameter values, remember to think about how HRV is considered to relate to stress, and whether the direction of any effect you see makes theoretical sense.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-18" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-18&#39;, &#39;sol-start-18&#39;)"> Solution </span>
</div>
<div id="sol-body-18" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>bball <span class="ot">&lt;-</span> bball <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sub =</span> <span class="fu">factor</span>(sub))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>nopool_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(hrv <span class="sc">~</span> stakes<span class="sc">*</span>sub, <span class="at">data=</span>bball)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(nopool_mod, <span class="at">type =</span> <span class="st">&quot;int&quot;</span>)</span></code></pre></div>
<p><img src="01_regressionrefresh_files/figure-html/unnamed-chunk-47-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question C2
</div>
<div class="question-body">
<p>We have fitted two models so far:</p>
<ol style="list-style-type: decimal">
<li>The complete pooling model: <code>lm(hrv ~ stakes, data = bball)</code>, which ignores the fact that our data has some inherent grouping (multiple datapoints per participant)</li>
<li>The no pooling model: <code>lm(hrv ~ stakes*sub, data = bball)</code>, which estimates only participant-specific effects.</li>
</ol>
<p>Compare the two models using <code>anova()</code>. Which model provides the best fit?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-19" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-19&#39;, &#39;sol-start-19&#39;)"> Solution </span>
</div>
<div id="sol-body-19" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pool_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(hrv <span class="sc">~</span> stakes, <span class="at">data=</span>bball)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>nopool_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(hrv <span class="sc">~</span> stakes<span class="sc">*</span>sub, <span class="at">data=</span>bball)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(pool_mod, nopool_mod)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: hrv ~ stakes
## Model 2: hrv ~ stakes * sub
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    598 1092.87                                  
## 2    540  477.39 58    615.48 12.003 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We can see that the no pooling model provides a significantly better fit to the data.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question C3
</div>
<div class="question-body">
<p>Recall our research question: “<strong>How are stress levels (measured via HRV) influenced by the size of potential reward/loss?</strong>”</p>
<p>From the model <code>lm(hrv ~ stakes*sub, data=bball)</code>, do we estimate a parameter that allows us to complete the following sentence?:</p>
<ul>
<li><em>“For every 1 point increase in reward, heart rate variability changed by _ ? _ units.”</em></li>
</ul>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-20" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-20&#39;, &#39;sol-start-20&#39;)"> Solution </span>
</div>
<div id="sol-body-20" class="solution-body" style="display: none;">
<p>Remember that when there is an interaction term, coefficients for individual variables included in the interaction term are <strong>conditional effects.</strong> In the model <code>lm(y ~ x * z)</code>, the coefficient for <code>x</code> is the estimated effect of <code>x</code> on <code>y</code> <em>when <code>z=0</code></em> (and vice versa). When one of these is categorical, 0 is a reference level.</p>
<p>So we don’t really estimate a parameter for the overall effect of <code>stakes</code> on <code>hrv</code> - we simply have the participant-specific estimates.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nopool_mod)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                  Estimate Std. Error     t value     Pr(&gt;|t|)
## (Intercept)   4.300458869 0.43677304  9.84598064 3.793839e-21
## stakes        0.061259772 0.03646111  1.68014014 9.350841e-02
## sub2          0.551948310 0.61769035  0.89356796 3.719512e-01
## sub3          0.820197993 0.61769035  1.32784653 1.847898e-01
## sub4          0.532046420 0.61769035  0.86134811 3.894286e-01
## sub5          4.050033460 0.61769035  6.55673743 1.287653e-10
## sub6         -1.487195643 0.61769035 -2.40767180 1.638893e-02
## sub7         -0.176553063 0.61769035 -0.28582778 7.751196e-01
## sub8          0.487065284 0.61769035  0.78852662 4.307348e-01
## sub9          1.523370708 0.61769035  2.46623685 1.396366e-02
## sub10        -0.227750652 0.61769035 -0.36871331 7.124859e-01
## sub11         1.046044119 0.61769035  1.69347653 9.094150e-02
## sub12        -0.943711183 0.61769035 -1.52780625 1.271462e-01
## sub13         2.373490152 0.61769035  3.84252424 1.362505e-04
## sub14        -0.456905318 0.61769035 -0.73969962 4.598037e-01
## sub15         1.782354021 0.61769035  2.88551377 4.063958e-03
## sub16         1.532933894 0.61769035  2.48171901 1.337812e-02
## sub17         0.500646099 0.61769035  0.81051306 4.180024e-01
## sub18         0.983211079 0.61769035  1.59175398 1.120252e-01
## sub19         1.502042629 0.61769035  2.43170809 1.535192e-02
## sub20         3.241516039 0.61769035  5.24780098 2.215398e-07
## sub21         1.147792016 0.61769035  1.85819968 6.368464e-02
## sub22        -0.612560929 0.61769035 -0.99169580 3.217901e-01
## sub23        -0.205178646 0.61769035 -0.33217071 7.398893e-01
## sub24         1.712626937 0.61769035  2.77263022 5.752586e-03
## sub25         1.384399492 0.61769035  2.24125160 2.541529e-02
## sub26        -2.317817283 0.61769035 -3.75239353 1.941184e-04
## sub27         1.393567204 0.61769035  2.25609352 2.446399e-02
## sub28        -0.425881245 0.61769035 -0.68947369 4.908214e-01
## sub29         0.642571954 0.61769035  1.04028167 2.986746e-01
## sub30        -0.010970790 0.61769035 -0.01776099 9.858361e-01
## stakes:sub2  -0.012862460 0.05156379 -0.24944751 8.031095e-01
## stakes:sub3  -0.035097345 0.05156379 -0.68065869 4.963792e-01
## stakes:sub4  -0.029913376 0.05156379 -0.58012364 5.620732e-01
## stakes:sub5  -0.386778846 0.05156379 -7.50097719 2.621397e-13
## stakes:sub6  -0.018284698 0.05156379 -0.35460343 7.230251e-01
## stakes:sub7  -0.045618976 0.05156379 -0.88470944 3.767071e-01
## stakes:sub8  -0.111747546 0.05156379 -2.16717073 3.065825e-02
## stakes:sub9  -0.225284706 0.05156379 -4.36904826 1.496785e-05
## stakes:sub10 -0.055625358 0.05156379 -1.07876775 2.811729e-01
## stakes:sub11 -0.143857500 0.05156379 -2.78989360 5.458818e-03
## stakes:sub12 -0.166749061 0.05156379 -3.23384000 1.296027e-03
## stakes:sub13 -0.192176570 0.05156379 -3.72696718 2.142290e-04
## stakes:sub14  0.057197973 0.05156379  1.10926618 2.678091e-01
## stakes:sub15 -0.218576167 0.05156379 -4.23894652 2.641414e-05
## stakes:sub16 -0.207404000 0.05156379 -4.02227964 6.585414e-05
## stakes:sub17 -0.087620016 0.05156379 -1.69925461 8.984716e-02
## stakes:sub18 -0.160005481 0.05156379 -3.10305871 2.015560e-03
## stakes:sub19 -0.025923824 0.05156379 -0.50275245 6.153433e-01
## stakes:sub20 -0.202111254 0.05156379 -3.91963501 1.000874e-04
## stakes:sub21 -0.075588319 0.05156379 -1.46591848 1.432525e-01
## stakes:sub22 -0.046772269 0.05156379 -0.90707577 3.647713e-01
## stakes:sub23  0.014323707 0.05156379  0.27778613 7.812829e-01
## stakes:sub24 -0.116921035 0.05156379 -2.26750254 2.375390e-02
## stakes:sub25 -0.056800361 0.05156379 -1.10155511 2.711459e-01
## stakes:sub26  0.220232109 0.05156379  4.27106095 2.298973e-05
## stakes:sub27 -0.093440459 0.05156379 -1.81213311 7.052092e-02
## stakes:sub28  0.019860359 0.05156379  0.38516094 7.002698e-01
## stakes:sub29 -0.120547800 0.05156379 -2.33783803 1.975988e-02
## stakes:sub30  0.002596578 0.05156379  0.05035662 9.598568e-01</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question C4
</div>
<div class="question-body">
<p>Let’s suppose we want to examine the interaction between size and <em>type</em> of reward (<code>stakes * condition</code>), using the “no pooling” method (i.e., including participant as a fixed effect).</p>
<p>We have the variable <code>stakes</code>, that varies <strong>within</strong> each participant, and another variable <code>condition</code> that varies <strong>between</strong> participants.</p>
<p>This becomes difficult because the <code>sub</code> variable (the participant id variable) uniquely identifies the two conditions. Note that if we fit the following model, some coefficients are not defined.
Try it and see:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(hrv <span class="sc">~</span> stakes<span class="sc">*</span>sub <span class="sc">+</span> stakes<span class="sc">*</span>condition, <span class="at">data=</span>bball)</span></code></pre></div>
<p>This sort of perfectly balanced design has traditionally been approached with extensions of ANOVA (“repeated measures ANOVA,”“mixed ANOVA”). These methods can partition out variance due to one level of clustering (e.g. subjects), and can examine factorial designs when one factor is within cluster, and the other is between. You can see an example below if you are interested. However, ANOVA has a lot of constraints - it can’t handle multiple levels of clustering (e.g. children in classes in schools), it will likely require treating variables suc as time as a factor, and it’s not great with missing data.
The multi-level model (MLM) provides a more flexible framework, and this is what we will begin to look at next week.</p>
</div>
<p class="question-end">
</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Image sources:<br><a href="http://tophatsasquatch.com/2012-tmnt-classics-action-figures/" class="uri">http://tophatsasquatch.com/2012-tmnt-classics-action-figures/</a><br><a href="https://www.dezeen.com/2016/02/01/barbie-dolls-fashionista-collection-mattel-new-body-types/" class="uri">https://www.dezeen.com/2016/02/01/barbie-dolls-fashionista-collection-mattel-new-body-types/</a><br><a href="https://www.wish.com/product/5da9bc544ab36314cfa7f70c" class="uri">https://www.wish.com/product/5da9bc544ab36314cfa7f70c</a><br><a href="https://www.worldwideshoppingmall.co.uk/toys/jumbo-farm-animals.asp" class="uri">https://www.worldwideshoppingmall.co.uk/toys/jumbo-farm-animals.asp</a><br><a href="https://www.overstock.com/Sports-Toys/NJ-Croce-Scooby-Doo-5pc.-Bendable-Figure-Set-with-Scooby-Doo-Shaggy-Daphne-Velma-and-Fred/28534567/product.html" class="uri">https://www.overstock.com/Sports-Toys/NJ-Croce-Scooby-Doo-5pc.-Bendable-Figure-Set-with-Scooby-Doo-Shaggy-Daphne-Velma-and-Fred/28534567/product.html</a><br><a href="https://tvtropes.org/pmwiki/pmwiki.php/Toys/Furby" class="uri">https://tvtropes.org/pmwiki/pmwiki.php/Toys/Furby</a><br><a href="https://www.fun.com/toy-story-4-figure-4-pack.html" class="uri">https://www.fun.com/toy-story-4-figure-4-pack.html</a><br><a href="https://www.johnlewis.com/lego-minifigures-71027-series-20-pack/p5079461" class="uri">https://www.johnlewis.com/lego-minifigures-71027-series-20-pack/p5079461</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
